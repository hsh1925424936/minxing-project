<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/assistant/layout.js" ></script>
		<script src="../../js/vue.js"></script>
		<script src="../../js/element.js"></script>
		<link rel="stylesheet" type="text/css" href="../../css/element.css">
		<meta charset="UTF-8">
		<title>互动问答主页</title>
		<style type="text/css">
			body{
				background-color:#ECECEC; padding-bottom:20px;
			}
			.isprepare{
				display:flex; width:1024px; margin:5px auto;
			}
			.isprepare li{
				margin:0 10px; cursor:pointer;
			}
			.isprepare_li_on{
				color: #0496C9;
    			text-decoration: underline;
			}
			
			.topBar {
			    width:100%; height:60px; background-color:#f5f5f5; border-top:1px solid #dcdcdc;
			    border-bottom:1px solid #dcdcdc; font-size:14px;
			}
			.topBarInner{
				width:1024px; height:100%; margin:auto;
			}

			.rankBtn:hover,.newBtn:hover {
			    background-color: #f2fafc;
			}
			.topBar button {
			    display:block; float:right; position:relative;
			    top:50%; margin-top:-18px; height:38px; text-align:center; line-height:36px;
			    border:1px solid #0496C9; box-sizing:border-box; border-radius:3px;
			    
			}
			.rankBtn{
				width:88px; background-color:#ffffff; color:rgb(4,150,202);
			}
			.newBtn{
				width:88px; margin-right:12px; background-color:#ffffff; color:rgb(4,150,202);
			}
			.chooseBtn{
				width:118px; margin-right:12px; background-color:#0496ca; color:white;
			}
			.chooseBtn:hover{
				background-color:#0487b5;
			}

			.topBar input{
				float:left; display:block;
    			border:1px solid #CCCCCC; width:288px; height:36px;
    			line-height:36px; padding-left:10px; padding-right:36px;
    			top:50%; margin-top:-19px; position:relative;
    			border-radius:3px;
			}
			.topBar img{
				width:16px; height:16px; float:left; top:50%; cursor:pointer;
			    position:relative; margin-left:-28px; margin-top:-9px;
			}

			.mainCon{
				width:1024px; height:480px; margin:auto; margin-top:20px;
			}
			.navigate{
				width:174px; height:100%; float:left; background-color:white;
				font-size:14px; border-radius:5px; padding-top:10px; overflow-y:auto;
				margin-right:10px; padding-left:1px; padding-right:1px;
			}
			/*.navigate li{
				width:100%; height:38px; line-height:38px;
				text-align:center; cursor:pointer;
			}
			.li_on{
				color:#0496C9; background-color:#DBEFF6;
			}
			.li_not_on{
				color:rgb(51,51,51);
			}*/
			.rightCon{
				width:835px; height:100%; float:right;
				background-color:white; border-radius:5px;
				overflow-y:auto; padding-left:30px; padding-right:30px;
			}
			.rightCon>ul{
				width:100%; height:15px; margin-top:12px; margin-bottom:12px;
				font-size:14px;
			}
			.rightCon>ul li{
				float:right; display:block; margin-left:18px; cursor:pointer;
			}
			.li_on2{
				color:#0496C9; text-decoration:underline;
			}
			.problemOuter{
				width:100%;
			}
			.problemBox{
				width:100%; border:1px solid transparent; margin-bottom:10px;
			}
			#problemBox_done>div>span{
				background-color:#CCCCCC;
			}
			#problemBox_done>div>p{
				color:#CCCCCC;
			}
			.problemBox_on{
				border:1px solid #CCCCCC; border-radius:3px;
			}
			.problemBox:hover{
				border:1px solid #CCCCCC; border-radius:3px;
			}
			#problemBox_done:hover{
				border:1px solid transparent; border-radius:3px;
			}
			.problemCon{
				width:100%; padding:10px;
			}
			.problemCon span{
				display:block; border-radius:18px; width:28px; height:28px;
				float:left; text-align:center; line-height:28px; font-size:12px;
				color:white; margin-right:10px;
			}
			.judge_span{
				background-color:#0495CA;
			}
			.choice_span{
				background-color:#2CC877;
			}
			.remark{
				display:flex; padding:0 10px 10px 50px; font-size:14px;
			}
			.remark .starcon{
				display:flex; padding-right:30px;
			}
			.essay_span{
				background-color:#FFC928;
			}
			.problemCon p{
				float:left; font-size:14px; line-height:20px; padding-top:5px;
				width:690px;
			}
			.hidden_area{
				padding-bottom:20px; padding-left:45px; padding-right:30px;
				position:relative; display:block;
				/*最后把display变为none*/
			}
			
			.hidden_left{
				width:75%; float:left; min-height:45px; padding-right:20px;
				color:rgb(51,51,51);
			}
			.hidden_left>p{
				width:100%; font-size:16px;
				line-height:20px; padding-top:10px;
			}
			.hidden_left>h4{
				width:100%; line-height:18px; font-size:14px; padding-top:5px; padding-bottom:5px;
			}
			
			.btnCon{
				width:141px; height:45px; position:absolute; bottom:20px;
				right:30px; font-size:15px; color:white;
			}
			.btnCon button{
				width:33%; display:block; height:100%; float:left;
				text-align:center; line-height:45px; border:0;
			}
			.askBtn{
				background-color:#2cc779;
			}
			.qiangdaBtn{
				background-color:#2598E9;
			}
			.editBtn{
				background-color:#999999;
			}
			.delBtn{
				background-color:#ff5640;
			}
		</style>	
		
		
	</head>
	<body>
		<div id="vue_control" v-cloak>
			<!-- 头部筛选是否是备课 -->
			<ul class="isprepare">
				<li class="isprepare_li_on">我的备课</li>
				<li>全部题库</li>
			</ul>
			<div class="topBar">
				<div class="topBarInner">
					<input type="text" placeholder="请输入搜索内容" class="search_input">
					<img src="../../images/assistant/sousuokuang.png" class="search_btn">
					<button type="button" class="rankBtn">排行榜</button>
					<button type="button" class="newBtn">新建题目</button>
					<button type="button" class="chooseBtn">从题库选择题目</button>
				</div>
			</div>

			<div class="mainCon">
				<ul class="navigate">
					<el-tree :data="data" :props="defaultProps" @node-click="handleNodeClick"></el-tree>
				</ul>

				<div class="rightCon">
					<ul class="top_navigate">
						<!-- <li cateid="5">问答题</li> -->
						<li cateid="4">判断题</li>
						<li cateid="1">选择题</li>
						<li class="li_on2" cateid="0">全部</li>
					</ul>

					<div class="problemOuter">
						<!--选择题-->
						<div class="problemBox" id='problemBox_done'>
							<div class="problemCon clearfix">
								<span class="choice_span">
									选
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。( )
								</p>
							</div>
							<div class="remark">
								<span style="background-color:transparent;">难度：</span>
								<div class="starcon">
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
								</div>
								<span>诊断学</span>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<h4>A、锁骨中线第2肋间</h4>
									<h4>B、锁骨中线第2肋间</h4>
									<h4>C、锁骨中线第2肋间</h4>
									<h4>D、锁骨中线第2肋间</h4>
									<h4>E、锁骨中线第2肋间</h4>
									<p>
										<span>正确答案：</span>A
									</p>
								</div>
								<div class="btnCon">
									<button class="askBtn">提问</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="delBtn">删除</button>
								</div>
							</div>
						</div>
						<!--问答题-->
						<div class="problemBox">
							<div class="problemCon clearfix">
								<span class="essay_span">
									问
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。
								</p>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<p>
										<span>正确答案：</span>问答题的答案
									</p>
								</div>
								<div class="btnCon">
									<button class="askBtn">提问</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="delBtn">删除</button>
								</div>
							</div>
						</div>
						<!--判断题-->
						<div class="problemBox">
							<div class="problemCon clearfix">
								<span class="judge_span">
									判
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。
								</p>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<p>
										<span>正确答案：</span>正确
									</p>
								</div>
								<div class="btnCon">
									<button class="askBtn">提问</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="delBtn">删除</button>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</body>
	
	<script type="text/javascript">
		var vm;

		$('.chooseBtn').click(function() {//打开iframe
			open_dialog('choose_problem_cs.html');//打开从题目中选择题目弹窗
		});

		$('.newBtn').click(function() {//打开iframe
			open_dialog('create_problem_cs.html');//打开创建题目弹窗
		});

		$('.rankBtn').click(function() {
			window.location.href = 'ranking_list.html';
		});

		function nav_style_change(){//左边导航栏点击的效果
			$('.navigate li').click(function() {
				$('.navigate li').removeClass('li_on');
				$('.navigate li').addClass('li_not_on');
				$(this).removeClass('li_not_on');
				$(this).addClass('li_on');
			});
		}
		
		//上部导航栏点击的效果
		$('.rightCon>ul li').click(function() {
			$('.rightCon>ul li').removeClass('li_on2');
			$(this).addClass('li_on2');
		});

		function left_nav_filter(){//左侧导航栏筛选数据
			$('.navigate li').click(function() {
				var learnid = $(this).attr('learnid');
				var value = $('.search_input').val().trim();
				if ( value == '' ){
					value = null;
					changepage('learnid='+learnid);
				}else{
					changepage('searchlike='+value+'&learnid='+learnid);
				}
				if( learnid == 0 ){
					learnid = null;
				}
				getPresentProblem({searchlike:value,learnid:learnid});
				top_nav_restore();//上边导航栏还原成初始
				
			});
		}

		function top_nav_filter(){//上侧导航栏筛选数据
			$('.rightCon>ul li').click(function() {
				var learnid = $('.li_on').attr('learnid');
				var cateid = $(this).attr('cateid');
				var value = $('.search_input').val().trim();
				if ( value == '' ){
					value = null;
					changepage('learnid='+learnid+'&cateid='+cateid);
				}else{
					changepage('searchlike='+value+'&learnid='+learnid+'&cateid='+cateid);
				}
				if( learnid == 0 ){
					learnid = null;
				}
				if( cateid == 0 ){
					cateid = null;
				}
				getPresentProblem({searchlike:value,learnid:learnid,cateid:cateid});
				
			});
		}

		function slide_answer(){//每道题点击的效果
			for ( var i = 0; i < $('.problemBox').length; i++ ){
				if( $('.problemBox').eq(i).attr('status') != 0 ){
					$('.problemBox').eq(i).click(function() {
						if( $(this).find('.hidden_area').css('display') == 'block' ){
							$(this).find('.hidden_area').slideUp();//把之前展开开过的收起
							$(this).removeClass('problemBox_on');
						}else{
							$('.hidden_area').slideUp();
							$(this).find('.hidden_area').slideDown();//展开题目
							$('.problemBox').removeClass('problemBox_on');
							$(this).addClass('problemBox_on');
						}
					});
				}

			}
		}

		function addlearnType(){//生成左侧导航栏
			var json = {
				'1':{
					command:'question/selectquestionslearninfo', //接口地址
					sessionid:getCookie('sid'),
					loginid:getCookie('loginid'),
					scheduleid:getCookie('scheduleid')
				}
			};

			Api.dataToJava({
				json:{
					url:'/question/selectquestionslearninfo', //一次性走几个接口
					data:JSON.stringify(json)
				},
				fn:function (base) {
					base = base[1]; //取接口的第一个返回值
					console.log(base);
					
					//判断接口是否走成功， errcode为0是成功
					if (base.errcode!=0) {
						uselayer(3,base.errdesc);
						return false;
					}
					var learnids = base.resultlist;//训练项数组
					$('.navigate').html('');
					var str = '';
					str += '<li class="li_on" learnid="0">全部类型</li>';
					var has_other = 0;
					for ( var i = 0; i < learnids.length; i++ ){
						if( learnids[i].id == -1 ){
							has_other = 1; continue;
						}
						str += '<li class="li_not_on" learnid="'+learnids[i].id+'">'+learnids[i].name+'</li>';
					}
					if ( has_other == 1 ){
						str += '<li class="li_not_on" learnid="-1">其他</li>';
					}
					
					$('.navigate').html(str);
					nav_style_change();//左边导航栏点击的效果
					left_nav_filter();//左侧导航栏筛选数据
					recover();//子页面返回后根据记录呈现之前状态
				}
			});
		}

		function fuzzy_query(){//模糊查询-通过输入框查询题目
			$('.search_btn').click(function() {
				var value = $('.search_input').val().trim();
				if ( value == '' ){
					uselayer(3,'请输入搜索内容!');
					return false;
				}
				getPresentProblem({searchlike:value});
				left_nav_restore();//左边导航栏还原成初始
				top_nav_restore();//上边导航栏还原成初始
				changepage('searchlike='+value);
			});
		}
		
		function left_nav_restore(){//左边导航栏还原成初始
			$('.navigate li').removeClass('li_on');
			$('.navigate li').addClass('li_not_on');
			$('.navigate li').eq(0).removeClass('li_not_on');
			$('.navigate li').eq(0).addClass('li_on');
		}
		function top_nav_restore(){//上边导航栏还原成初始
			$('.rightCon>ul li').removeClass('li_on2');
			$('.rightCon>ul li').eq(2).addClass('li_on2');
		}

		function get_scheduleid(){//查询课程表id
			addlearnType();//生成左侧导航栏
			top_nav_filter();//上侧导航栏筛选数据
			fuzzy_query();//模糊查询-通过输入框查询题目
		}

		function getPresentProblem(obj){//获取当堂课的题目
			obj.learnid = obj.learnid || null;
			obj.cateid = obj.cateid || null;
			obj.searchlike = obj.searchlike || null;
			var json = {
				'1':{
					command:'question/queryquestions', //接口地址
					scheduleid:getCookie('scheduleid'),
					sessionid:getCookie('sid'),
					loginid:getCookie('loginid'),
					learnid:obj.learnid,
					cateid:obj.cateid,
					searchlike:obj.searchlike,
				}
			};

			Api.dataToJava({
				json:{
					url:'/question/queryquestions', //一次性走几个接口
					data:JSON.stringify(json)
				},
				fn:function (base) {
					base = base[1]; //取接口的第一个返回值
					console.log(base);
					
					//判断接口是否走成功， errcode为0是成功
					if (base.errcode!=0) {
						uselayer(3,base.errdesc);
						return false;
					}

					var problem_list = base.questionsresult;
					if( problem_list.length == 0 ){
						uselayer(3,'当前没有查询到题目!');
					}
					var str = '';
					for ( var i = 0; i < problem_list.length; i++ ){
						var str1;
						if( problem_list[i].issend == 1 ){
							str1 = '<div class="problemBox" id="problemBox_done" status="0" qid="'+problem_list[i].qid+'" cateid="'+problem_list[i].cateid+'">';
						}else{
							str1 = '<div class="problemBox" status="1" qid="'+problem_list[i].qid+'" cateid="'+problem_list[i].cateid+'">';
						}
						var cateid = problem_list[i].cateid;
						if ( cateid == 1 ){//单选
							str +=
							str1+
								'<div class="problemCon clearfix">'+
									'<span class="choice_span">'+
										'选'+
									'</span>'+
									'<p>'+
										problem_list[i].name+'( )'+
									'</p>'+
								'</div>'+

								'<div class="hidden_area clearfix">'+
									'<div class="hidden_left">';
										
										for ( var j = 0; j < problem_list[i].questionitem.length; j++ ){
											var name = problem_list[i].questionitem[j].itemname;
											var content = problem_list[i].questionitem[j].content;
											str +=
											'<h4>'+name+'、'+content+'</h4>';
										}

										str +=
										'<p>'+
											'<span>正确答案：</span>'+problem_list[i].answer+
										'</p>'+
									'</div>'+
									'<div class="btnCon">'+
										'<button class="askBtn">提问</button>'+
										'<button class="qiangdaBtn">抢答</button>'+
										'<button class="delBtn">删除</button>'+
									'</div>'+
								'</div>'+
							'</div>';

						}else if( cateid == 5 ){//问答题(暂时不考虑问答题)
							// str +=
							// str1+
							// 	'<div class="problemCon clearfix">'+
							// 		'<span class="essay_span">'+
							// 			'问'+
							// 		'</span>'+
							// 		'<p>'+
							// 			problem_list[i].name+
							// 		'</p>'+
							// 	'</div>'+

							// 	'<div class="hidden_area clearfix">'+
							// 		'<div class="hidden_left">'+
							// 			'<p>'+
							// 				'<span>正确答案：</span>'+problem_list[i].answer+
							// 			'</p>'+
							// 		'</div>'+
							// 		'<div class="btnCon">'+
							// 			'<button class="askBtn">提问</button>'+
							// 			'<button class="qiangdaBtn">抢答</button>'+
							// 			'<button class="delBtn">删除</button>'+
							// 		'</div>'+
							// 	'</div>'+
							// '</div>';

						}else if( cateid == 4 ){//判断题
							var answer = '正确';
							if( problem_list[i].answer == 0 ){
								answer = '错误';
							}
							str +=
							str1+
								'<div class="problemCon clearfix">'+
									'<span class="judge_span">'+
										'判'+
									'</span>'+
									'<p>'+
										problem_list[i].name+
									'</p>'+
								'</div>'+

								'<div class="hidden_area clearfix">'+
									'<div class="hidden_left">'+
										'<p>'+
											'<span>正确答案：</span>'+answer+
										'</p>'+
									'</div>'+
									'<div class="btnCon">'+
										'<button class="askBtn">提问</button>'+
										'<button class="qiangdaBtn">抢答</button>'+
										'<button class="delBtn">删除</button>'+
									'</div>'+
								'</div>'+
							'</div>';

						}
					}
					$('.problemOuter').html(str);
					slide_answer();//每道题点击的效果
					edit_problem();//删除,提问,抢答按钮点击
				}
			});
		}

		//每次操作后记录当前状态，当子页面返回后根据记录呈现之前状态 findurltype changepage
		function recover(){
			if(findurltype('searchlike')!='' && findurltype('learnid')=='' && findurltype('cateid')==''){
				$('.search_btn').val(findurltype('searchlike'));
				$('.search_btn').click();
			}else if(findurltype('learnid')!='' && findurltype('cateid')==''){
				$('.search_btn').val(findurltype('searchlike'));
				$('.navigate li[learnid='+findurltype('learnid')+']').click();
			}else if(findurltype('cateid')!=''){
				$('.search_btn').val(findurltype('searchlike'));
				
				$('.navigate li').removeClass('li_on');
				$('.navigate li').addClass('li_not_on');
				$('.navigate li[learnid='+findurltype('learnid')+']').removeClass('li_not_on');
				$('.navigate li[learnid='+findurltype('learnid')+']').addClass('li_on');

				$('.top_navigate li[cateid='+findurltype('cateid')+']').click();
			}else{
				$('.navigate li').eq(0).click();//默认状态加载数据
			}
		}
		
		function edit_problem(){//删除,提问,抢答按钮点击
			$('.btnCon button').click(function(e) {
				e.stopPropagation();
			});
			var scheduleid = getCookie('scheduleid');
			$('.delBtn').click(function() {
				var qid = $(this).parents('.problemBox').attr('qid');
				var cateid = $(this).parents('.problemBox').attr('cateid');
				open_dialog('delete_problem_window_cs.html?qid='+qid+'&scheduleid='+scheduleid+'&cateid='+cateid);//打开删除题目弹窗
			});
			$('.qiangdaBtn').click(function() {
				var qid = $(this).parents('.problemBox').attr('qid');
				var cateid = $(this).parents('.problemBox').attr('cateid');
				open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+scheduleid+'&type=qiangda'+'&cateid='+cateid);
			});
			$('.askBtn').click(function() {
				var qid = $(this).parents('.problemBox').attr('qid');
				var cateid = $(this).parents('.problemBox').attr('cateid');
				open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+scheduleid+'&type=ask'+'&cateid='+cateid);
			});
		}

		
		// $('.problemOuter').html(''); //最后解开

		gotC.init({
            fn:function(){

            },
            current_course_info:true//是否需要获取课程信息
        });
        vm=new Vue({//最后放到gotC fn里面去
			el:"#vue_control",
			data:{
				data: [{
		          label: '一级 1',
		          children: [{
		            label: '二级 1-1',
		            children: [{
		              label: '三级 1-1-1'
		            }]
		          }]
		        }],
		        defaultProps: {
		          children: 'children',
		          label: 'label'
		        }
			},
			methods:{
				handleNodeClick(data) {
			        console.log(data);
			    }
			},
			created:function(){
			},
			mounted:function(){
				get_scheduleid();//查询课程表id
			},
			updated:function(){

			},
			watch:{
			},
			computed:{
				
			}
		})
	</script>

</html>
