<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/assistant/layout.js" ></script>
		<script src="../../js/vue.js"></script>
		<script src="../../js/element.js"></script>
		<link rel="stylesheet" type="text/css" href="../../css/element.css">
		<meta charset="UTF-8">
		<title>互动问答主页</title>
		<style type="text/css">
			body{
				background-color:#ECECEC; padding-bottom:20px; height:100%;
			}
			#vue_control{
				height:100%; overflow:auto;
			}
			.isprepare{
				display:flex; width:1024px; margin:5px auto; justify-content:space-between;
			}
			.isprepare ul{
				display:flex;
			}
			.isprepare li{
				margin:0 10px; cursor:pointer;
			}
			.isprepare span{
				color:#0496C9; cursor:pointer;
			}
			.isprepare_li_on{
				color: #0496C9;
    			text-decoration: underline;
			}
			
			.topBar {
			    width:100%; height:60px; background-color:#f5f5f5; border-top:1px solid #dcdcdc;
			    border-bottom:1px solid #dcdcdc; font-size:14px;
			}
			.topBarInner{
				width:1024px; height:100%; margin:auto;
			}

			.rankBtn:hover,.newBtn:hover {
			    background-color: #f2fafc;
			}
			.topBar button {
			    display:block; float:right; position:relative;
			    top:50%; margin-top:-18px; height:38px; text-align:center; line-height:36px;
			    border:1px solid #0496C9; box-sizing:border-box; border-radius:3px;
			    
			}
			.rankBtn{
				width:88px; background-color:#ffffff; color:rgb(4,150,202);
			}
			.newBtn{
				width:88px; margin-right:12px; background-color:#ffffff; color:rgb(4,150,202);
			}
			.chooseBtn{
				width:118px; margin-right:12px; background-color:#0496ca; color:white;
			}
			.chooseBtn:hover{
				background-color:#0487b5;
			}

			.topBar input{
				float:left; display:block;
    			border:1px solid #CCCCCC; width:288px; height:36px;
    			line-height:36px; padding-left:10px; padding-right:36px;
    			top:50%; margin-top:-19px; position:relative;
    			border-radius:3px;
			}
			.topBar img{
				width:16px; height:16px; float:left; top:50%; cursor:pointer;
			    position:relative; margin-left:-28px; margin-top:-9px;
			}

			.mainCon{
				width:1024px; margin:auto; margin-top:20px;
				display:flex; align-items:stretch;
			}
			._navigate{
				width:174px; background-color:white;
				font-size:14px; border-radius:5px; overflow-y:auto;
				margin-right:10px;
			}
			.rightCon{
				flex:1; background-color:white; border-radius:5px;
				overflow-y:auto; padding-left:30px; padding-right:30px;
			}
			.rightCon>ul{
				width:100%; height:15px; margin-top:12px; margin-bottom:12px;
				font-size:14px;
			}
			.rightCon>ul li{
				float:right; display:block; margin-left:18px; cursor:pointer;
			}
			.li_on2{
				color:#0496C9; text-decoration:underline;
			}
			.problemOuter{
				width:100%;
			}
			.problemBox{
				width:100%; border:1px solid transparent; margin-bottom:10px;
			}
			#problemBox_done>div>span{
				background-color:#CCCCCC;
			}
			#problemBox_done>div>p,#problemBox_done .remark{
				color:#CCCCCC;
			}
			#problemBox_done .remark .subject_label{
				color:#ffffff;
			}
			.problemBox_on{
				border:1px solid #CCCCCC; border-radius:3px;
			}
			.problemBox:hover{
				border:1px solid #CCCCCC; border-radius:3px;
			}
			#problemBox_done:hover{
				border:1px solid transparent; border-radius:3px;
			}
			.problemCon{
				width:100%; padding:10px;
			}
			.problemCon span{
				display:block; border-radius:18px; width:28px; height:28px;
				float:left; text-align:center; line-height:28px; font-size:12px;
				color:white; margin-right:10px;
			}
			.judge_span{
				background-color:#0495CA;
			}
			.choice_span{
				background-color:#2CC877;
			}
			.remark{
				display:flex; padding:0 10px 10px 50px; font-size:14px;
			}
			.remark .starcon{
				display:flex; padding-right:30px;
			}
			.starcon img{
				width:24px;
			}
			.remark .subject_label{
				background-color:#e4e8f1; margin-right: 5px; padding:2px 5px;
				border-radius:2px;
			}
			.essay_span{
				background-color:#FFC928;
			}
			.problemCon p{
				float:left; font-size:14px; line-height:20px; padding-top:5px;
				width:660px;
			}
			.hidden_area{
				padding-bottom:20px; padding-left:45px; padding-right:30px;
				position:relative; display:none;
			}
			
			.hidden_left{
				width:75%; float:left; min-height:45px; padding-right:20px;
				color:rgb(51,51,51);
			}
			.hidden_left>p{
				width:100%; font-size:16px;
				line-height:20px; padding-top:10px;
			}
			.hidden_left>h4{
				width:100%; line-height:18px; font-size:14px; padding-top:5px; padding-bottom:5px;
			}
			
			.btnCon{
				width:141px; height:45px; position:absolute; bottom:20px;
				right:30px; font-size:15px; color:white;
			}
			.btnCon button{
				width:33%; display:block; height:100%; float:left;
				text-align:center; line-height:45px; border:0;
			}
			.askBtn{
				background-color:#2cc779;
			}
			.qiangdaBtn{
				background-color:#2598E9;
			}
			.editBtn{
				background-color:#999999;
			}
			.randomBtn{
				background-color:#ff5640;
			}

			/*分页*/
			.pagination_con{
				width:1024px; margin:20px auto 0;
			}
			/*新建题目对话框*/
			.newproblem{
				width:400px; border-radius:5px; background-color:#ffffff;
				overflow:hidden; display:none; padding:0 15px 20px;
			}
			.newproblem .topCon{
				width:100%; height:60px;
				color:rgb(51,51,51);
			}
			.newproblem .topCon h2{
				height:100%; float:left; line-height:60px; font-size:19px;
			}
			.newproblem .topCon span{
				width:22px; height:22px; float:right; display:block; position:relative;
				top:50%; margin-top:-11px; cursor:pointer;
				background-image:url('../../images/assistant/guanbi-tanchuang.png');
				background-size:100% 100%;
				background-repeat:no-repeat;
			}
			.newproblem .topCon img{
				width:100%; height:100%; display:none;
			}
			.newproblem .topCon span:hover img{
				display:block;
			}
			.newproblem .footerBtn{
				width:100%; height:38px;
			}
			.newproblem .footerBtn button{
				display:block; float:right; width:112px; height:38px; border-radius:3px;
				font-size:16px; text-align:center; line-height:38px; box-sizing:border-box;
			}
			.newproblem .closeBtn{
				border:1px solid #c3c3c3; background-color:#ffffff;
			}
			.newproblem .closeBtn:hover{
				background-color:#f2f2f2; border:1px solid #999999;
			}
			.newproblem .saveBtn{
				background-color:#0496ca; margin-right:20px; color:white;
			}
			.newproblem .saveBtn:hover{
				background-color:#0487b5;
			}
			.newproblem .newproblem_con{
				width:100%; display:flex; justify-content:center;
				align-items:center; margin:20px 0 40px;
			}

			.el-select-dropdown{/*element下拉菜单调整*/
				z-index:19921121 !important;
			}
			
		</style>	
		
		
	</head>
	<body>
		<div id="vue_control" v-cloak>
			<!-- 头部筛选是否是备课 -->
			<div class="isprepare">
				<ul>
					<li :class="{isprepare_li_on:isprepare==0}" @click="isprepare=0">我的备课</li>
					<li @click="isprepare=1"  :class="{isprepare_li_on:isprepare==1}">全部题库</li>
				</ul>
				<span v-if="isprepare==0" @click="course_test()">随堂小测</span>
			</div>
			<div class="topBar">
				<div class="topBarInner">
					<input type="text" placeholder="输入题干关键词" v-model.trim="keyword">
					<img src="../../images/assistant/sousuokuang.png" @click="fuzzy_query()">
					<button type="button" class="rankBtn" @click="ranking_list()">排行榜</button>
					<button type="button" class="newBtn" @click="newproblem()">新建题目</button>
				</div>
			</div>

			<div class="mainCon">
				<ul class="_navigate">
					<el-tree :data="tree" :props="defaultProps" @node-click="handleNodeClick" :highlight-current="true"></el-tree>
				</ul>

				<div class="rightCon">
					<ul class="top_navigate">
						<!-- <li cateid="5">问答题</li> -->
						<li @click="change_cateid(4)" :class="{li_on2:cateid==4}">判断题</li>
						<li @click="change_cateid(2)" :class="{li_on2:cateid==2}">多选题</li>
						<li @click="change_cateid(1)" :class="{li_on2:cateid==1}">单选题</li>
						<li @click="change_cateid(9)" :class="{li_on2:cateid==9}">全部</li>
					</ul>

					<div class="problemOuter">
						<!--选择题-->
						<!-- <div :class="{problemBox:true,problemBox_on:0==problemindex}" id='problemBox_done' @click="slide_answer({status:0,index:0,id:0});">
							<div class="problemCon clearfix">
								<span class="choice_span">
									选
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。( )
								</p>
							</div>
							<div class="remark">
								<span style="background-color:transparent;">难度：</span>
								<div class="starcon">
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
								</div>
								<span class="subject_label">诊断学</span>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<h4>A、锁骨中线第2肋间</h4>
									<h4>B、锁骨中线第2肋间</h4>
									<h4>C、锁骨中线第2肋间</h4>
									<h4>D、锁骨中线第2肋间</h4>
									<h4>E、锁骨中线第2肋间</h4>
									<p>
										<span>正确答案：</span>A
									</p>
								</div>
								<div class="btnCon">
									<button class="randomBtn">随机回答</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="askBtn">全员回答</button>
								</div>
							</div>
						</div> -->
						
						<!--判断题-->
						<!-- <div :class="{problemBox:true,problemBox_on:1==problemindex}" @click="slide_answer({status:1,index:1,id:1});">
							<div class="problemCon clearfix">
								<span class="judge_span">
									判
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。
								</p>
							</div>
							<div class="remark">
								<span style="background-color:transparent;">难度：</span>
								<div class="starcon">
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
								</div>
								<span class="subject_label">诊断学</span>
							</div>
							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<p>
										<span>正确答案：</span>正确
									</p>
								</div>
								<div class="btnCon">
									<button class="randomBtn">随机回答</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="askBtn">全员回答</button>
								</div>
							</div>
						</div> -->

						<!--选择题-->
						<!-- <div :class="{problemBox:true,problemBox_on:2==problemindex}" @click="slide_answer({status:1,index:2,id:2});">
							<div class="problemCon clearfix">
								<span class="choice_span">
									选
								</span>
								<p>
									疑为胸腔包虫病患者，穿刺可引起感染扩散，不宜穿刺。( )
								</p>
							</div>
							<div class="remark">
								<span style="background-color:transparent;">难度：</span>
								<div class="starcon">
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
									<img src="../../images/assistant/star.png"/>
								</div>
								<span class="subject_label">诊断学</span>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left">
									<h4>A、锁骨中线第2肋间</h4>
									<h4>B、锁骨中线第2肋间</h4>
									<h4>C、锁骨中线第2肋间</h4>
									<h4>D、锁骨中线第2肋间</h4>
									<h4>E、锁骨中线第2肋间</h4>
									<p>
										<span>正确答案：</span>A
									</p>
								</div>
								<div class="btnCon">
									<button class="randomBtn">随机回答</button>
									<button class="qiangdaBtn">抢答</button>
									<button class="askBtn">全员回答</button>
								</div>
							</div>
						</div> -->

						<div :class="{problemBox:true,problemBox_on:i==problemindex}"
							@click="slide_answer({status:1,index:i,id:item.questionbaseid});"
							v-for="(item,i) in questionlist">
							<div class="problemCon clearfix">
								<span class="choice_span" v-if="item.questiontypeid==1 || item.questiontypeid==2">
									选
								</span>
								<span class="judge_span" v-else-if="item.questiontypeid==4">
									判
								</span>
								<div style="float: left; padding: 5px 5px 0;">{{i+1}}.</div>
								<p>
									{{item.questionname}}
								</p>
							</div>
							<div class="remark">
								<span style="background-color:transparent;">难度：</span>
								<div class="starcon">
									<img
										v-for="(item2,j) in item.difficult"
										src="../../images/assistant/star.png"/>
								</div>
								<span class="subject_label" v-for="(label,k) in item.lablist">
									{{label.name}}
								</span>
							</div>

							<div class="hidden_area clearfix">
								<div class="hidden_left" v-if="item.questiondetail">
									<h4 v-for="(option,j) in item.questiondetail.questionitem" v-if="item.questiontypeid!=4">
										{{option.itemname}}、{{option.content}}
									</h4>
									<p>
										<!-- 选择题 -->
										<span v-if="item.questiontypeid==4">
											正确答案：
											<template v-if="item.questiondetail.answer==1">正确</template>
											<template v-if="item.questiondetail.answer==0">错误</template>
										</span>
										<!-- 判断题 -->
										<span v-if="item.questiontypeid==1 || item.questiontypeid==2">
											正确答案：{{item.questiondetail.answer}}
										</span>
									</p>
								</div>
								<div class="btnCon">
									<button class="randomBtn"
										@click.stop="allAnswer(item.questionid,item.questionbaseid,item.questiontypeid)">
										提问
									</button>
									<button class="qiangdaBtn" @click.stop="qiangda(item.questionid,item.questionbaseid,item.questiontypeid)">
										抢答
									</button>
									<button class="askBtn"
										@click.stop="deletequestion(item.questionbaseid,item.questiontypeid)">
										删除
									</button>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
			<div class="pagination_con"v-show="allcount>0">
				<el-pagination layout="prev, pager, next" :total="allcount" @current-change="pagechange" :current-page.sync="current_page">
				</el-pagination>
			</div>
			<div class="newproblem">
				<div class="topCon">
					<h2>新建题目</h2>
					<span class="closeSpan" @click="close_newproblem()">
						<img src="../../images/assistant/guanbi-tanchuang-h.png">
					</span>
				</div>
				<div class="newproblem_con">
					<span>题目类型：</span>
					<el-select v-model="questiontype" filterable placeholder="请选择要创建的题型">
						<el-option v-for="item in questiontypelist" :key="item.value"
							:label="item.label" :value="item.value">
						</el-option>
					</el-select>
				</div>
				<div class="footerBtn">
					<button class="closeBtn" @click="close_newproblem()">取消</button>
					<button class="saveBtn" @click="newproblemiframe()">确定</button>
				</div>
			</div>
		</div>
	</body>
	
	<script type="text/javascript">
		var vm;

		gotC.init({
            fn:function(){
				vm=new Vue({//最后放到gotC fn里面去
					el:"#vue_control",
					data:{
						Math:Math,
						problemindex:-1,
						isprepare:0,//是否是我的备课或者全部题库(0我的备课,1全部题库)
						tree:[],
				        defaultProps: {
				          children: 'children',
				          label: 'label'
				        },
				        cateid:9,//保存当前选择的题目类型 0全部 1选择题 2判断题
				        questionlist:[],//题目列表
				        keyword:'',//搜索的关键词
				        questiontypelist:[//题目类型
				        	{label:'单选',value:0},
				        	{label:'多选',value:1},
				        	{label:'判断',value:2}
				        ],
				        questiontype:'',//问题创建对话框中选择的问题类型
				        newproblem_dialog_index:0,//记录新建题目弹窗的index
				        filter_type:1,//保存过滤条件类型  1.我的备课/全部题库 2.模糊搜索 3.学科 4.全部/单选/多选/判断
				        allcount:0,//保存返回的题目总条数
				        courseid:'',
				        current_page:1,
					},
					methods:{
						course_test:function(){//打开随堂小测
							window.location.href = 'newtest.html';
						},
						qiangda:function(qid,questionbaseid,cateid){//抢答
							if(this.isprepare == 0){//我的备课
								open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+getCookie('scheduleid')+'&type=qiangda'+'&cateid='+cateid+'&questionbaseid='+questionbaseid);
							}else{
								Api.dataToJava({
									json:{
										url:'/course/choosequestions',
										data:JSON.stringify({
											'1':{
												command:'question/choosequestions',
												scheduleid:getCookie('scheduleid'),
												sessionid:getCookie('sid'),
												delqids:[],
												addqids:[{qid:qid}],
												loginid:getCookie('loginid')
											}
										})
									},
									fn:function (base) {
										base = base[1];
										if (base.errcode!=0) {
											uselayer(3,base.errdesc);
											return false;
										}
										open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+getCookie('scheduleid')+'&type=qiangda'+'&cateid='+cateid+'&questionbaseid='+questionbaseid);
									}
								});
							}
						},
						allAnswer:function(qid,questionbaseid,cateid){//提问
							if(this.isprepare == 0){//我的备课
								open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+getCookie('scheduleid')+'&type=ask'+'&cateid='+cateid+'&questionbaseid='+questionbaseid);
							}else{
								Api.dataToJava({
									json:{
										url:'/course/choosequestions',
										data:JSON.stringify({
											'1':{
												command:'question/choosequestions',
												scheduleid:getCookie('scheduleid'),
												sessionid:getCookie('sid'),
												delqids:[],
												addqids:[{qid:qid}],
												loginid:getCookie('loginid')
											}
										})
									},
									fn:function (base) {
										base = base[1];
										if (base.errcode!=0) {
											uselayer(3,base.errdesc);
											return false;
										}
										open_dialog('send_problem_cs.html?qid='+qid+'&scheduleid='+getCookie('scheduleid')+'&type=ask'+'&cateid='+cateid+'&questionbaseid='+questionbaseid);
									}
								});
							}
						},
						deletequestion:function(qid,cateid){//删除问题
							var self = this;
							var index = layer.confirm('确定要删除该问题吗？',function(){
								var json = {
									'1':{
										command:'question/deletequestion',
										sessionid:getCookie('sid'),
										loginid:getCookie('loginid'),
										uid:getCookie('loginid'),
										questionid:qid,
									}
								};
								Api.dataToJava({
									isShade:1,
									json:{
										url:'/question/deletequestion', //一次性走几个接口
										data:JSON.stringify(json)
									},
									fn:function (base) {
										base = base[1]; //取接口的第一个返回值
										
										//判断接口是否走成功， errcode为0是成功
										if (base.errcode!=0) {
											uselayer(3,base.errdesc);
											return false;
										}
										layer.msg('删除成功！');
										self.pagechange(self.current_page);//重新获取数据
									}
								});
								layer.close(index);
							});
						},
						handleNodeClick:function(data) {
							if(data.value == 1){
								return false;
							}
							var keyword = this.keyword;
							var cateid = this.cateid;
					        if( this.isprepare == 0 ){//我的备课
								this.queryselectedquestion({categoryid:data.value,page:1,reqnum:10,questionname:keyword,questiontypeid:cateid});
							}else{//全部题库
								this.queryquestionlist({categoryid:data.value,page:1,reqnum:10,questionname:keyword,questiontypeid:cateid});
							}
							this.courseid = data.value;
							this.filter_type = 3;
							this.current_page = 1;
					    },
					    newproblem:function(){//打开创建题目弹窗
					    	var self = this;
							layer.open({
								type: 1,
								closeBtn: 0,
								// shade:'transparent',
								title:false,
								area: 'auto',
								maxWidth:'700px',
								skin: 'layui-layer-nobg', //没有背景色
								shadeClose: false,
								content: $('.newproblem'),
								success: function(layero, index){
									self.newproblem_dialog_index = index;
								}
							});

					    },
					    close_newproblem:function(){//关闭创建题目弹窗
							layer.close(this.newproblem_dialog_index);
						},
						newproblemiframe:function(){//用iframe打开创建题目的页面
							if( this.questiontype === '' ){
								layer.msg('请选择要创建的题型！');
								return false;
							}
							this.close_newproblem();
							var href;
							if(this.questiontype==0){//单选
								href = '/teacherweb/index.html#/qmanage/newqdanxuan';
							}else if(this.questionlist==1){//多选
								href = '/teacherweb/index.html#/qmanage/newqduoxuan';
							}else{//判断
								href = '/teacherweb/index.html#/qmanage/newqpanduan';
							}
							layer.open({
		                        type: 2,
		                        title: '创建题目',
		                        shade: 0.1,
		                        area: ['90%','90%'],
		                        content: href,
		                        success: function(layero, index){
		                        	var body = layer.getChildFrame('body', index);
		                        	body.find('.header').css('display', 'none');
		                        	body.find('.main').css('margin-top','0');
		                        	body.find('.main').css('width','90%');
		                        	body.find('.pagetitle').children('button').css('display','none');
		                        }
		                    })
						},
					    ranking_list:function(){//打开创建题目弹窗
					    	window.location.href = 'ranking_list.html';
					    },
					    //每道题点击的效果(status位0说明题目已经使用过,index为索引,id是题目id)
					    slide_answer:function(opt){
					    	var self = this;
					    	var $problemBox =$('.problemBox').eq(opt.index);
							if( opt.status != 0 ){
								if( $problemBox.find('.hidden_area').css('display') == 'block' ){
									$problemBox.find('.hidden_area').slideUp();//把之前展开开过的收起
								}else{//展开该题目
									self.problemindex = opt.index;//记录当前打开的题目索引
									$('.hidden_area').slideUp();//把之前展开开过的收起
									$problemBox.find('.hidden_area').slideDown();//展开题目
								}
							}
						},
						queryselectedquestion:function(opt){//查询我的备课题目
							var self = this;
							var json = {
								'1':{
									command:'question/queryselectedquestion', //接口地址
									sessionid:getCookie('sid'),
									loginid:getCookie('loginid'),
									scheduleid:getCookie('scheduleid'),
									createperson:1,
								}
							};
							if( opt ){
								if( opt.questiontypeid && opt.questiontypeid == 9 ){
									opt.questiontypeid = '';
								}
								Object.assign(json[1],opt);
							}
							Api.dataToJava({
								isShade:1,
								json:{
									url:'/question/queryselectedquestion', //一次性走几个接口
									data:JSON.stringify(json)
								},
								fn:function (base) {
									base = base[1]; //取接口的第一个返回值
									
									//判断接口是否走成功， errcode为0是成功
									if (base.errcode!=0) {
										uselayer(3,base.errdesc);
										return false;
									}
									self.questionlist = base.questionlist;
									self.allcount = base.allcount;
									self.questiondetail();
								}
							});
						},
						queryquestionlist:function(opt){//查询全部题库
							var self = this;
							var json = {
								'1':{
									command:'question/queryquestionlist', //接口地址
									sessionid:getCookie('sid'),
									loginid:getCookie('loginid'),
									scheduleid:getCookie('scheduleid'),
									createUid:getCookie('loginid'),
									createperson:1,
								}
							};
							if( opt ){
								Object.assign(json[1],opt);
							}
							Api.dataToJava({
								isShade:1,
								json:{
									url:'/question/queryquestionlist', //一次性走几个接口
									data:JSON.stringify(json)
								},
								fn:function (base) {
									base = base[1]; //取接口的第一个返回值
									
									//判断接口是否走成功， errcode为0是成功
									if (base.errcode!=0) {
										uselayer(3,base.errdesc);
										return false;
									}
									self.questionlist = base.questionlist;
									self.allcount = base.allcount;
									self.questiondetail();
								}
							});
						},
						questiondetail:function(){//查询每道题目的详细信息
							this.problemindex = -1;//还原记录当前选中的题目字段
							$('.hidden_area').slideUp();//把展开的题目收起来
							var self = this;
							$(self.questionlist).each(function(index, el) {
								(function(i){
									var json = {
										'1':{
											command:'question/querysinglequestion',
											sessionid:getCookie('sid'),
											loginid:getCookie('loginid'),
											questionbaseid:self.questionlist[i].questionbaseid,
										}
									};
									Api.dataToJava({
										isShade:1,
										json:{
											url:'/question/querysinglequestion',
											data:JSON.stringify(json)
										},
										fn:function (base) {
											base = base[1]; //取接口的第一个返回值
											
											//判断接口是否走成功， errcode为0是成功
											if (base.errcode!=0) {
												uselayer(3,base.errdesc);
												return false;
											}
											self.questionlist[i].questiondetail = base;
										}
									});
								})(index);
								
							});
						},
						fuzzy_query:function(){//模糊查询
							if(this.keyword.trim() == ''){
								layer.msg('请输入关键词进行搜索！');
								return false;
							}
							var cateid = this.cateid;
							var keyword = this.keyword;
							var categoryid = this.courseid;
							if( this.isprepare == 0 ){//我的备课
								this.queryselectedquestion({questionname:keyword,page:1,reqnum:10,questiontypeid:cateid,categoryid:categoryid});
							}else{//全部题库
								this.queryquestionlist({questionname:keyword,page:1,reqnum:10,questiontypeid:cateid,categoryid:categoryid});
							}
							this.filter_type = 2;
							this.current_page = 1;
						},
						change_cateid:function(cateid){//切换不同类别的题目
							if(this.cateid == cateid){
								return false;
							}
							var keyword = this.keyword;
							var categoryid = this.courseid;
							this.cateid = cateid;
							if( this.isprepare == 0 ){//我的备课
								this.queryselectedquestion({questiontypeid:cateid,page:1,reqnum:10,questionname:keyword,categoryid:categoryid});
							}else{//全部题库
								this.queryquestionlist({questiontypeid:cateid,page:1,reqnum:10,questionname:keyword,categoryid:categoryid});
							}
							this.filter_type = 4;
							this.current_page = 1;
						},
						pagechange:function(currentPage){//切换页数时的执行方法
							var self = this;
							var opt;
							//1.我的备课/全部题库 2.模糊搜索 3.学科 4.全部/单选/多选/判断
							// if(this.filter_type == 1){
							// 	opt={categoryid:9,page:currentPage,reqnum:10};
							// }else if(this.filter_type == 2){
							// 	opt={questionname:self.keyword,page:currentPage,reqnum:10};
							// }else if(this.filter_type == 3){
							// 	opt={categoryid:self.courseid,page:currentPage,reqnum:10};
							// }else{
							// 	opt={questiontypeid:self.cateid,page:currentPage,reqnum:10};
							// }
							opt={questiontypeid:self.cateid,categoryid:self.courseid,page:currentPage,reqnum:10,questionname:self.keyword};
							if(this.isprepare == 0){
								this.queryselectedquestion(opt);
							}else{//全部题库
								this.queryquestionlist(opt);
							}
						},
					},
					created:function(){
						
					},
					mounted:function(){
						var self = this;
						(function(){
							var json = {
								'1':{
									command:'question/questioncategorytree', //接口地址
									sessionid:getCookie('sid'),
									loginid:getCookie('loginid'),
								}
							};
							Api.dataToJava({
								json:{
									url:'/question/questioncategorytree', //一次性走几个接口
									data:JSON.stringify(json)
								},
								fn:function (base) {
									base = base[1]; //取接口的第一个返回值
									
									//判断接口是否走成功， errcode为0是成功
									if (base.errcode!=0) {
										uselayer(3,base.errdesc);
										return false;
									}
									self.tree = base.children;
								}
							});
							
						})();
						var opt={questiontypeid:self.cateid,categoryid:self.courseid,page:self.current_page,reqnum:10,questionname:self.keyword};
						self.queryselectedquestion(opt);//初始化是默认加载我的备课中的题目
					},
					updated:function(){

					},
					watch:{
						isprepare:function(val,oldval){//选择题库或者备课
							var self = this;
							//把其他筛选条件置为初始值
							this.keyword = '';
							this.cateid = 9;
							this.courseid = '';
							var opt={questiontypeid:self.cateid,categoryid:self.courseid,page:self.current_page,reqnum:10,questionname:self.keyword};
							if( val == 0 ){//我的备课
								this.queryselectedquestion(opt);
							}else{//全部题库
								this.queryquestionlist(opt);
							}
							this.filter_type = 1;
							this.current_page = 1;
						}
					},
					computed:{
						
					}
				});
            },
            current_course_info:true//是否需要获取课程信息
        });

	</script>

</html>
