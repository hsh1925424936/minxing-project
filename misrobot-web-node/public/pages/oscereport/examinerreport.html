<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考官考试报告</title>
    <link href="../../css/oscereport/report.css" rel="stylesheet" type="text/css">
</head>
<script src="../../js/jquery-3.1.1.min.js" charset="utf-8" type="text/javascript"></script>
<script src="../../js/echarts.min.js" charset="utf-8" type="text/javascript"></script>
<script src="../../layer/xie/layer1.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/oscereport/common.js" type="text/javascript" charset="utf-8"></script>

<body>
    <div id="container">
        <h2 id="testName">
        	<span class="return_span" onclick="history.go(-1);"><</span>OSCE考试考官分析报告
        </h2>
        <div class="contentbox">
            <div class="userinfo">
                <ul>
                    <li>
                        <span class="fontstyle">姓名</span>
                        <span class="usenm" id="examiner"></span>
                    </li>
                    <li>
                        <span class="fontstyle">工号</span>
                        <span class="usenm" id="jobNo"></span>
                    </li>
                    <li>
                        <span class="fontstyle">考站</span>
                        <span class="usenm" id="station"></span>
                    </li>
                    <li>
                        <span class="fontstyle">教室</span>
                        <span class="usenm" id="classroom"></span>
                    </li>
                    <li>
                        <span class="fontstyle">方式</span>
                        <span class="usenm" id="testWay"></span>
                    </li>
                </ul>
            </div>

            <div class="score">
                <div class="score-classfiy fontalgin">平均分</div>
                <div class="score-classfiy">
                    <span class="score-numb" id="avgScore1"></span> 分
                </div>
                <div class="score-classfiy fontalgin">通过率 <span id="passRate"></span>％</div>
            </div>

            <!--各考站成绩分析-->
            <div class="contentbox">
                <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabkeyvalue">
                    <tr>
                        <td colspan="2" style="text-align: center; background-color: #cccccc;">成绩关键点分值</td>
                    </tr>
                    <tr>
                        <td>项目</td>
                        <td>分值</td>
                    </tr>
                    <tr>
                        <td>最高分</td>
                        <td id="maxScore">-</td>
                    </tr>
                    <tr>
                        <td>中值</td>
                        <td id="mediuScore">-</td>
                    </tr>
                    <tr>
                        <td>平均分</td>
                        <td id="avgScore">-</td>
                    </tr>
                    <tr>
                        <td>最低分</td>
                        <td id="minScore">-</td>
                    </tr>
                </table>
            </div>

            <div class="distrivution">成绩区段人数分布</div>
            <div class="chart">
                <div class="covar"></div>
                <div id="main" style="width:100%; height: 350px;float:left;"></div>
            </div>
            
             <!-- 考生成绩列表 -->
            <div class="contentbox">
	            <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabscorelist">
	                <tr>
	                    <th colspan="7" style="text-align: center; background-color: #cccccc;">考生成绩列表</th>
	                </tr>
	                
	                <tr>
	                    <th style="width: 20%">排名</th>
	                    <th>姓名</th>
	                    <th>成绩</th>
	
	                </tr>
	            </table>
            </div>

        </div>
    </div>
    <script type="text/javascript">
	$( document ).ready(function() {
		if ( !GetQueryString('isjump') ){
			$('.return_span').remove();
		}
        //console.log(jsondata);

        /*
		数据格式：{"1":{"command": "report/testreport", "errdesc":"invalid command.","errcode":"11",
		   	   "reportinfo":
		{
			"basicinfo": {
			    “testName” : “OSCE考试考官分析报告”,
			        "examiner": "李天玉",
			        "jobNo": "777888",
			        "station": "第二站－病史分析",
			        "classroom": "601-1",
			        "testWay": "OSCE"
			    },
			    "keyValue": {
			        "maxScore": 90,
			        "mediuScore": 70,
			        "avgScore": 67.82,
			        "minScore": 48,
			        "passRate": 75.69,
			        "totalNum": 180
			    },
			    "sectiondistribution": {
			        "lessthan60": 9,
			        "s60to70": 82,
			        "s70to80": 41,
			        "s80to90": 34,
			        "morethan90": 14
			    }
			}}}
        */

        my_require.R({
			isShade:1,
			url:'/osce/report/examinerreport',
			data:{
				command:"osce/report/examinerreport",
				examid:GetQueryString('examid'),
				examinerid:GetQueryString('examinerid')
			},
			callback:function(base){
				console.log(base);
				if ( !base.reportinfo ){
					return false;
				}
				var jsondata = base.reportinfo;

				$("#testName").text(jsondata.basicinfo.testname + "考官分析报告");
            	$("#examiner").text(jsondata.basicinfo.examinername);
				$("#jobNo").text(jsondata.basicinfo.teachercode);  
				$("#station").text(jsondata.basicinfo.stationname);
				$("#classroom").text(jsondata.basicinfo.classroomno);
				$("#testtime").text(jsondata.basicinfo.testtime);
				if(jsondata.basicinfo.testway){
                	$("#testWay").text(jsondata.basicinfo.testway);
				}

				// 基于准备好的dom，初始化echarts实例
			    if(jsondata.keyvalue){
					if(jsondata.keyvalue.avgscore){
	                  $("#avgScore1").text(jsondata.keyvalue.avgscore.toFixed(2));
					  $("#avgScore").text(jsondata.keyvalue.avgscore.toFixed(2));
				    }
	              
					
				    if(jsondata.keyvalue.passrate != undefined){
	                  $("#passRate").text(((jsondata.keyvalue.passrate)*100).toFixed(2));
				    }

	                if(jsondata.keyvalue.maxscore){
	                    $("#maxScore").text(jsondata.keyvalue.maxscore.toFixed(2));
					}

					if(jsondata.keyvalue.medianscore){
	                    $("#mediuScore").text(jsondata.keyvalue.medianscore.toFixed(2));  
					}
	                
	                if(jsondata.keyvalue.minscore){
	                    $("#minScore").text(jsondata.keyvalue.minscore.toFixed(2));
	                }
				   
	            }
				if(jsondata.sectiondistribution && jsondata.keyvalue){
					var myChart = echarts.init(document.getElementById('main'));

					option = {
						title : {
							text: '总人数：' + jsondata.keyvalue.totalcount + '人',
							subtext: '',
							x:'right'
						},
						tooltip : {
							trigger: 'item',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						legend: {
							orient: 'vertical',
							left: 'left',
							data: ['60分以下：' + jsondata.sectiondistribution.lessthan60 + '人',
								'60－70分：' + jsondata.sectiondistribution['60to70'] + '人',
								'70－80分：' + jsondata.sectiondistribution['70to80'] + '人',
								'80－90分：' + jsondata.sectiondistribution['80to90'] + '人',
								'90－100分：' + jsondata.sectiondistribution.morethan90 + '人']
						},
						series : [
							{
								name: '访问来源',
								type: 'pie',
								radius : '30%',
								center: ['50%', '60%'],
								data:[
									{value: jsondata.sectiondistribution.lessthan60, name:'60分以下：' + jsondata.sectiondistribution.lessthan60 + '人'},
									{value: jsondata.sectiondistribution['60to70'], name:'60－70分：' + jsondata.sectiondistribution['60to70'] + '人',},
									{value: jsondata.sectiondistribution['70to80'], name:'70－80分：' + jsondata.sectiondistribution['70to80'] + '人'},
									{value: jsondata.sectiondistribution['80to90'], name:'80－90分：' + jsondata.sectiondistribution['80to90'] + '人'},
									{value: jsondata.sectiondistribution.morethan90, name:'90－100分：' + jsondata.sectiondistribution.morethan90 + '人'}
								],
								itemStyle: {
									emphasis: {
										shadowBlur: 10,
										shadowOffsetX: 0,
										shadowColor: 'rgba(0, 0, 0, 0.5)'
									}
								}
							}
						]
					};

		
					// 使用刚指定的配置项和数据显示图表。
					myChart.setOption(option);
	            }

				// 学生成绩列表
		        if(jsondata.rankinglist){
		           
				  var $tabscorelist = $("#tabscorelist");

				  for(var i=0; i< jsondata.rankinglist.length; i++){
		              
					var tmpstr = "<tr>";
		            var str1 = "<td style='width: 20%'>" +  jsondata.rankinglist[i].ranking + "</td>";
					tmpstr = tmpstr + str1;
					
		            var str2 = "<td>" +  jsondata.rankinglist[i].name + "</td>";
					tmpstr = tmpstr + str2;
					
					var str3 = "<td>" +  jsondata.rankinglist[i].score.toFixed(2) + "</td>";
				    tmpstr = tmpstr + str3;
				  
				    tmpstr = tmpstr + "</tr>";
				  
				    $tabscorelist.append(tmpstr);
				 
				  }
		  
		       }

			}
		});
		
		
    });   

    </script>
</body>
</html>