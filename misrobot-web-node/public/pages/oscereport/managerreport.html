<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者分析报告</title>
    <link href="../../css/oscereport/report.css" rel="stylesheet" type="text/css">
</head>
<script src="../../js/jquery-3.1.1.min.js" charset="utf-8" type="text/javascript"></script>
<script src="../../js/echarts.min.js" charset="utf-8" type="text/javascript"></script>
<script src="../../layer/xie/layer1.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/oscereport/common.js" type="text/javascript" charset="utf-8"></script>

<body>
    <div id="container">
        <h2 id="testName">管理者分析报告</h2>
        <div class="contentbox">
           
            <!--各考站成绩分析-->
            <div class="contentbox">
                <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabkeyvalue">
                    <tr>
                        <td colspan="2" style="text-align: center; background-color: #cccccc;">成绩关键点分值</td>
                    </tr>
                    <tr>
                        <td>项目</td>
                        <td>分值</td>
                    </tr>
                    <tr>
                        <td>最高分</td>
                        <td id="maxScore">-</td>
                    </tr>
                    <tr>
                        <td>中值</td>
                        <td id="mediuScore">-</td>
                    </tr>
                    <tr>
                        <td>平均分</td>
                        <td id="avgScore">-</td>
                    </tr>
                    <tr>
                        <td>最低分</td>
                        <td id="minScore">-</td>
                    </tr>
                </table>
            </div>

            <div class="distrivution">成绩区段人数分布</div>
            <div class="chart">
                <!--<div class="covar"></div>-->
                <div id="main" style="width:100%; height: 350px;float:left;"></div>
            </div>
            
            <!--试卷分析-->
        <div class="distrivution">试卷分析</div>
        <div class="chart">
            <div class="difficulty">难度：一般</div>
            <div id="main2" class="bord" style="width:100%; height: 240px;float:left;"></div>
        </div>

        <div class="chart">
            <div class="difficulty">区分度：中</div>
            <div id="main3" class="bord" style="width:100%; height: 240px;float:left;"></div>
        </div>
        
        <!-- 考生成绩列表 -->
        <div class="contentbox">
            <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabscorelist">
                <tr>
                    <th colspan="7" style="text-align: center; background-color: #cccccc;">考生成绩列表</th>
                </tr>
                
                <tr>
                    <th style="width: 20%">排名</th>
                    <th>姓名</th>
                    <th>成绩</th>

                </tr>
            </table>
        </div>
        
      </div>
      <div class="report_link_con">
    	
      </div>
    </div>
    <script type="text/javascript">
	$( document ).ready(function() {
		(function(){
			var examid = GetQueryString('examid');
			$('.report_link_con').html(
				'<a href="stulist.html?examid='+examid+'" class="report_link">查看考生报告>></a><br/>'+
	        	'<a href="examinerlist.html?examid='+examid+'" class="report_link">查看考官报告>></a>'
	        );
		})();
		

        /*
		数据格式：{"1":{"command": "report/testreport", "errdesc":"invalid command.","errcode":"11",
		   	   "reportinfo":
		{
			"basicinfo": {
			    “testName” : “OSCE考试考官分析报告”,
			        "examiner": "李天玉",
			        "jobNo": "777888",
			        "station": "第二站－病史分析",
			        "classroom": "601-1",
			        "testWay": "OSCE"
			    },
			    "keyvalue": {
			        "maxScore": 90,
			        "mediuScore": 70,
			        "avgScore": 67.82,
			        "minScore": 48,
			        "passRate": 75.69,
			        "totalNum": 180
			    },
			    "sectiondistribution": {
			        "lessthan60": 9,
			        "s60to70": 82,
			        "s70to80": 41,
			        "s80to90": 34,
			        "morethan90": 14
			    }
			}}}
        */

        my_require.R({
			isShade:1,
			url:'/osce/report/managerreport',
			data:{
				command:"osce/report/managerreport",
				examid:GetQueryString('examid'),
				managerid:GetQueryString('managerid')
			},
			callback:function(base){
				console.log(base);
				if ( !base.reportinfo ){
					return false;
				}
				
				var jsondata = base.reportinfo;
				// 基于准备好的dom，初始化echarts实例
				$("#testName").text(jsondata.basicinfo.testname + "管理分析报告");
         
	            //关键值
			    if(jsondata.keyvalue){
					if(jsondata.keyvalue.avgscore){
	                  $("#avgScore1").text(jsondata.keyvalue.avgscore.toFixed(2));
					  $("#avgScore").text(jsondata.keyvalue.avgscore.toFixed(2));
				    }
	              
	                if(jsondata.keyvalue.maxscore){
	                    $("#maxScore").text(jsondata.keyvalue.maxscore.toFixed(2));
					}

					if(jsondata.keyvalue.medianscore){
	                    $("#mediuScore").text(jsondata.keyvalue.medianscore.toFixed(2));  
					}
	                
	                if(jsondata.keyvalue.minscore){
	                    $("#minScore").text(jsondata.keyvalue.minscore.toFixed(2));
	                }
				   
	            }
        
	            //饼状图
				if(jsondata.sectiondistribution && jsondata.keyvalue){
					var myChart = echarts.init(document.getElementById('main'));

					option = {
						title : {
							text: '总人数：' + jsondata.keyvalue.totalcount + '人',
							subtext: '',
							x:'left',
				            textStyle: {
				                fontSize: 12
				            }
						},
						tooltip : {
							trigger: 'axis',
							formatter: "{a} <br/>{b} : {c} ({d}%)"
						},
						textStyle: {
				            fontSize: 8
				        },
						legend: {
							orient: 'vertical',
							left: 'left',
							data: ['360分以下：' + jsondata.sectiondistribution.lessthan60 + '人',
								'360－420分：' + jsondata.sectiondistribution['60to70'] + '人',
								'420－480分：' + jsondata.sectiondistribution['70to80'] + '人',
								'480－540分：' + jsondata.sectiondistribution['80to90'] + '人',
								'540－600分：' + jsondata.sectiondistribution.morethan90 + '人'],
								
					        itemWidth: 13,
					        top: '22'
						},
						series : [
							{
								name: '访问来源',
								type: 'pie',
								radius : '55%',
								center: ['50%', '60%'],
								data:[
									{value: jsondata.sectiondistribution.lessthan60, name:'360分以下：' + jsondata.sectiondistribution.lessthan60 + '人'},
									{value: jsondata.sectiondistribution['60to70'], name:'360－420分：' + jsondata.sectiondistribution['60to70'] + '人',},
									{value: jsondata.sectiondistribution['70to80'], name:'420－480分：' + jsondata.sectiondistribution['70to80'] + '人'},
									{value: jsondata.sectiondistribution['80to90'], name:'480－540分：' + jsondata.sectiondistribution['80to90'] + '人'},
									{value: jsondata.sectiondistribution.morethan90, name:'540－600分：' + jsondata.sectiondistribution.morethan90 + '人'}
								],
								itemStyle: {
									emphasis: {
										shadowBlur: 10,
										shadowOffsetX: 0,
										shadowColor: 'rgba(0, 0, 0, 0.5)'
									}
								}
							}
						]
					};

		
					// 使用刚指定的配置项和数据显示图表。
					myChart.setOption(option);
					
	            }

	            //难度与区分度
				if(jsondata.analysis){
					
	                jsondata.analysis.stationarray.push('考站');
	                for(var i=0;i<jsondata.analysis.degreearray.length;i++){
	                	jsondata.analysis.degreearray[i] = jsondata.analysis.degreearray[i].toFixed(2);
	                }
	                
	                for(var i=0;i<jsondata.analysis.distinctionarray.length;i++){
	                	jsondata.analysis.distinctionarray[i] = jsondata.analysis.distinctionarray[i].toFixed(2);
	                }
	                
	                jsondata.analysis.degreearray.push('考题');
	                jsondata.analysis.distinctionarray.push('考题');
					
					
					//
					// 试卷分析
				    // 难度：容易
				    var myChart2 = echarts.init(document.getElementById('main2'));
				    option = {
				        title: {
				            text: '',
				            textStyle: {
				                fontSize: 12
				            }
				        },
				        tooltip : {
				            trigger: 'axis'
				        },
				        grid: {
				            left: '3%',
				            right: '4%',
				            bottom: '3%',
				            containLabel: true
				        },
				        xAxis : [
				            {
				                type : 'category',
				                boundaryGap : false,
	                            data: jsondata.analysis.stationarray
				            }
				        ],
				        yAxis : [
				            {
				                name : '难度',
				                type : 'value'
				            }
				        ],
				        
				        itemStyle : {
				            normal : {
				                color:'#e89305',
				                lineStyle:{
				                    color:'#f09f18'
				                }
				            }
				        },
				        
				        series : [
				            {
				                name:'难度',
				                type:'line',
				                stack: '总量',
				                label: {
				                    normal: {
				                        show: true,
				                        position: 'top'
				                    }
				                },
				                areaStyle: {normal: {}},
								data: jsondata.analysis.degreearray
				            }
				        ]
				    };
				    myChart2.setOption(option);

				    // 区分度：中等
				    var myChart3 = echarts.init(document.getElementById('main3'));
				    option = {
				        title: {
				            text: '',
				            textStyle: {
				                fontSize: 12
				            }
				        },
				        tooltip: {
				            trigger: 'axis'
				        },
				        
				        grid: {
				            left: '3%',
				            right: '4%',
				            bottom: '3%',
				            containLabel: true
				        },
				        xAxis : [
				                 {
				                     type : 'category',
				                     boundaryGap : false,
				                     data : jsondata.analysis.stationarray
				                 }
				             ],
				             yAxis : [
				                 {
				                     name : '区分度',
				                     type : 'value'
				                 }
				             ],
				             itemStyle : {
				                 normal : {
				                     color:'#589913',
				                     lineStyle:{
				                         color:'#c1d9a7'
				                     }
				                 }
				             },
				             series : [
				                 {
				                     name:'难度',
				                     type:'line',
				                     stack: '总量',
				                     label: {
				                         normal: {
				                             show: true,
				                             position: 'top'
				                         }
				                     },
				                     areaStyle: {normal: {}},
				                     data:jsondata.analysis.distinctionarray
				                 }
				             ]
				    };
				    myChart3.setOption(option);
				}

				// 学生成绩列表
		        if(jsondata.rankinglist){
		           
				  var $tabscorelist = $("#tabscorelist");

				  for(var i=0; i< jsondata.rankinglist.length; i++){
		              
					var tmpstr = "<tr>";
		            var str1 = "<td style='width: 20%'>" +  jsondata.rankinglist[i].ranking + "</td>";
					tmpstr = tmpstr + str1;
					
		            var str2 = "<td>" +  jsondata.rankinglist[i].name + "</td>";
					tmpstr = tmpstr + str2;
					
					var str3 = "<td>" +  jsondata.rankinglist[i].score.toFixed(2) + "</td>";
				    tmpstr = tmpstr + str3;
				  
				    tmpstr = tmpstr + "</tr>";
				  
				    $tabscorelist.append(tmpstr);
				 
				  }
		  
		       }
				
			}
		});
        
        

    });   

    </script>
</body>
</html>