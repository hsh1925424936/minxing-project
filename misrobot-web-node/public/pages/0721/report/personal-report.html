<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../common/js/layout.js" ></script>
		<meta charset="UTF-8">
		<title>学生训练报告</title>
		<style type="text/css">
			body{
				background-color:#F6F6F6;
			}
			
			._title{
				width:100%; height:46px; line-height:46px; text-align:center; font-size:22px;
				background-color:#3499DB; color:white;
			}
			.mainOuter{
				overflow:hidden; width:100%;
			}
			.reportOuter{
				width:100%; background-color:white; overflow:hidden;
			}
			.username{
				height:36px; right:10px; top:10px; margin:10px 0; padding-right:10px;
			}
			.username img{
				height:100%; display:block; float:right; margin-right:10px;
			}
			.username span{
				display:block; float:right; line-height:36px; font-size:18px;
			}
			.reportTit{
				width:100%; font-size:18px; text-align:center;
				line-height:45px;
			}
			.reportSubTit{
				width:100%; font-size:12px; text-align:center;
				line-height:45px; color:rgb(102,102,102);
			}
			.chartOuter{
				width:100%;
			}
			.smartModeOuter{
				width:100%; height:300px; margin:auto;
			}
			.smartModeBox{
				width:165px; float:left; height:190px; margin-left:35px;
				margin-right:35px;
			}
			.smartModeBox span{
				display:block; width:100%;
				font-size:14px; font-weight:bold;
				margin-top:12px; text-align:center;
			}
			.smartModeCon{
				width:160px; height:160px; margin: 0 auto; position: relative;
				background: url(../common/images/train-record-detail-bg.png) no-repeat; 
				background-size: 100% 100%; text-align: center; line-height: 160px;
				color: #333; border-radius: 50%; overflow: hidden;
			}
			.smartModeCon strong { font-size: 50px;}
			.smartModeCon strong,.smartModeCon span { z-index: 2; position: relative;}
			.smartModeCon div { width: 100%; background: #ff8019; position: absolute;
				left: 0; bottom: 0; height: 0%;
			}
			
			.abilityEvalute{
				width:100%; height:250px;  position: relative;
			}
			.abilityEvalute span {
				position:absolute;left:50%;top:0; margin:-30px; border-radius:50%;border: 1px solid #ccc;
				text-align: center; width:60px; height:60px; line-height: 60px; background: #fff; font-size:12px ;
			}
			.abilityEvalute span.active { background: #dfebf7;}
			
			.abilityEvalute p {
				position: absolute; left: 0; top: 0; width:200px; height:200px; line-height: 200px; text-align: center;
			}
			
			.triOuter{
				width:100%; height:16px; border-bottom:1px solid #F1F1F1;
				float:left; margin-top:5px;
			}
			.triOn{
				background-image:url('../common/images/tri.jpg');
			}
			.triOuter span{
				display:block; width:36px; height:100%;
				background-size:100% 100%; background-repeat:no-repeat;
				margin-top:1px;
			}
			.tri1{
				float:left; margin-left:100px;
			}
			.tri2{
				float:right; margin-right:100px;
			}
			.summaryOuter{
				width:100%; border-bottom:1px solid #F1F1F1;
				float:left;
			}
			.summary{
				display:block; float:left; width:33.3%; height:37px;
				line-height:37px; text-align:center; font-size:14px;
				color:rgb(2,2,2);
			}
			.summary span{
				font-size:18px; color:rgb(255,127,25);
			}

			.th{
				width:100%; background-color:#F7F7F7;
				font-size:14px; height:54px;
				line-height:54px; text-align:center;
				border-bottom:2px solid #E6E6E6; color:rgb(2,2,2);
			}
			.th li{
				float:left;
			}
			.th .learnPoint{
				border-right:2px solid #E6E6E6; width:20%; 
			}
			.th .wrongTxt{
				border-right:2px solid #E6E6E6; width:40%;
			}
			/*.th .accessory{
				border-right:2px solid #E6E6E6; width:70px;
			}*/
			.th .score{
				border-right:2px solid #E6E6E6; width:10%;
			}
			.th .abilityChange{
				width:30%;
			}

			.tr{
				width:100%; padding: 10px 0;
				font-size:14px; 
				/*text-align:center;*/ 
				border-bottom:1px solid #E6E6E6;
			}
			.tr li{
				float:left;
			}
			
			.tr .learnPoint{
				width:20%;padding-left: 1em;
			}
			.tr .wrongTxt{
				width:40%;
			}
			/*.tr .accessory{
				width:70px;
			}
			.tr .accessory span{
				visibility: hidden;
			}*/
			.tr .score{
				width:10%; text-align: center;
			}
			.tr .abilityChange{
				width:30%;
			}
			.accessory>span{
				display:block; margin:auto; width:25px; height:18px;
				background-image:url('../images/movie.png');
				background-size:100% 100%; background-repeat:no-repeat; 
			}
			.abilityChange>span{
				display:block; float:left; width:18px; height:12px;
				background-size:100% 100%; background-repeat:no-repeat;
				margin-left:6px; margin-top: 5px;
			}
			.fishOn{
				background-image:url('../common/images/fishOn.png');
			}
			.fish{
				background-image:url('../common/images/fish.png');
			}
		</style>
	</head>
	<body>

		<div class="mainOuter">
			<!-- <div class="_title">
				个人报告
			</div> -->
			<div class="reportOuter clearfix" v-cloak>
				<div class="username clearfix">
					<span class="myname">无</span>
					<img onerror="this.src='../common/images/icon-touxiang.png'">
				</div>
				<h3 class="reportTit">
					&nbsp;
				</h3>
				<h4 class="reportSubTit">
					来源：&nbsp;&nbsp;&nbsp;&nbsp;
				</h4>

				<div class="chartOuter clearfix">
					<div class="smartModeOuter clearfix">
						<div class="smartModeCon">
							<strong>0</strong><span>分</span>
							<div></div>
						</div>

			
						<div class="summaryOuter clearfix">
							
							<span class="summary">
								答题数
							</span>
							<span class="summary">
								总用时长
							</span>
							<span class="summary">
								击败同学
							</span>
							<span class="summary itemscount">
								<span>0</span>/0题
							</span>
							<span class="summary itemstime">
								<span>0</span>分钟
							</span>
							<span class="summary itemsrank">
								<span>0</span>%
							</span>

						</div>
					</div>

					<div class="abilityEvalute">
						<!--<div>
							
						</div>
						<p>评测能力</p>-->
					</div>
				</div>

				<ul class="th clearfix">
					<li class="learnPoint">操作步骤</li>
					<li class="wrongTxt">实际操作</li>
					<!-- <li class="accessory">附件</li> -->
					<li class="score">得分</li>
					<li class="abilityChange">能力变化</li>
				</ul>

				<div class="table">
					
				</div>

			</div>

		</div>

	</body>

	<script src="../common/js/echarts.min.js" type="text/javascript"></script>
	<script src="../common/js/web-chart.js"></script>

	<script>
		var R;
		window.onload = function () {
			'use strict';
			$('.username img').attr('src',getCookie('headimgurl'));
			$('.myname').html( decodeURI(getCookie('nickname')) );
			//?detail=1，具体数值跟后台沟通
			var oId = findurl('detail');
			my_require.R({
				isShade:1,
				url:'/grade/getscore',
				data:{
					command:"grade/getscore",
					scoreid:oId
				},
				callback:function(base){
					if( !base.totalscore ){
						layer.msg('没有查询到报告！');
						return false;
					}
					$('[v-cloak]').css('display','block');
					var str = base.scoresheetcode;
					str = str.substring(str.indexOf('-')+1,str.indexOf('-')+2);
					switch (str){
						case '2':
							$('.reportSubTit').html('来源：智能设备');
							$('._title').html('个人智能训练报告');
							break;
						case '1':
							$('.reportSubTit').html('来源：模拟训练');
							$('._title').html('个人模拟训练报告');
							break;
						default:
							$('.reportSubTit').html('来源：在线训练');
							$('._title').html('个人在线训练报告');
							break;
					}
					
					$('.reportTit').html(base.drillname);
					$('.smartModeCon strong').html(Math.round(isnull(base.totalscore)));
					$('.smartModeCon div').stop().animate({'height':parseFloat(isnull(base.totalscore))+'%'});
					$('.itemscount').html('<span>'+isnull(base.doneitems)+'</span>/'+isnull(base.totalitems)+'题');
					var time = isnull((datetotime(base.endtime.split('.')[0])- datetotime(base.begintime.split('.')[0]))/60);
					time = time < 1 ? 1 : time;
					$('.itemstime span').html(Math.round(time));
					$('.itemsrank span').html((isnull(base.beat)*100).toFixed(2));
					
					var arr = base.score;
					$('.table').html('');
					for (var i = 0 ; i < arr.length; i++) {
						var _str = '';
						var _num = arr[i].score-arr[i].lastscore;
						for (var j=0; j<5; j++  ) {
							if (j<_num) {
								_str+='<span class="fishOn"></span>';
							} else {
								_str+='<span class="fish"></span>';
							}
						}
						
						var str = 
							'<ul class="tr clearfix">'
								+'<li class="learnPoint">'+arr[i].opstepcontent+'</li>'
								+'<li class="wrongTxt">'+arr[i].subitemcontent+'</li>'
								// +'<li class="accessory"><span></span></li>'
								+'<li class="score">'+parseFloat(arr[i].score)+'</li>'
								+'<li class="abilityChange">'
									+_str
								+'</li>'
							+'</ul>';							
							
						$('.table').append(str);
					}
					
					//画单次训练的雷达图
					function toPositive(num){//把负数转换成0
						if(num < 0){
							num = 0;
						}
						return num;
					}

					if (base.errcode!=0) {
						uselayer(1,base.errdesc);
						return false;
					}	
					var arr1 = [
						{text:'病人安全',max:100},
						{text:'无菌观念',max:100},
						{text:'人文关怀',max:100},
						{text:'专业知识',max:100},
						{text:'专业技能',max:100},
						{text:'临床思维',max:100},
						{text:'职业素养',max:100},
						{text:'医患沟通',max:100}
					];
					var arr2 = [
						toPositive(parseFloat(base.braq_score)).toFixed(2),
						toPositive(parseFloat(base.wjgn_score)).toFixed(2),
						toPositive(parseFloat(base.rwgh_score)).toFixed(2),
						toPositive(parseFloat(base.zyzs_score)).toFixed(2),
						toPositive(parseFloat(base.zyjn_score)).toFixed(2),
						toPositive(parseFloat(base.lcsw_score)).toFixed(2),
						toPositive(parseFloat(base.zysy_score)).toFixed(2),
						toPositive(parseFloat(base.yhgt_score)).toFixed(2)
					];
								
					writeradar({
						obj:$('.abilityEvalute')[0],
						name:arr1,
						value:arr2,
						show:true,
						bg:'#ffffff',
						line:'#0496ca',
						type:'solid',
						color:'rgba(4,150,202,0.2)'
					});			
				}
			});

		};	
				
	</script>
	
</html>
