<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../common/js/layout.js" ></script>
		<script src="../common/js/echarts.min.js" type="text/javascript"></script>
		<meta charset="UTF-8">
		<title>老师班级报告</title>
		<style>
			.report_all{
				height:100%; overflow:hidden; color:white;
			}

			.title{/*标题*/
				width:100%; height:7vh; background-color:#3499DB;
				font-size:4vh; padding-left:4.5em; line-height:7vh; padding-left:4vh;
			}
			.report_con{
				height:93vh; padding-top:2vh; padding-bottom:2vh;
				background-color:#1E202F;
			}
			/*左边部分*/
			.report_con_left{
				float:left; width:39%; height:100%;
			}
			.left_top{
				width:100%; height:34vh; margin-bottom:2vh; background-color:#242941;
				padding:3.5vh 4vh;
			}
			.left_top_tit{
				width:100%; height:17vh;
			}
			.left_top_tit img{
				height:60%; display:block; float:left; margin-right:4vh; border-radius:0.9vh;
				margin-top:6%;
			}
			.left_top_tit .h2_con{
				width:35vh; height:100%; position:relative; float:left;
			}
			.left_top_tit h2{
				width:100%; font-size:4vh; position:absolute; bottom:0;
			}
			.left_top_tit h2 span{
				font-size:5.5vh; color:#FFD567;
			}
			.A_H_L_score{
				width:100%; margin-top:3vh;
			}
			.A_H_L_score p{
				width:33.3%; float:left; font-size:3.2vh;
			}
			.A_H_L_score p:nth-child(1) span{
				color:#3499DB;
			}
			.A_H_L_score p:nth-child(2) span{
				color:#FFA800;
			}
			.A_H_L_score p:nth-child(3) span{
				color:#FF0000;
			}

			.left_bottom{
				width:100%; height:53vh; background-color:#242941;
				padding:3.5vh 4vh;
			}
			.stu_score_con{
				width:100%; height:7.4vh; line-height:7.4vh; background-color:#222740;
				border:0.1vh solid #494E62; margin-bottom:2.4vh; border-radius:0.9vh;
				color:#ADBEE2; overflow:hidden;
			}

			.stu_score_con span{
				height:100%; display:block; float:left; text-align:left; overflow:hidden;
			}
			.stu_score_con span:nth-child(1){
				width:25%; font-size:4vh; padding-left:5px;
			}
			.stu_score_con span:nth-child(2){
				width:30%; font-size:4vh; color:white;
			}
			.stu_score_con span:nth-child(3){
				width:30%; font-size:2.8vh;
			}
			.stu_score_con span:nth-child(4){
				width:15%; font-size:2.8vh;
			}

			/*右边部分*/
			.report_con_right{
				float:left; width:61%; height:100%; padding-left:2vh;
			}
			.right_inner{
				width:100%; height:100%; background-color:#242941; overflow:hidden;
			}
			.right_inner h2{
				font-size:4vh; padding-left:0.5em;
				width:100%; margin-top:3.5vh;
			}
			.chart_con{
				width:90%; height:58vh; margin:8vh auto 0;
			}
		</style>	
	</head>
	<body>
        <div class="report_all" id="vue_control" v-cloak>
        	<div class="title">
        		{{type[current_type2]}}成绩统计
        	</div>
        	<div class="report_con">
        		<div class="report_con_left">
        			<div class="left_top">
        				<div class="left_top_tit">
            				<img :src="img[current_type2]">
            				<div class="h2_con">
								<h2><span>{{trainstdcount}}</span>人次参与<br/>{{type[current_type2]}}</h2>
            				</div>
            				
        				</div>
        				<div class="A_H_L_score clearfix">
        					<p>平均分:<span>{{parseFloat(avgscore?avgscore:0).toFixed(1)}}</span></p>
        					<p>最高分:<span>{{parseFloat(maxscore?maxscore:0).toFixed(1)}}</span></p>
        					<p>最低分:<span>{{parseFloat(minscore?minscore:0).toFixed(1)}}</span></p>
        				</div>
        			</div>
        			<div class="left_bottom">
        				<div v-for="(item,i) in order" class="stu_score_con" v-if="i<5">
        					<span>{{item.name}}</span><span>{{parseFloat(item.score).toFixed(1)}}分</span>
        					<span>{{item.endtime.split(' ')[0]}}</span>
        					<span>{{item.endtime.split(' ')[1].substr(0,5)}}</span>
        				</div>

        			</div>
        		</div>
        		<div class="report_con_right">
        			<div class="right_inner" v-if="personal.length>0">
        				<h2>{{personal[current_person].name}}个人进阶曲线</h2>
        				<div class="chart_con">

        				</div>
        			</div>
        		</div>
        	</div>
        </div>
	</body>
	<script type="text/javascript" src="../common/js/web-chart.js" ></script>
	<script type="text/javascript">

		var vm=new Vue({
			el:"#vue_control",
			data:{
				minscore:0,
				avgscore:0,
				trainstdcount:0,
				maxscore:0,
				order:[],

				img:['../common/images/@-white.png','../common/images/smart_train-white.png','../common/images/model_train-white.png','../common/images/subscribe_train-white.png','../common/images/osce_exam-white.png'],
				type:['在线自主训练','课上机器人训练','课上模型人训练','课后自主预约训练','OSCE考试'],//报告类型
				current_type:0,
				current_type2:0,
				type_map:[2,3,4,5,1],//type映射表(对应传给后端的字段)

				/*个人曲线*/
				personal:[],
				current_person:0//记录当前显示的哪个人
			},
			methods:{
				personal_data:function(){//生成进阶曲线的数据
					var self = this;
					var name_arr = ['赵涵','冯尧尧','杨轩','李佳文','许天俐','张慧','郑周','曹磊','杨屹','张树一','朱妍妍','许可','李果','李庆杰','缪庆彦','董信延','朱泽','杜雅','李宗涵','周蔚'];
					$(name_arr).each(function(i, el) {
						var data = [60+Math.floor(Math.random()*6),65+Math.floor(Math.random()*6),70+Math.floor(Math.random()*6),75+Math.floor(Math.random()*6),80+Math.floor(Math.random()*11)];

						self.personal.push({name:el,data:data});
					});
				}
			},

			created:function(){
				this.personal_data();
			},
			mounted:function(){
				var self = this;

				//班级成绩统计
				function change_class_data(){//轮流展示不同类型的训练数据
					my_require.R({
						url:'/report/classreport',
						data:{
							command:"report/classreport",
							sessionid:getCookie('sessionid'),
							accountname:getCookie('userid'),
							querytype:self.type_map[self.current_type]
						},
						callback:function(base){
							self.minscore = base.minscore;
							self.avgscore = base.avgscore;
							self.trainstdcount = base.trainstdcount;
							self.maxscore = base.maxscore;
							self.order = base.order;
							self.current_type2 = self.current_type;
						}
					});
				}
				change_class_data();
				setInterval(function(){
					if( self.current_type < 4 ){
						self.current_type++;
					}else{
						self.current_type = 0;
					}
					
					change_class_data();
				},5000);

				//个人进阶曲线
				function draw_advance_line(){
					draw_line_dark({
						element:$('.chart_con')[0],
						fontSize:20,
						xAxis_data:['课前自主\n在线训练','课上训练\n机器人','课上训练\n模型人','课后自主\n预约训练','OSCE\n考试'],
						data:self.personal[self.current_person].data,
					});
					if( self.current_person < 18 ){
						self.current_person++;
					}else{
						self.current_person = 0;
					}
				}

				draw_advance_line();
				setInterval(function(){
					draw_advance_line();
				},10000);
			},
			updated:function(){
			},
			watch:{
			},
			computed:{
				
			}
		})
	</script>
</html>