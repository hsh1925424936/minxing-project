<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../common/js/layout.js" ></script>
		<script src="../common/js/echarts.min.js" type="text/javascript"></script>
		<meta charset="UTF-8">
		<title>学生训练报告列表</title>
		<style>
			.report_all{
				background-color:#EFF4F9;
			}
			.title{/*标题*/
				width:100%; height:40px; background-color:#3499DB;
				color:white; font-size:20px; line-height:40px; text-align:center;
			}
			.report_block{
				box-shadow:0px 2px 2px #E0E7EF; overflow:hidden; background-color:white;
			}
			.report_block1{
				margin-bottom:10px; padding:38px 20px;
			}
			.report_block1>div{
				height:85px;
			}
			.block1_left{
				float:left; width:28%;
			}
			.report_block1 img{
				display:block; height:100%;
			}
			.report_block1_con{
				float:left; width:72%; padding-left:10%; position:relative;
			}
			.report_block1_con div{
				width:100%; position:absolute; bottom:0;
			}
			.report_block1_con p{
				margin-top:9px;
			}
			.orange{
				color:#FFA800;
			}
			.blue{
				color:#3499DB;
			}

			.chart_block{
				margin-bottom:10px;
			}
			.chart_block h2{
				color:#3499DB; padding-left:1em; margin-top:1.5em;
			}
			.ability{
				width:100%; height:260px;
			}
			.grow{
				width:100%; height:240px; padding-bottom:20px;
			}

			.list_con{
				overflow:hidden; width:100%; margin-bottom:7px;
			}
			.list_con .report_block{
				color:#333; height:30px; cursor:pointer;
				line-height:30px; padding-left:1em; position:relative; display:block;
			}
			.list_con span{
				position:absolute; background-image:url(../common/images/turn-right.png);
				background-size:100% 100%;
				top:50%; margin-top:-8px; right:22px; width:9px; height:16px;
			}
			#shadow{
				position:fixed;
				width:100%;
				height:100%;
				top:0;
				left:0;
				background-color: rgba(0,0,0,0.3);
				display:none;
			}
			#shadow_container{
				width:100%;
				height:100%;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			#msg{
				background-color: white;
				color:#333333;
				width:80%;
				height:20%;
				border-radius: 10px;
				padding:10px;
			}
			.tophandler{
				display:flex;
				justify-content: flex-end;
			}
			.tophandler img{
				width:14px;
				height:14px;
			}
			.msgtitle{
				text-align: center;
				margin-bottom: 10px;
			}
			.msgcontent p{
				padding:0 5px;
			}
		</style>	
	</head>
	<body>
		<div class="report_all" id="vue_control" v-cloak>
        	<!-- <div class="title">
        		学生个人报告
        	</div> -->
        	<div class="report_block report_block1 clearfix">
        		<div class="block1_left">
        			<img :src="headimgurl" onerror="this.src='../common/images/icon-touxiang.png'">
        		</div>
        		<div class="report_block1_con">
        			<div>
	    				<p>{{nickname}}</p>
	    				<p>当前胜任力指数：<span class="orange">{{nowcompetence}}</span></p>
	    				<p>总胜任力指数：<span class="blue">{{totalcompetence}}</span></p>
    				</div>
        		</div>
        	</div>
        	<div class="report_block chart_block">
        		<h2>学生临床能力评价</h2>
        		<div class="ability">

        		</div>
        	</div>

			<div class="report_block chart_block">
				<h2 style="margin-bottom:1.0em">训练报告列表({{reportnum}})</h2>
				<div class="list_con">
					<a v-show='reportids.onlinescoreid' class="report_block" @click="goto(reportids.onlinescoreid)">
						课前自主在线训练报告<span></span>
					</a>
					<a v-show='reportids.robotscoreid' class="report_block" @click="goto(reportids.robotscoreid)">
						课上机器人训练报告<span></span>
					</a>
					<a v-show='reportids.modelscoreid' class="report_block" @click="goto(reportids.modelscoreid)">
						课上模型人训练报告<span></span>
					</a>
					<a v-show='reportids.bookingscoreid' class="report_block" @click="goto(reportids.bookingscoreid)">
						课后自主预约训练报告<span></span>
					</a>
					<a v-show='reportids.examid' class="report_block" @click="gotooscereport()">
						OSCE考试报告<span></span>
					</a>
				</div>
			</div>

        	<div class="report_block chart_block">
        		<h2>成长曲线</h2>
        		<div class="grow">

        		</div>
        	</div>
			
			<!--弹框层-->
			<div id="shadow">
				<div id="shadow_container">
					<div id="msg">
						<p class="tophandler">
							<img src="../common/images/guanbi.png" alt="" onclick="closeshadow()">
						</p>
						<p class="msgtitle">
							<b>提醒</b>
						</p>
						<div class="msgcontent">
							<p>
								您尚未参与任何智能训练系统体验，赶快去参与智能训练系统体验，查看个人训练报告
							</p>
						</div>
					</div>
				</div>
			</div>
			<!--<div>-->
				<!--<span>reportidlist:{{reportids}}</span>-->
				<!--<span>linedata:{{linedata}}</span>-->
				<!--<span>radadata:{{radadata}}</span>-->
			<!--</div>-->
			<!--<div id="logininfo"></div>-->
        </div>
	</body>
	<script type="text/javascript" src="../common/js/web-chart.js" ></script>
	<script type="text/javascript">
		var vm=new Vue({
			el:"#vue_control",
			data:{
				headimgurl:getCookie('headimgurl'),
				nickname:decodeURI(getCookie('nickname')),
				nowcompetence:'',
				totalcompetence:'',
				reportids:{},
				linedata:'',
				radadata:'',
				reportnum:0
			},
			methods:{
				getreport:function(){
					var self=this
					var data={
						command:'report/studentpersonalreport',
						accountname:getCookie('username'),
						sessionid:getCookie('sessionid'),
						stuid:getCookie('userid'),
						loginid:getCookie('userid')
						//pctest
//						accountname:getCookie('accountname'),
//						sessionid:getCookie('sid'),
//						stuid:getCookie('uid'),
//						loginid:getCookie('uid')
					}
					//$('#logininfo').html(JSON.stringify(data))
					function callback(res){
						//胜任力指数
						self.nowcompetence=res.totalscore
						self.totalcompetence=res.fullscore
						//成长曲线图
						var linechartarr=[res.growthcurve.onlinescore,res.growthcurve.robotscore,res.growthcurve.modelscore,res.growthcurve.bookingscore,res.growthcurve.oscescore]
						self.linedata=linechartarr
						self.linechart(linechartarr)
						//雷达图
						var radachartarr=[
							res.spiderweb.braqscore,
							res.spiderweb.wjgnscore,
							res.spiderweb.rwghscore,
							res.spiderweb.zyzsscore,
							res.spiderweb.zyjnscore,
							res.spiderweb.lcswscore,
							res.spiderweb.zysyscore,
							res.spiderweb.yhgtscore
						]
						self.radadata=radachartarr
						self.radachart(radachartarr)
						//报告id列表
						self.reportids={
							onlinescoreid:res.reportlist.onlinescoreid,
							robotscoreid:res.reportlist.robotscoreid,
							modelscoreid:res.reportlist.modelscoreid,
							bookingscoreid:res.reportlist.bookingscoreid,
							examid:res.reportlist.examid
						}
						for(i in self.reportids){
							if(self.reportids[i]){
								self.reportnum++
							}
						}
						if(self.reportnum==0){
							$('#shadow').show()
						}
					}
					post('/report/studentpersonalreport',data,callback,errcodefn,errfn)
				},
				linechart:function(dataarr){//生成曲线图
					draw_line({
						element:$('.grow')[0],
						fontSize:12,
						xAxis_data:['课前自主\n在线训练','课上训练\n机器人','课上训练\n模型人','课后自主\n预约训练','OSEC\n考试'],
						data:dataarr
					});
				},
				radachart:function(dataarr){//生成雷达图
					var arr1 = [
						{text:'病人安全',max:100},
						{text:'无菌观念',max:100},
						{text:'人文关怀',max:100},
						{text:'专业知识',max:100},
						{text:'专业技能',max:100},
						{text:'临床思维',max:100},
						{text:'职业素养',max:100},
						{text:'医患沟通',max:100}
					];
					writeradar({
						obj:$('.ability')[0],
						name:arr1,
						value:dataarr,
						show:true,
						bg:'#ffffff',
						line:'#0496ca',
						type:'solid',
						color:'rgba(4,150,202,0.2)'
					});
				},
				goto:function(reportid){
					window.location.href='personal-report.html?detail='+reportid
				},
				gotooscereport:function(){
					window.location.href='../../oscereport/stureport.html?examid='+this.reportids.examid+'&&studentid='+getCookie('userid')+'&&sessionid='+getCookie('sessionid')
					//pctest
					//window.location.href='../../oscereport/stureport.html?examid='+this.reportids.examid+'&&studentid='+getCookie('uid')+'&&sessionid='+getCookie('sid')
				}
			},
			mounted:function(){
				this.getreport()
			}
		})
		function closeshadow(){
			$('#shadow').hide()
		}
	</script>
</html>