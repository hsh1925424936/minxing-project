<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>管理者班级报告</title>
    <script src="../common/js/vue.js"></script>
    <script src="../common/js/jquery-3.1.1.min.js"></script>
    <script src="../common/js/echarts.min.js"></script>
    <script src="../common/js/common.js"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="../common/css/animate_text.css">
    <style>
        /*通用*/
        *{padding:0;margin:0}
        ul{list-style-type: none}
        body{background-color: #EFF4F9}
        .mt8{margin-top:.8rem}
        .bluefont{color:#009AFF;}
        .yellowfont{color:#FFA800;}
        .iconblue{background-color:#009AFF ;}
        .icongray{background-color:#c2c2c2 }
        .iconyellow{background-color:#FFA800 }
        /*布局*/
        #head{
            height:2.5rem;
            position:fixed;
            width:100%;
            background-color:#3499DB;
            color:white;
            font-size: 1.2rem;
            text-align: center;
            line-height: 2.5rem;
            z-index:99;
        }
        #title{
            margin-top:.8rem;
            background-color: white;
            color:#4E4E4E;
            padding:.8rem;
            box-shadow:calc(5vh*100/990) calc(5vh*100/990) calc(5vh*100/990) #E1E8F0;
        }
        #textcontent{
            display:flex;
            flex-wrap: wrap;
            margin-top:.8rem;
            justify-content: space-between;
        }
        #textcontent>ul{
            background-color: white;
            width:48%;
            padding:.8rem;
            box-sizing:border-box;
            font-size:.9rem;
            box-shadow:calc(5vh*100/990) calc(5vh*100/990) calc(5vh*100/990) #E1E8F0;
        }
        .chartcontent{
            position:relative;
            overflow: hidden;
            height:40vh;
        }
        #linecharts{
            width:150%;
            transform:scaleX(0.66);
            position:absolute;
            left:-25%;
            height:100%;
        }
        #chartcontainer{
            width:100%;
            height:40vh;
            position:relative;
        }
        .chartbox{
            background-color: white;
            margin-top: .8rem;
            position:relative;
            width:100%;
            box-shadow:calc(5vh*100/990) calc(5vh*100/990) calc(5vh*100/990) #E1E8F0;
        }
        .line{
            padding:.3rem 0;
        }
        .charttitle{
            color:#009AFF;
            background-color: white;
            padding:.8rem;
        }
        /*图例*/
        .exampleicon{
            width:1.2rem;
            height:0.8rem;
            border-radius: .2rem;
            margin-right:.6rem;
        }
        .example li{
            display:flex;
            font-size: .7rem;
            color:#878787;
            align-items: center;
        }
        .example{
            position: absolute;
            top:1.7rem;
            right:.8rem;
        }
        /*热力图*/
        @keyframes a10 {
            0%   {transform: scale(1.0);}
            25%  {transform: scale(0.8);}
            50%  {transform: scale(0.6);}
            75%  {transform: scale(0.5);}
            85%  {transform: scale(0.8);}
            100% {transform: scale(1.0);}
        }
        @keyframes a14 {
            0%   {transform: scale(1.2);}
            25%  {transform: scale(1.3);}
            50%  {transform: scale(1.4);}
            75%  {transform: scale(1.2);}
            85%  {transform: scale(1.0);}
            100% {transform: scale(1.2);}
        }
        @keyframes a18 {
            0%   {transform: scale(1.4);}
            25%  {transform: scale(1.6);}
            50%  {transform: scale(1.8);}
            75%  {transform: scale(1.6);}
            85%  {transform: scale(1.5);}
            100% {transform: scale(1.4);}
        }
        @keyframes a25 {
            0%   {transform: scale(1.8);}
            25%  {transform: scale(2.0);}
            50%  {transform: scale(2.2);}
            75%  {transform: scale(2.5);}
            85%  {transform: scale(2.2);}
            100% {transform: scale(1.8);}
        }
        .rone{
            background-color: #3fe4e2;
            top:10%;
            left:39%;
            animation: a14 30s infinite;
        }
        .rtwo{
            background-color: #afa9fa;
            top:11%;
            left:53%;
            animation: a10 30s infinite;
        }
        .rthree{
            background-color: #ff4081;
            top:38%;
            left:34%;
            animation: a25 30s infinite;
        }
        .rfour{
            background-color: #558bf7;
            top:23%;
            left:61%;
            animation: a10 30s infinite;
        }
        .rfive{
            background-color: #f2bd31;
            top:65%;
            left:32%;
            animation: a14 30s infinite;
        }
        .rsix{
            background-color: #26b8eb;
            top:53%;
            left:60%;
            animation: a18 30s infinite;
        }
        .rseven{
            background-color: #f25747;
            top:74%;
            left:20%;
            animation: a10 30s infinite;
        }
        #hotcharts{
            margin-top:.8rem;
            background-color: white;
        }
        .imgbox{
            /*width:80%;*/
            margin:0 auto;
            position:relative;
            background-image: url('../common/images/place.png');
            /*background-size:90%;*/
            background-repeat: no-repeat;
            /*background-position: center;*/
            background-size:100% 100%;
        }
        .imgbox div{
            width:2.2rem;
            height:2.2rem;
            border-radius: 50%;
            position: absolute;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div id="container">
    <!--头部页面标题-->
    <!--<div id="head">-->
        <!--管理者班级报告-->
    <!--</div>-->
    <!--<div style="height:2.5rem"></div>-->
    <!--班级信息-->
    <div id="title">
        <ul>
            <li v-for="value in classinfo" class="line">
                <span class="label">{{value.label}}</span>
                <span class="content">{{value.text}}</span>
            </li>
        </ul>
    </div>
    <!--4个格子的文本内容-->
    <div id="textcontent">
        <ul v-for="(value,index) in text" :class="{mt8:index>1}">
            <li>
                <ul>
                    <li v-for="(value1,index1) in text[index].content" class="line">
                        <span class="label" style='white-space:pre;'>{{value1.label}}</span>
                        <span class="content" :class="{bluefont:index1==0,yellowfont:index1!=0}">{{value1.text}}</span>
                        <span class="danwei">{{value1.danwei}}</span>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <!--班级能力进阶曲线图-->
    <div class="chartbox">
        <p class="charttitle">班级能力进阶曲线</p>
        <div class="example">
            <ul>
                <li>
                    <b class="exampleicon iconyellow"></b>
                    <span>最高分</span>
                </li>
                <li>
                    <b class="exampleicon iconblue"></b>
                    <span>平均分</span>
                </li>
                <li>
                    <b class="exampleicon icongray"></b>
                    <span>最低分</span>
                </li>
            </ul>
        </div>
        <div id="chartcontainer">
            <div id="linecharts"></div>
        </div>
    </div>
    <!--训练场地热力图-->
    <div id="hotcharts">
        <p class="charttitle">训练场地热力图</p>
        <div class="chartcontent">
            <div class="imgbox">
                <div class="rone"></div>
                <div class="rtwo"></div>
                <div class="rthree"></div>
                <div class="rfour"></div>
                <div class="rfive"></div>
                <div class="rsix"></div>
                <!--<div class="rseven"></div>-->
            </div>
        </div>
    </div>
</div>
<script>
    var vm=new Vue({
        el:'#container',
        data:{
            //头部班级信息
            classinfo:[
                {
                    label:'班级：',
                    text:''
                },{
                    label:'上课人数：',
                    text:''
                },{
                    label:'上课时间：',
                    text:''
                }
            ],
            //上方的文字列表
            text:[
                {
                    item:0,
                    content:[
                        {label:'当前训练人数：',text:'',danwei:'人'},
                        {label:'峰值训练人数：',text:config.max,danwei:'人'}
                    ]
                },{
                    item:1,
                    content:[
                        {label:'总教室数：',text:6,danwei:'间'},
                        {label:'当前使用：',text:3,danwei:'间'},
                        {label:'教室使用率：',text:50,danwei:'%'}
                    ]
                },{
                    item:2,
                    content:[
                        {label:'传统模型：',text:4,danwei:'个'},
                        {label:'当前使用：',text:2,danwei:'个'},
                        {label:'模型使用率：',text:50,danwei:'%'}
                    ]
                },{
                    item:3,
                    content:[
                        {label:'训练机器人：',text:8,danwei:'个'},
                        {label:'当前使用   ：',text:6,danwei:'个'},
                        {label:'机器人使用率：',text:75,danwei:'%'}
                    ]
                }
            ],
            //曲线图数据
            datamax:[],
            dataavg:[],
            datamin:[]

        },
        mounted:function(){
            //调整热力图大小
            var w=$('.imgbox').width()
            $('.imgbox').height(w*0.693)

            this.reportinfo()
            var self=this
            var timer1=setInterval(function(){
                self.reportinfo()
            },30000)
            var max=config.max
            var min=config.min
            var interval=config.timeinterval
            var now//当前训练人数
            now=Math.random()*(config.wavemax-config.wavemin)+config.wavemin
            self.text[0].content[0].text=Math.ceil(now)
            var timer2=setInterval(function(){
                now=Math.random()*(config.wavemax-config.wavemin)+config.wavemin
                self.text[0].content[0].text=Math.ceil(now)
            },config.timeinterval*1000)

            //教室，模型，机器人使用情况数据
            var timer9=setInterval(function(){
                for(var i=1;i<self.text.length;i++){
                    self.text[i].content[1].text=self.randomnum(self.text[i].content[0].text)
                    self.text[i].content[2].text=Math.ceil(self.text[i].content[1].text*100/self.text[i].content[0].text)
                }
            },30000)
        },
        methods:{
            randomnum:function(maxnum){//传入最大值，返回值为50%-100%变动
                var percent=Math.random()*0.5+0.5
                return Math.ceil(maxnum*percent)
            },
            drawlinechart:function(){
                var self=this
                var myChart = echarts.init(document.getElementById('linecharts'))
                var option = {
                    grid:{
                        top:40
                    },
                    tooltip : {
                        trigger: 'axis'
                    },
                    calculable : true,
                    xAxis : {
                        type : 'category',
                        boundaryGap : false,
                        data : ['课前自主\n在线训练','课上训练\n机器人','课上训练\n模型人','课后自主\n预约训练','osec考试'],
                        axisLabel: {
                            textStyle: {
                                fontSize: 12,
                                color:'#747474'
                            }
                        },
                        axisTick:{
                            show:false
                        },
                        axisLine:{
                            lineStyle:{
                                color:'#ccc'
                            }
                        },
                        splitLine: {
                            show:true,
                            lineStyle:{
                                type:'dotted'
                            }
                        }
                    },
                    yAxis : {
                        type : 'value',
//                        min:0,
//                        max:8,
                        //interval:4,
                        splitLine: {
                            show: true,
                            //interval: 4,
                            lineStyle: {
                                color: ['#ccc'],
                                width: 1,
                                type: 'doted'
                            }
                        },
                        splitArea:{
                            //interval:4
                        },
                        axisTick:{
                            show:false
                        },
                        axisLine:{
                            lineStyle:{
                                color:'#ccc'
                            }
                        },
                        axisLabel: {
                            textStyle: {
                                fontSize: 10,
                                color:'#747474'
                            }
                        }
                    },
                    series : [
                        {
                            name:'最高分',
                            type:'line',
                            data:self.datamax,
                            lineStyle:{
                                normal:{
                                    color:'#FFA800',
                                    width:2
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#FFA800'
                                }
                            }
                        },
                        {
                            name:'最低分',
                            type:'line',
                            data:self.datamin,
                            lineStyle:{
                                normal:{
                                    color:'#C2C2C2',
                                    width:2
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#C2C2C2'
                                }
                            }
                        },
                        {
                            name:'平均分',
                            type:'line',
                            data:self.dataavg,
                            lineStyle:{
                                normal:{
                                    color:'#009AFF',
                                    width:2
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#009AFF'
                                }
                            }
                        }
                    ]
                }
                myChart.setOption(option)
            },
            reportinfo:function(){
                var self=this
                var data={
                    command:'report/czqxbj'
                }
                function callback(res){
                    self.classinfo[0].text=res.classname
                    self.classinfo[1].text=res.classstdcount
                    self.classinfo[2].text=res.starttime.slice(5,16)+' ~ '+res.endtime.slice(5,16)
                    self.datamax=[res.onlinescore.maxscore,res.robotscore.maxscore,res.modelscore.maxscore,res.bookingscore.maxscore,res.oscescore.maxscore]
                    self.dataavg=[res.onlinescore.avgscore,res.robotscore.avgscore,res.modelscore.avgscore,res.bookingscore.avgscore,res.oscescore.avgscore]
                    self.datamin=[res.onlinescore.minscore,res.robotscore.minscore,res.modelscore.minscore,res.bookingscore.minscore,res.oscescore.minscore]
                    self.drawlinechart()
                }
                post('/report/czqxbj',data,callback,errcodefn,errfn)
            }
        }
    })
</script>
</body>
</html>