<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考官考试报告</title>
    <link href="../common/css/report.css" rel="stylesheet" type="text/css">
</head>
<script src="../common/js/jquery-1.11.3.js" charset="utf-8" type="text/javascript"></script>
<script src="../common/js/echarts-all.js" charset="utf-8" type="text/javascript"></script>
<script src="../common/js/echarts.min.js" charset="utf-8" type="text/javascript"></script>

<body>
<div id="container">
    <h2 id="testName">OSCE考试-考官-该站汇总分析报告</h2>
    <div class="contentbox">
        <div class="userinfo">
            <ul>
                <li>
                    <span class="fontstyle">姓名</span>
                    <span class="usenm" id="examiner"></span>
                </li>
                <li>
                    <span class="fontstyle">工号</span>
                    <span class="usenm" id="jobNo"></span>
                </li>
                <li>
                    <span class="fontstyle">考站</span>
                    <span class="usenm" id="station"></span>
                </li>
                <li>
                    <span class="fontstyle">教室</span>
                    <span class="usenm" id="classroom"></span>
                </li>
                <li>
                    <span class="fontstyle">方式</span>
                    <span class="usenm" id="testWay"></span>
                </li>
            </ul>
        </div>

        <div class="score">
            <div class="score-classfiy fontalgin">平均分</div>
            <div class="score-classfiy">
                <span class="score-numb" id="avgScore1"></span> 分
            </div>
            <div class="score-classfiy fontalgin">通过率 <span id="passRate"></span>％</div>
        </div>

        <!--各考站成绩分析-->
        <div class="contentbox">
            <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabkeyvalue">
                <tr>
                    <td colspan="2" style="text-align: center; background-color: #cccccc;">成绩关键点分值</td>
                </tr>
                <tr>
                    <td>项目</td>
                    <td>分值</td>
                </tr>
                <tr>
                    <td>最高分</td>
                    <td id="maxScore">-</td>
                </tr>
                <tr>
                    <td>中值</td>
                    <td id="mediuScore">-</td>
                </tr>
                <tr>
                    <td>平均分</td>
                    <td id="avgScore">-</td>
                </tr>
                <tr>
                    <td>最低分</td>
                    <td id="minScore">-</td>
                </tr>
            </table>
        </div>

        <div class="distrivution">成绩区段人数分布</div>
        <div class="chart">
            <div class="covar"></div>
            <div id="main" style="width:100%; height: 350px;float:left;"></div>
        </div>

        <!-- 考生成绩列表 -->
        <div class="contentbox">
            <table cellpadding="0" cellspacing="0" border="0" class="datalist" width="100%" id="tabscorelist">
                <tr>
                    <th colspan="7" style="text-align: center; background-color: #cccccc;">考生成绩列表</th>
                </tr>

                <tr>
                    <th style="width: 20%">排名</th>
                    <th>姓名</th>
                    <th>成绩</th>

                </tr>
            </table>
        </div>

    </div>
</div>
<script type="text/javascript">
    $( document ).ready(function() {
        var jsondata = null;
        var data = {"errcode":"0","errdesc":"success","reportinfo":{"sectiondistribution":{"s70to80":0,"lessthan60":0,"s60to70":0,"s80to90":1,"morethan90":7},"rankinglist":[{"ranking":1,"score":96,"name":"毛昳涵"},{"ranking":2,"score":96,"name":"黎玉燕"},{"ranking":3,"score":95,"name":"石岩"},{"ranking":4,"score":93,"name":"李永达"},{"ranking":5,"score":92,"name":"高星"},{"ranking":6,"score":92,"name":"陈瑛"},{"ranking":7,"score":92,"name":"黄志恒"},{"ranking":8,"score":87,"name":"汤欢娜"}],"basicinfo":{"examinername":"陈正益","testway":"OSCE","testname":"OSCE考试-考官-该站汇总分析报告","stationname":"临床操作","teachercode":"0629","classroomno":"2120"},"keyvalue":{"avgscore":92.875,"passrate":1,"minscore":87,"totalcount":8,"maxscore":96,"medianscore":92.5},"rfss":100},"command":"osce/report/examinerreport"};
        if(data && (data.errcode == "0" || data.errcode == 0)){
            jsondata = data.reportinfo;
        }

        //console.log(jsondata);

        /*
         数据格式：{"1":{"command": "report/testreport", "errdesc":"invalid command.","errcode":"11",
         "reportinfo":
         {
         "basicinfo": {
         “testName” : “OSCE考试考官分析报告”,
         "examiner": "李天玉",
         "jobNo": "777888",
         "station": "第二站－病史分析",
         "classroom": "601-1",
         "testWay": "OSCE"
         },
         "keyValue": {
         "maxScore": 90,
         "mediuScore": 70,
         "avgScore": 67.82,
         "minScore": 48,
         "passRate": 75.69,
         "totalNum": 180
         },
         "sectiondistribution": {
         "lessthan60": 9,
         "s60to70": 82,
         "s70to80": 41,
         "s80to90": 34,
         "morethan90": 14
         }
         }}}
         */

        // 基于准备好的dom，初始化echarts实例
        if(jsondata){
            $("#testName").text(jsondata.basicinfo.testname + "考官分析报告");
            $("#examiner").text(jsondata.basicinfo.examinername);
            $("#jobNo").text(jsondata.basicinfo.teachercode);
            $("#station").text(jsondata.basicinfo.stationname);
            $("#classroom").text(jsondata.basicinfo.classroomno);
            $("#testtime").text(jsondata.basicinfo.testtime);
            if(jsondata.basicinfo.testway){
                $("#testWay").text(jsondata.basicinfo.testway);
            }




            if(jsondata.keyvalue){
                if(jsondata.keyvalue.avgscore){
                    $("#avgScore1").text(jsondata.keyvalue.avgscore.toFixed(2));
                    $("#avgScore").text(jsondata.keyvalue.avgscore.toFixed(2));
                }


                if(jsondata.keyvalue.passrate != undefined){
                    $("#passRate").text(((jsondata.keyvalue.passrate)*100).toFixed(2));
                }

                if(jsondata.keyvalue.maxscore){
                    $("#maxScore").text(jsondata.keyvalue.maxscore.toFixed(2));
                }

                if(jsondata.keyvalue.medianscore){
                    $("#mediuScore").text(jsondata.keyvalue.medianscore.toFixed(2));
                }

                if(jsondata.keyvalue.minscore){
                    $("#minScore").text(jsondata.keyvalue.minscore.toFixed(2));
                }

            }

            if(jsondata.sectiondistribution && jsondata.keyvalue){
                var myChart = echarts.init(document.getElementById('main'));

                option = {
                    title : {
                        text: '总人数：' + jsondata.keyvalue.totalcount + '人',
                        subtext: '',
                        x:'right'
                    },
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left',
                        data: [''+(jsondata.rfss*0.6).toFixed(2)+'分以下：' + jsondata.sectiondistribution.lessthan60 + '人',
                            ''+(jsondata.rfss*0.6).toFixed(2)+'－'+(jsondata.rfss*0.7).toFixed(2)+'分：' + jsondata.sectiondistribution.s60to70 + '人',
                            ''+(jsondata.rfss*0.7).toFixed(2)+'－'+(jsondata.rfss*0.8).toFixed(2)+'分：' + jsondata.sectiondistribution.s70to80 + '人',
                            ''+(jsondata.rfss*0.8).toFixed(2)+'－'+(jsondata.rfss*0.9).toFixed(2)+'分：' + jsondata.sectiondistribution.s80to90 + '人',
                            ''+(jsondata.rfss*0.9).toFixed(2)+'－'+jsondata.rfss.toFixed(2)+'分：' + jsondata.sectiondistribution.morethan90 + '人']
                    },
                    series : [
                        {
                            name: '访问来源',
                            type: 'pie',
                            radius : '55%',
                            center: ['50%', '60%'],
                            data:[
                                {value: jsondata.sectiondistribution.lessthan60, name:''+(jsondata.rfss*0.6).toFixed(2)+'分以下：' + jsondata.sectiondistribution.lessthan60 + '人'},
                                {value: jsondata.sectiondistribution.s60to70, name:''+(jsondata.rfss*0.6).toFixed(2)+'－'+(jsondata.rfss*0.7).toFixed(2)+'分：' + jsondata.sectiondistribution.s60to70 + '人',},
                                {value: jsondata.sectiondistribution.s70to80, name:''+(jsondata.rfss*0.7).toFixed(2)+'－'+(jsondata.rfss*0.8).toFixed(2)+'分：' + jsondata.sectiondistribution.s70to80 + '人'},
                                {value: jsondata.sectiondistribution.s80to90, name:''+(jsondata.rfss*0.8).toFixed(2)+'－'+(jsondata.rfss*0.9).toFixed(2)+'分：' + jsondata.sectiondistribution.s80to90 + '人'},
                                {value: jsondata.sectiondistribution.morethan90, name:''+(jsondata.rfss*0.9).toFixed(2)+'－'+jsondata.rfss.toFixed(2)+'分：' + jsondata.sectiondistribution.morethan90 + '人'}
                            ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };


                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            }
        }


        // 学生成绩列表
        if(jsondata.rankinglist){

            var $tabscorelist = $("#tabscorelist");

            for(var i=0; i< jsondata.rankinglist.length; i++){

                var tmpstr = "<tr>";
                var str1 = "<td style='width: 20%'>" +  jsondata.rankinglist[i].ranking + "</td>";
                tmpstr = tmpstr + str1;

                var str2 = "<td>" +  jsondata.rankinglist[i].name + "</td>";
                tmpstr = tmpstr + str2;

                var str3 = "<td>" +  jsondata.rankinglist[i].score.toFixed(2) + "</td>";
                tmpstr = tmpstr + str3;

                tmpstr = tmpstr + "</tr>";

                $tabscorelist.append(tmpstr);

            }

        }


    });

</script>
</body>
</html>