<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Title</title>
		<script src="../../js/jquery-1.11.3.js"></script>
		<script src="../../layer/xie/layer1.js"></script>
		<script src="../../js/scmp/common.js"></script>
		<script src="../../js/vue.js"></script>
		<script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
		<script src="../../js/scmp/jquery-ui.js"></script>
		<link rel="stylesheet" href="../../css/assistant/style.css">
		<link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="../../css/scmp/scmpcommon.css">
		<style scoped="scoped">
			.container-fluid {
				height: 100%;
				min-height: 100%;
				overflow: auto;
			}
			
			 ::-webkit-scrollbar {
				width: 0px
			}
			
			#choosePlace {
				float: left;
				position: relative;
				width: 200px;
			}
			
			#header>button {
				float: right;
			}
			
			#header {
				height: 44px;
			}
			
			#choosePlace>div {
				position: absolute;
				top: 40px;
				left: 0;
				background-color: white;
				border: 1px solid #aaa;
				border-radius: 5px;
				padding: 10px;
			}
			
			#choosePlace>p {
				height: 34px;
				line-height: 34px;
				border-radius: 5px;
				border: 1px solid #aaa;
				padding: 0 10px;
				cursor: pointer;
			}
			
			#choosePlace>p:hover {
				background-color: #E5E6E8;
			}
			
			#choosePlace>div>ul>li {
				padding: 2px 0;
				cursor: pointer;
			}
			
			#choosePlace>div>ul>li:hover {
				background-color: #E5E6E8;
			}
			
			#choosePlace>div>ul {
				height: 144px;
				overflow: auto;
			}
			
			#choosePlace>p>i {
				position: relative;
				top: 8px;
			}
			
			.activeStep {
				border-bottom: 2px solid #FFD629;
				color: #2088c2;
				font-weight: bold;
			}
			
			.normalStep {
				border-bottom: 2px solid #ACAC7C;
				color: #aaa;
			}
			
			#nav {
				clear: both;
				margin-bottom: 20px;
				padding-top: 20px;
			}
			
			#setTime th,
			#setTime td {
				text-align: center;
			}
			
			#ui-datepicker-div {
				border-radius: 5px;
				background-color: white;
				padding: 10px 20px;
				box-shadow: 10px 10px 5px #222;
			}
			
			#headerForm {
				padding-left: 40px;
			}
			
			#headerForm select {
				margin-left: 40px;
			}
			
			#title {
				background-color: #E5E6E8;
				height: 40px;
				line-height: 40px;
				padding-left: 20px;
				margin-bottom: 20px;
			}
		</style>
	</head>

	<body>
		<div class="container-fluid" v-cloak>
			<div id="title" style="background-color: #E5E6E8;display: inline-block;height: 40px;line-height: 40px;padding-left: 20px;margin-bottom: 20px;width: 100%;">
				<a href="addvance.html">开放日历设置</a>&gt;&gt;新增开放时间
			</div>
			<!-- 增加时间段模态框（Modal） -->
			<div class="modal fade" id="setTimeRange" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
							<h4 class="modal-title" id="myModalLabel">
                            新增开放时段
                        </h4>
						</div>
						<div class="modal-body">
							<div class="row mt20">
								<span class="col-sm-2 text-right">开放时段:</span>
								<div class="col-sm-10">
									<table class="table table-striped table-bordered table-hover" id="setTime">
										<tr>
											<th>课节</th>
											<th>上课时间</th>
											<th>下课时间</th>
											<th>开放</th>
										</tr>
										<tr v-for="(item,index) in timeList">
											<td>第{{item.value}}节</td>
											<td>{{item.starttime | filterFun}}</td>
											<td>{{item.endtime | filterFun}}</td>
											<td>
												<input type="checkbox" :value="item" v-model="checkList" />
											</td>

										</tr>
									</table>
								</div>
							</div>
							<div class="row mt20">
								<span class="col-sm-2 text-right">生效期:</span>
								<div class="col-sm-10">
									<div class="row">
										<div class="col-sm-5">
											<input type="text" placeholder="点击选择开始日期" class="form-control f12" id="startDate">
										</div>
										<div class="col-sm-1 text-center" style="line-height:34px;height:34px">至</div>
										<div class="col-sm-5">
											<input type="text" placeholder="点击选择结束日期" class="form-control f12" id="endDate">
										</div>
										<div class="col-sm-1 text-center"></div>
									</div>
								</div>
							</div>
							<div class="row mt20 mb20">
								<span class="col-sm-2 text-right">开放日:</span>
								<div class="col-sm-10" id="week">
									<label for="z1" class="checkbox-inline">
                                    <input type="checkbox" id="z1" value="1">周一
                                </label>
									<label for="z2" class="checkbox-inline">
                                    <input type="checkbox" id="z2" value="2">周二
                                </label>
									<label for="z3" class="checkbox-inline">
                                    <input type="checkbox" id="z3" value="3">周三
                                </label>
									<label for="z4" class="checkbox-inline">
                                    <input type="checkbox" id="z4" value="4">周四
                                </label>
									<label for="z5" class="checkbox-inline">
                                    <input type="checkbox" id="z5" value="5">周五
                                </label>
									<label for="z6" class="checkbox-inline">
                                    <input type="checkbox" id="z6" value="6">周六
                                </label>
									<label for="z7" class="checkbox-inline">
                                    <input type="checkbox" id="z7" value="7">周日
                                </label>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" @click="saveTimeRange()">保存</button>
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<div id="header">
				<div id="choosePlace" class="left" style="float: left;width: 200px;position: relative;">
					<p id="addState" style="height: 34px;line-height: 34px;border-radius: 5px;border: 1px solid #aaa;cursor: pointer;padding: 0 10px;">
						<span id="choosedPreExe">{{ choosedSite[0].sitename }}</span>
						<i class="glyphicon glyphicon-chevron-down f12 right" style="position: relative;top: 8px;"></i>
					</p>
					<div id="placeDropDown" v-show="dropDown" style="position: absolute;left: 0;top: 40px;background-color: white;border-radius: 5px;border: 1px solid lightgray;padding: 10px;">
						<p class="form-group has-feedback">
							<span class="glyphicon glyphicon-search form-control-feedback"></span>
							<input type="text" class="form-control f12" id="username" placeholder="输入场地名称" v-model="search">
						</p>
						<ul style="height: 144px;overflow: auto;">
							<li @click="choosePreExe(index)" v-for="(value,index) in siteList" style="padding: 2px 0;cursor: pointer;">
								<span>{{ value.sitename }}</span>
							</li>
						</ul>
					</div>
				</div>
				<div class="left form-inline" id="headerForm">
					<div class="form-group" style="padding-left: 40px;">
						<label for="maxnum">允许最多训练人数：</label>
						<input type="text" class="form-control" id="maxNum" placeholder="请输入人数">
					</div>
					<div class="form-group" style="padding-left: 40px;">
						<select id="setAdmin" class="form-control">
							<option value="-1">请选择管理员</option>
							<option :value="value.teacherid" v-for="(value,index) in adminList">{{ value.teacherame }}</option>
						</select>
					</div>
				</div>
				<button class="btn btn-primary" onclick="openControlExeType()" style="float: right;">训练位类型维护</button>
			</div>
			<div id="nav" style="clear: both;padding-top: 20px;margin-bottom: 20px;">
				<ul class="list-inline">
					<li class="activeStep" style="border-bottom: 2px solid #FFD629;color: #2088c2;font-weight: bold;">第一步:设置训练位</li>
					<li class="normalStep" style="margin-left:20px;border-bottom: 2px solid #ACAC7C;color: #aaa;">第二步:设置开放时间</li>
				</ul>
			</div>
			<div id="content">
				<div id="setExercise">
					<div class="shadowContent">
						<table class="table table-bordered table-striped table-hover f12">

							<tr>
								<th>训练位编号</th>
								<th>训练位类型</th>
								<th>训练项</th>
								<th>操作</th>
							</tr>
							<tr v-for="(value,index) in choosedTotal">
								<td>{{ value.code }}</td>
								<td>{{ value.workstationtypename }}</td>
								<td><span v-for="value1 in choosedTotal[index].learnids">{{ value1.name }}--{{ value1.type | learntype }}&nbsp;&nbsp;&nbsp;</span></td>
								<td>
									<button class="btn btn-danger btn-xs" onmouseover="infoDelete()" @click="deleteOneExe(index)" id="deleteOneExe">
                                       删除
                                    </button>
								</td>
							</tr>

							<tr v-show="addShow">
								<td>
									<input type="text" placeholder="请输入训练位编号" id="code" class="form-control" v-model="trainingNum">
								</td>
								<td>
									<select id="exeType" class="form-control" @change="getExeList" v-model="trainingType" @focus="selectBlur">
										<!--<option value="请选择训练位类型">请选择训练位类型</option>-->
										<option :value="value.id" v-for="(value,index) in exeType">{{ value.traintypename }}</option>
									</select>
								</td>
								<td id="addTrainName">
									<span v-for="value in exeListById" v-show="typeList">{{ value.name }}--{{ value.type | learntype }}&nbsp;&nbsp;&nbsp;</span>
								</td>
								<td class="text-info poi">
									<button class="btn btn-danger btn-xs" @click="deleteBtn(index)">
                                删除
                                    </button>
								</td>
							</tr>
						</table>
						<div class="bottomHandlers">
							<button class="btn btn-primary" @click="addBtn">增加</button>
							<button class="btn btn-primary " onclick="toNext()">下一步</button>&nbsp;
						</div>
					</div>
				</div>
				<div id="setOpenTime" class="hide table-responsive">
					<table class="table table-bordered table-striped  f12">
						<tr>
							<th>开放日期</th>
							<th>时间段</th>
							<th>有效期</th>
							<th>操作</th>
						</tr>
						<tr v-for="(value,index) in choosedTimeRange">
							<td>{{ value.open_day | week }}</td>
							<td style="white-space: normal;word-break: break-all;">
								<span v-for="value1 in choosedTimeRange[index].opentimes">{{value1.open_start_dt }}-{{value1.open_end_dt}}&nbsp;&nbsp;&nbsp;&nbsp;</span>
							</td>
							<td>
								{{ value.start_dt.slice(0,10) }}~{{ value.end_dt.slice(0,10) }}
							</td>
							<td>
								<button class="btn btn-danger btn-xs" @click="deleteOneTimeRange(index)" id="deleteOneTime">删除 
                            </button>
							</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td>
								<button class="btn btn-info btn-xs" onmouseover="infoAdd()" data-toggle="modal" data-target="#setTimeRange" id="addOneTime">
                                <i class="glyphicon glyphicon-plus"></i>开放时间段
                            </button>
							</td>
						</tr>
					</table>
					<div class="bottomHandlers">
						<button class="btn btn-default" onclick="goPrevStep()">上一步</button>&nbsp;&nbsp;
						<button class="btn btn-primary" onclick="saveAll()">保存</button>&nbsp;&nbsp;
					</div>
				</div>
			</div>
		</div>
		<script>
			Vue.filter('week', function(value) { //过滤训练项类型
				value = value.split(",");
				var newArr = [];
				for(index in value) {
					value[index] == 1 && newArr.push('周一');
					value[index] == 2 && newArr.push('周二');
					value[index] == 3 && newArr.push('周三');
					value[index] == 4 && newArr.push('周四');
					value[index] == 5 && newArr.push('周五');
					value[index] == 6 && newArr.push('周六');
					value[index] == 7 && newArr.push('周日')
				};
				return newArr.join(',')
			});
			Vue.filter('learntype', function(value) { //过滤训练项类型
				if(value == "0") {
					return "在线训练"
				} else if(value == "1") {
					return "模型"
				} else if(value == "2") {
					return "智能设备"
				}
			});
			var vm = new Vue({
				el: '.container-fluid',
				data: {
					siteList: [],
					dropDown: false,
					choosedSite: [{ sitename: '请选择场地' }],
					exeType: [],
					exeListById: [],
					choosedTotal: [], //用户在第一步：设置训练项页面上选择的记录
					startH: ["07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22"],
					endH: ["07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23"],
					startM: ["00", "05", "10", "15", "20", "25", "30", "35", "40", "45", "50", "55"],
					endM: ["00", "05", "10", "15", "20", "25", "30", "35", "40", "45", "50", "55"],
					choosedTimeArr: [],
					choosedTimeRange: [],
					adminList: [],
					timeList: '',
					checkList: [],
					startTime: '',
					endTime: '',
					allTimeList: [],
					addShow: false,
					trainingNum: '',
					trainingType: '',
					num: 1,
					typeList: false,
					search: '',
					newSiteList: [],
					newList: ''
				},
				watch: {
					'search': function(curVal, oldVal) {
						if(curVal != '') {
							this.newSiteList = [];
							for(var i = 0; i < this.siteList.length; i++) {
								if(this.siteList[i].sitename.indexOf(curVal) != -1) {
									this.newSiteList.push(this.siteList[i])
								}
							}
							this.siteList = this.newSiteList;
						} else {
							this.siteList = this.newList;
						}

					}
				},
				mounted: function() {
					let self = this;
					self.getExeType();
					self.getPlaceList();
					$.ajax({
						type: "post",
						url: "/examapply/queryexamtimeslist",
						async: true,
						data: JSON.stringify({
							'1': {
								command: "examapply/queryexamtimeslist",
								sessionid: getCookie('sid'),
								loginid: getCookie('uid')

							}
						}),
						success: function(data) {
							self.timeList = JSON.parse(data['1'].timeslist);
						}
					});

				},
				filters: {
					filterFun: function(value) {
						return value.substring(0, 5)
					}

				},
				methods: {
					getExeList: function() {

						var self = this;
						var data = {
							command: 'learn/querylearninfobyid',
							sessionid: getCookie('sid'),
							loginid: getCookie('uid'),
							workstationtypeid: self.trainingType
						};

						function callback(res) {
							self.exeListById = res.learnids;
							self.typeList = true;
						};
						post('/learn/querylearninfobyid', data, callback, errcodefn, errfn)
					},
					selectBlur: function() {
						this.getExeType();
					},
					getPlaceList: function() { //获取授课地点的函数
						var self = this;
						var json = {
							command: "site/sitelist",
							loginid: getCookie('uid'),
							sessionid: getCookie('sid')
						};

						function callback(response) {
							self.siteList = [];
							self.siteList = response.sitelist;
							self.newList = response.sitelist;

						};
						post("/site/sitelist", json, callback, errcodefn, errfn)
					},
					addBtn: function() {
						var self = this;
						self.typeList = true;
						if(self.num == 1) {
							self.addShow = true;
							self.num++;
						} else {
							self.num++;
							if(self.trainingNum != '' && self.trainingType != '') {
								for(index in self.exeType) {
									if($("#exeType").val() == self.exeType[index].id) {
										var typenameadd = self.exeType[index].traintypename
									}
								};
								self.choosedTotal.push({
									code: $("#code").val(),
									workstationtypeid: $("#exeType").val(),
									workstationtypename: typenameadd,
									learnids: self.exeListById
								})
								//this.addShow=false;
								self.trainingNum = "";
								self.trainingType = "";
								self.typeList = false;
							} else {
								self.typeList = false;
								layer.msg('请输入训练位号或者选择训练位类型', { icon: 5 })
							}
						}
					},
					deleteBtn: function() {
						this.addShow = false;
						this.trainingNum = "";
						this.trainingType = "";
						this.num = 1;
					},
					deleteOneExe: function(index) {
						this.choosedTotal.splice(index, 1);
					},
					choosePreExe: function(index) {
						var self = this;
						self.choosedSite = [];
						self.choosedSite.push(
							self.siteList[index]
						);
						self.dropDown = false;
					},
					deleteOneTime: function(index) { //删除一条开始-结束时间点记录
						var self = this;
						self.choosedTimeArr = deleteItem(self.choosedTimeArr, index);
					},
					saveTimeRange: function() {
						for(var i = 0; i < this.checkList.length; i++) {
							this.choosedTimeArr.push({
								open_start_dt: this.checkList[i].starttime,
								open_end_dt: this.checkList[i].endtime
							});
						}
						var self = this;
						var zhouStr = ""; //用户本次选择的周字符串
						$("#week input:checked").each(function() {
							zhouStr += ($(this).val() + ',')
						});
						if(self.checkList.length == 0) {
							layer.msg('请添加开放时段', { icon: 5 });
							self.choosedTimeArr = [];
							self.checkList = [];
							self.allTimeList = [];
							return
						};
						if($("#startDate").val().length == 0 || $("#endDate").val().length == 0) {
							layer.msg('请选择生效期', { icon: 5 });
							self.choosedTimeArr = [];
							self.checkList = [];
							self.allTimeList = [];
							return
						};
						if(getTimes($("#startDate").val()) > getTimes($("#endDate").val())) {
							layer.msg("结束时间必须大于开始时间", { icon: 5 })
							self.choosedTimeArr = [];
							self.checkList = [];
							self.allTimeList = [];
							return
						}
						if(zhouStr.length == 0) {
							layer.msg('请选择开放日', { icon: 5 });
							self.choosedTimeArr = [];
							self.checkList = [];
							self.allTimeList = [];
							return
						};
						console.log(self.choosedTimeRange);
						if(self.choosedTimeRange.length != 0) { //如果已有>=1条时间段记录
							var choosedWeekDay = [];
							for(var i = 0; i < self.choosedTimeRange.length; i++) { //得到所有已选的周几
								var weekArr = self.choosedTimeRange[i].open_day.split(',');
								for(var j = 0; j < weekArr.length; j++) {
									choosedWeekDay.push(weekArr[j])
								}
							};
							tempStr = zhouStr.slice(0, zhouStr.length - 1);
							var weekDayThisTime = tempStr.split(',');
							var repeatWeekDay = [];
							for(var i = 0; i < weekDayThisTime.length; i++) {
								for(var j = 0; j < choosedWeekDay.length; j++) {
									if(weekDayThisTime[i] == choosedWeekDay[j]) {
										repeatWeekDay.push(weekDayThisTime[i])
									}
								}
							};

							for(var i = 0; i < self.choosedTimeRange.length; i++) {
								var oldTimeSt = Date.parse(new Date(self.choosedTimeRange[i].start_dt));
								var oldTimeEt = Date.parse(new Date(self.choosedTimeRange[i].end_dt));
								var newTimeSt = Date.parse(new Date($('#startDate').val()));
								var newTimeEt = Date.parse(new Date($('#endDate').val()));
								console.log(oldTimeSt);
								console.log(oldTimeEt);
								console.log(newTimeSt);
								console.log(newTimeEt);
								if(newTimeSt <= oldTimeSt && newTimeEt >= oldTimeSt && repeatWeekDay.length != 0) {
									layer.msg('对不起！您已选择周' + repeatWeekDay.join(',') + ',不能重复选择', { icon: 5 });
									self.choosedTimeArr = [];
									self.checkList = [];
									self.allTimeList = [];
									return
								}
								if(newTimeSt <= oldTimeEt && newTimeEt >= oldTimeEt && repeatWeekDay.length != 0) {
									layer.msg('对不起！您已选择周' + repeatWeekDay.join(',') + ',不能重复选择', { icon: 5 });
									self.choosedTimeArr = [];
									self.checkList = [];
									self.allTimeList = [];
									return
								}

								if(newTimeSt >= oldTimeSt && newTimeEt <= oldTimeEt && repeatWeekDay.length != 0) {
									layer.msg('对不起！您已选择周' + repeatWeekDay.join(',') + ',不能重复选择', { icon: 5 });
									self.choosedTimeArr = [];
									self.checkList = [];
									self.allTimeList = [];
									return
								}

							};
							//                      if($("#startDate").val()!=self.choosedTimeRange[0].start_dt || $("#endDate").val()!=self.choosedTimeRange[0].end_dt){
							//                          layer.msg('对不起！生效期必须一致',{icon:5 });
							//                          self.choosedTimeArr=[];
							//		                    self.checkList=[];
							//		                    self.allTimeList=[];
							//                          return
							//                      };
						};

						for(var i = 0; i < self.checkList.length; i++) {
							self.allTimeList.push(self.checkList[i].starttime.substring(0, 5) + "-" + self.checkList[i].endtime.substring(0, 5))
						}
						self.choosedTimeRange.push({
							open_day: zhouStr,
							start_dt: $("#startDate").val(),
							end_dt: $("#endDate").val(),
							opentimes: self.choosedTimeArr
						});
						layer.msg('已保存一条开放时间段', { icon: 1 });
						self.choosedTimeArr = [];
						$("#setTimeRange").modal('hide');
						self.checkList = [];
						self.allTimeList = [];
					},
					deleteOneTimeRange: function(index) {
						var self = this;
						self.choosedTimeRange = deleteItem(self.choosedTimeRange, index)
					},
					getExeType: function() { //获取训练位类型
						var self = this;
						var data = {
							command: "learn/querylearnworkstation",
							sessionid: getCookie('sid'),
							loginid: getCookie('uid')
						};

						function callback(res) {
							self.exeType = res.traintypenames
						};
						post("/learn/querylearnworkstation", data, callback, errcodefn, errfn)
					}
				}
			});
			getAdminList();

			function closeSetExercise() {
				$("#SetExercise").addClass('hide');
				$("#shadow").addClass('hide');
			};

			function infoDelete() {
				layer.tips('删除训练项', '#deleteOneExe', { tips: 1 })
			};

			function infoDelete1() {
				layer.tips('删除开放时间', '#deleteOneTime', { tips: 1 })
			};

			function infoAdd() {
				layer.tips('增加开放时间', '#addOneTime', { tips: 1 })
			};

			function toNext() {
				if(vm.addShow == false) {
					if(vm.choosedTotal.length != 0) {

						$("#setExercise").addClass('hide');
						$("#setOpenTime").removeClass('hide');
						$("#nav li:eq(0)").attr('class', 'normalStep');
						$("#nav li:eq(1)").attr('class', 'activeStep');
					} else {
						layer.msg('请增加训练位', { icon: 5 });
					}
				} else {
					if($("#code").val().length == 0 || $("#exeType").val() == "请选择训练位类型") {
						layer.msg('请完成选择或输入');
						return
					};
					if($("#code").val().length != 0 && $("#exeType").val() != "请选择训练位类型") {
						vm.add = "1";
					}
					if(vm.choosedTotal.length != 0) {
						for(a in vm.choosedTotal) {
							if($("#code").val() == vm.choosedTotal[a].code) {
								layer.msg('训练位编号不能重复', { icon: 5 });
								return
							}
						}
					};
					for(index in vm.exeType) {
						if($("#exeType").val() == vm.exeType[index].id) {
							var typename = vm.exeType[index].traintypename
						}
					};
					vm.choosedTotal.push({
						code: $("#code").val(),
						workstationtypeid: $("#exeType").val(),
						workstationtypename: typename,
						learnids: vm.exeListById
					})
					vm.addShow = false;
					$("#setExercise").addClass('hide');
					$("#setOpenTime").removeClass('hide');
					$("#nav li:eq(0)").attr('class', 'normalStep');
					$("#nav li:eq(1)").attr('class', 'activeStep');
				}

			};

			//			function preExeSearch(e) {
			//				$("#placeDropDown").toggleClass('hide');
			//				e.stopPropagation();
			//				if(!$("#placeDropDown").hasClass('hide')) {
			//					getPlaceList();
			//				}
			//			};
			$('#addState').click(function(e) {
				vm.dropDown = true;
				e.stopPropagation();
			})
			$('body').click(function() {
				vm.dropDown = false;
			})
			$('"#placeDropDown"').click(function(e) {
				e.stopPropagation();
			})

			function openControlExeType() {
				layer.open({
					type: 2,
					title: '训练项类型维护',
					shadeClose: true,
					shade: 0.7,
					area: ['90%', '90%'],
					content: 'addvanceExeType.html'
				});
			};
			//      function addBtn(){//第一步，设置训练位，保存一条记录
			//          if($("#code").val().length==0 || $("#exeType").val()=="请选择训练位类型"){
			//              layer.msg('请完成选择或输入');
			//              return
			//          };
			//          if ($("#code").val().length!=0&&$("#exeType").val()!="请选择训练位类型") {
			//          	vm.add="1";
			//          }
			//          if(vm.choosedTotal.length!=0){
			//              for(a in vm.choosedTotal){
			//                  if($("#code").val()==vm.choosedTotal[a].code){
			//                      layer.msg('训练位编号不能重复',{icon:5});
			//                      return
			//                  }
			//              }
			//          };
			//          for(index in vm.exeType){
			//              if($("#exeType").val()==vm.exeType[index].id){
			//                  var typename=vm.exeType[index].traintypename
			//              }
			//          };
			//          vm.choosedTotal.push({
			//              code:$("#code").val(),
			//              workstationtypeid:$("#exeType").val(),
			//              workstationtypename:typename,
			//              learnids:vm.exeListById
			//          })
			//      };
			function addOneTime() {
				//开始时间必须早于结束时间
				if(new Date('2017-2-14 ' + $("#startH").val() + ':' + $("#startM").val() + ':00').getTime() >= new Date('2017-2-14 ' + $("#endH").val() + ':' + $("#endM").val() + ':00').getTime()) {
					layer.msg('开始时间必须小于结束时间', { icon: 5 });
					return
				};
				if(vm.choosedTimeArr.length != 0) { //后面选的时间段不能与前面冲突
					for(var i = 0; i < vm.choosedTimeArr.length; i++) {
						var begini = new Date('2017-2-14 ' + vm.choosedTimeArr[i].open_start_dt).getTime();
						var endi = new Date('2017-2-14 ' + vm.choosedTimeArr[i].open_end_dt).getTime();
						var beginj = new Date('2017-2-14 ' + vm.checkList[0].starttime).getTime();
						var endj = new Date('2017-2-14 ' + vm.checkList[0].endtime).getTime();
						if(begini == beginj && endi == endj) { //完全相等的两个时段
							layer.msg('请不要选择重复的时间段', { icon: 5 });
							return
						};
						if(begini > beginj && begini < endj) { //有重复的时段,但不全等
							layer.msg('请不要选择重复的时间段', { icon: 5 });
							return
						};
						if(endi > beginj && endi < endj) { //有重复的时段,但不全等
							layer.msg('请不要选择重复的时间段', { icon: 5 });
							return
						}
					}
				};

			};
			setCalendarInput('#startDate');
			setCalendarInput('#endDate');

			function saveAll() {
				if(!vm.choosedSite[0].siteid) {
					layer.msg('请选择开放场地', { icon: 5 });
					return
				};
				if(vm.choosedTotal.length == 0) {
					layer.msg('请设置训练位', { icon: 5 });
					return
				};
				if(vm.choosedTimeRange.length == 0) {
					layer.msg('请设置开放时间', { icon: 5 });
					return
				};
				if(!$('#maxNum').val()) {
					layer.msg('请设置最大训练人数', { icon: 5 });
					return
				};
				if(isNaN($('#maxNum').val())) {
					layer.msg('最大训练人数必须是数字', { icon: 5 });
					return
				};
				if($('#setAdmin').val() == -1) {
					layer.msg('请选择管理员', { icon: 5 });
					return
				};
				var sendlearnWorkStation = [];
				var sendaddPlaceOpenTimeInfo = [];
				sendaddPlaceOpenTimeInfo = vm.choosedTimeRange;
				for(index in sendaddPlaceOpenTimeInfo) {
					sendaddPlaceOpenTimeInfo[index].place_id = vm.choosedSite[0].siteid;
					sendaddPlaceOpenTimeInfo[index].open_day = sendaddPlaceOpenTimeInfo[index].open_day.slice(0, (sendaddPlaceOpenTimeInfo[index].open_day.length - 1));
					sendaddPlaceOpenTimeInfo[index].start_dt += ' 00:00:00';
					sendaddPlaceOpenTimeInfo[index].end_dt += ' 00:00:00';
				};
				for(var i = 0; i < vm.choosedTotal.length; i++) {
					sendlearnWorkStation.push({
						placeid: vm.choosedSite[0].siteid,
						code: vm.choosedTotal[i].code,
						workstationtypeid: vm.choosedTotal[i].workstationtypeid,
					})
				};
				var data = {
					command: "learn/addplaceandopentime",
					sessionid: getCookie('sid'),
					loginid: getCookie('uid'),
					learnWorkStation: sendlearnWorkStation, //{"placeid":311,"code":66,"workstationtypeid":15}
					addPlaceOpenTimeInfo: sendaddPlaceOpenTimeInfo, // {"place_id":"311","start_dt":"2018-01-01 00:00:00","end_dt":"2019-01-01 00:00:00","open_day":"1,2,3,4,5",
					admin: $('#setAdmin').val(),
					volume: $('#maxNum').val()
					//"opentimes":[{"open_start_dt":"08:00","open_end_dt":"18:00"}]
				};

				function callback(res) {

					layer.msg('成功设置一条开放训练', { icon: 1 }, function() {
						var ifram = window.parent.document.getElementById('addPlace');
						var boxList = window.parent.document.getElementById('addvanceShowList');
						var testTitle = window.parent.document.getElementById('title')
						$(boxList).removeClass('hide');
						$(ifram).remove();
						$(testTitle).removeClass('hide');

					});
					window.parent.vm.openList = [];
					window.parent.showOpenList();

				};
				post('/learn/addplaceandopentime', data, callback, errcodefn, errfn)
			};

			function goPrevStep() {
				$("#setExercise").removeClass('hide');
				$("#setOpenTime").addClass('hide');
				$("#nav li:eq(0)").attr('class', 'activeStep');
				$("#nav li:eq(1)").attr('class', 'normalStep');
			};

			function getAdminList() {
				var data = {
					command: "cls/teacherlist",
					loginid: getCookie('uid'),
					sessionid: getCookie('sid'),
					roleid: 1 // 0表示全部,1表示 运维管理员, 2 表示 运营管理员,3表示授课老师, 4表示教辅老师
				};

				function callback(res) {
					vm.adminList = [];
					vm.adminList = res.teacherlist
				};
				post("/cls/teacherlist", data, callback, errcodefn, errfn)
			};

			function getTimes(date) {
				var timestamp = Date.parse(new Date(date));
				timestamp = timestamp / 1000;
				return timestamp
			}
		</script>
	</body>

</html>