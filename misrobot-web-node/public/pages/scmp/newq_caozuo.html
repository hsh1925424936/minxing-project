<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新建操作题</title>
    <script src="../../js/jquery-1.11.3.js"></script>
    <script src="../../layer/xie/layer1.js"></script>
    <script src="../../js/scmp/common.js"></script>
    <script src="../../js/vue.js"></script>
    <script src="../../js/scmp/newq_compo.js"></script>
    <script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/scmp/addqcommon.css">
</head>
<body>
<div class="container">
    <cpagetitle :title="pagetitletext" :showback="true"></cpagetitle>
    <cmain :maintitle="maintitle[0]">
        <div class="maincontent">
            <textarea cols="30" rows="10" class="form-control" placeholder="输入题目名称,50字以内" v-model="qname" maxlength="50"></textarea>
        </div>
    </cmain>
    <cmain :maintitle="maintitle[1]">
        <div class="maincontent">
            <textarea cols="30" rows="10" class="form-control" placeholder="输入题目描述,300字以内" v-model="qanswer" maxlength="300"></textarea>
        </div>
    </cmain>
    <cmain :maintitle="maintitle[2]">
        <div class="flexcenter">
            <span class="labeltitle">所属学科</span>
            <select class="form-control labelcontent" v-model="seldiscipline">
                <option value="">请选择</option>
                <option v-for="(v,i) in disciplinelist" :value="v.id">{{ v.name }}</option>
            </select>
        </div>
        <div class="flexcenter">
            <span class="labeltitle">技能项</span>
            <select class="form-control labelcontent" v-model="learninfo">
                <option value="">请选择</option>
                <option v-for="(v,i) in learninfolist" :value="v.learnid">{{ v.name }}</option>
            </select>
        </div>
    </cmain>
    
    <div class="footerBtn">
    	<button type="button" class="btn btn-primary" @click="submitnewq">添加评分表</button>
		<button type="button" class="btnBg btn btn-primary" @click="goback">取消</button>
    </div>
</div>
<script>
    var vm=new Vue({
        el:'.container',
        data:{
            qanswer:'',
            qname:'',
            disciplinelist:[],//学科列表
            seldiscipline:'',
            learninfolist:[],//技能项列表
            learninfo:'',
            pagetitletext:'新增题目-操作',//页面标题
            maintitle:['题目名称','题目描述','设置'],//页面主模块标题
        },
        mounted:function(){
            this.querydiscipline();
            this.querylearninfo()
        },
        methods:{
            querydiscipline:function(){//查询学科接口
                var self=this
                var data={
                    command:"cls/selectCourses",
                    sessionid:getCookie('sid'),
                    loginid:getCookie('uid')
                }
                function callback(res){
                    self.disciplinelist=res.courseslist
                }
                post("/cls/selectCourses",data,callback,errcodefn,errfn)
            },
            querylearninfo:function(){//查询学科接口
                var self=this
                var data={
                    command:"learn/querylearninfo",
                    sessionid:getCookie('sid'),
                    loginid:getCookie('uid')
                }
                function callback(res){
                    self.learninfolist=res.learnids;
                }
                post("/learn/selectCourses",data,callback,errcodefn,errfn)
            },
            submitnewq:function(){//保存添加题目接口
                if(this.qname==''){
                    layer.msg('请输入题目名称')
                    return
                }
                if(this.qanswer==''){
                    layer.msg('请完善题目描述')
                    return
                }
                if(this.seldiscipline==''){
                    layer.msg('请选择题目所属学科')
                    return
                }
                if(this.learninfo==''){
                    layer.msg('请选择题目所属技能项')
                    return
                }console.log(this.learninfo)
                var data={
                    command:'question/addoperationquestion',
                    sessionid:getCookie('sid'),
                    loginid:getCookie('uid'),
                    creatorid:getCookie('uid'),
                    name:this.qname,
                    courseid:this.seldiscipline,
                    comment:this.qanswer,
                    learnid:this.learninfo,
                    type:3,
                    cateid:7,
                }
                function callback(res){
                	if(res.errcode==0){
                		window.location.assign("./newq_addgrade.html?id="+res.id)
                	}
//                  var L=layer.confirm('添加题目成功？', {
//                      btn: ['继续添加','不再添加'] //按钮
//                  }, function(){
//                      layer.close(L)
//                      window.location.assign("./newq_addgrade.html?id="+res.id)
//                  }, function(){
//                      layer.close(L)
//                      window.location.assign("./itemBankManagement.html")
//                  })
                }
                post('/question/addoperationquestion',data,callback,errcodefn,errfn)
            },
            goback:function(){
                window.history.go(-1)
            }
        }
    })
</script>
</body>
</html>