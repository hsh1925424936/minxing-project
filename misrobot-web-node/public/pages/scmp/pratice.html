<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../../js/jquery-1.11.3.js"></script>
    <script src="../../layer/xie/layer1.js"></script>
    <script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
    <script src="../../js/vue.js"></script>
    <script src="../../js/scmp/common.js"></script>
    <link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/scmp/scmpcommon.css">
</head>
<style>
    #title{
        background-color: #E5E6E8;
        height:40px;
        line-height: 40px;
        padding-left:20px;
    }
    #search>input{
        font-size:12px;
        float:left;
        height:34px;
        line-height: 34px;
        width:71%;
        border-radius: 5px 0 0 5px;
        padding-left:5%;
        outline: none;
    }
    #search>button{
        float:left;
        display: block;
        width:22%;
    }
    #search{
        overflow: hidden;
        width:30%;
        margin-left: 35%;
    }
    #header>p{
        position: absolute;
        top:0;
        left:0;
    }
    #header{
        position: relative;
        overflow: hidden;
        margin-top:20px;
        height:44px;
    }
    #courseTable{
        margin-top:20px;
        height:426px;
        overflow: auto;
    }
    div.pageInfo{
        float:left
    }
    div.pageNumBox{
        float:right;
    }
    #doorUserFooter{
        overflow: hidden;
        padding:10px 20px 20px 20px;
    }
    div.pageInfo>p{
        margin-left:10px;
    }
</style>
<body>
    <div class="container-fluid" v-cloak="">
        <div id="title">实习计划</div>
        <div id="content">
            <div id="header">
                <p>
                    <button class="btn btn-primary" onclick="addpratice()">增加</button>
                </p>
                <div id="search" class="">
                    <input type="text" v-model="gesearch" placeholder="请输入实习计划名字"/>
                    <button class="btn btn-default" @click="search()"> <i class="glyphicon glyphicon-search"></i> 搜索</button>
                </div>
            </div>
            <div id="courseTable">
                <table class="m0 table table-bordered table-striped table-hover f12">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>实习计划名称</th>
                            <th>开始时间</th>
                            <th>结束时间</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(value,index) in planlist" :data-id="value.id">
                            <td>{{index+1}}</td>
                            <td>{{value.name}}</td>
                            <td>{{value.starttime.slice(0,10)}}</td>
                            <td>{{value.endtime.slice(0,10)}}</td>
                            <td>{{value.plancomment}}</td>
                            <td>
							<button type="button" class="btn btn-primary"  @click="show_mes2(value)">编辑</button>
							<button type="button" class="btn btn-primary"  @click="show_mes(value)">详情</button>
							<button type="button" class="btn btn-primary"  @click="delete_mes(value)">删除</button>
							<button type="button" class="btn btn-primary"  @click="student(value)">学生</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        var vm=new Vue({
            el:'.container-fluid',
            data:{
                planlist:[],//查询实习计划后台返回数组
                plandetail:[],
                gesearch:''
            },
            methods:{
				show_mes:function(value){
		    		layer.open({
			                type: 2,
			                title: value.name+'-实习计划详情',
			                shadeClose: true,
			                shade: 0.8,
			                area: ['50%', '80%'],
			                content: 'praticedetail.html?id='+value.id,
			            });
				},
				show_mes2:function(value){
		    		layer.open({
			                type: 2,
			                title: value.name+'-编辑实习计划',
			                shadeClose: true,
			                shade: 0.8,
			                area: ['50%', '90%'],
			                content: 'praticeedui.html?id='+value.id,
			            });
				},
				search:function(){
				var self=this;
				var data={
					command:'plan/listplan',//接口地址
    				sessionid:getCookie('sid'),
    				loginid:getCookie('uid'),
    				name:self.gesearch
				};
				function callback(res){
    				vm.planlist=res.plans;
    			};
    			post('/plan/listplan',data,callback,errcodefn,errfn)
				},
				//删
				delete_mes:function(value){
					var self=this
					var L= layer.confirm('确定要删除此实习计划吗？', {
                    btn: ['确定','取消'] //按钮
                },function(){
					var data={
						command:'plan/deleteplan',//接口地址
		    			sessionid:getCookie('sid'),
		    			loginid:getCookie('uid'),
						id:value.id
					};
					console.log(JSON.stringify(data))
					function callback(res){
		    			layer.msg('成功删除');
		    			show_plan();
		    		};
		    		post('/plan/deleteplan',data,callback,errcodefn,errfn)
                })
					},
				student:function(value){
					layer.open({
							type: 2,
			                title: value.name+'-学生',
			                shadeClose: true,
			                shade: 0,
			                area: ['100%', '100%'],
			                content: 'praticestudent.html?id='+value.id,
					});
				},
            }
        });
		show_plan();
		function show_plan(){
			var data={
				command:'plan/listplan',//接口地址
    			sessionid:getCookie('sid'),
    			loginid:getCookie('uid')
    			//uid:getCookie('uid'),
//  			page:pagenum,
//              reqnum:perpagenum,
			};
			function callback(res){
    			vm.planlist=res.plans;
    		};
    		post('/plan/listplan',data,callback,errcodefn,errfn)
		};
		
		function addpratice(){//“新建实习计划”按钮
            layer.open({
            	type:2,
                title: '新建实习计划',
                shadeClose: true,
                shade: 0.8,
                area: ['50%', '90%'],
                content: 'addpratice.html'
            });
      };
        function student(elem){
            var sche=$(elem).parents("tr").data("id");
            var name=$(elem).parents("tr").children("td").eq(1).text();
            layer.open({
                type: 2,
                title: name+'学生',
                shadeClose: true,
                shade: 0,
                area: ['50%', '60%'],
                content: 'praticestudent.html?id='+sche
            });
        };
    </script>
</body>
</html>