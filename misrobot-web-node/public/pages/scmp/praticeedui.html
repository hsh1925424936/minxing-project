<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<title>实习计划详情</title>
	<script src="../../js/jquery-1.11.3.js"></script>
    <script src="../../layer/xie/layer1.js"></script>
    <script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
    <script src="../../js/vue.js"></script>
    <link rel="stylesheet" href="../../css/assistant/style.css">
	<link rel="stylesheet" href="../../css/scmp/scmpcommon.css">
	<link rel="stylesheet" href="../../css/scmp/newskill.css">
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-default/index.css">
    <script src="../../js/scmp/common.js"></script>
    <link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-default/index.css">
	</head>
	<style>
	.add_pratice{
		width: 520px;
		height: 585px;
		border: 1px solid;
		position: fixed;
		left: 100px;
		background-color: white;
	}
	.praticeTop{
		height: 40px;
		border-bottom: 1px solid;
		background-color: silver;
	}
	.praticeTop{
		height: 40px;
		border-bottom: 1px solid;
		background-color: silver;
	}
	.praticeTop>p:nth-child(1){
		position: absolute;
		left: 10px;
		top: 10px;
	}
	.praticeTop>p:nth-child(2){
		height: 50px;
		line-height: 50px;
		position: absolute;
		right: 10px;
		font-size: 20px;
		cursor: pointer;
	}
	.praticedetail{
		width: 454px;
	}
	.pra_name{
		margin-left: 52px;
		margin-top: 32px;
	}
	.pra_time{
		margin-left: 52px;
		margin-top: 10px;
	}
	.pra_remarks{
		margin-left: 52px;
		margin-top: 10px;
		text-align: center;
	}
	.remarks_text{
		margin-left: 27px;
		width: 320px;
		height: 100px;
		max-height: 100px;
		max-width: 320px;
	}
	.pra_skill{
		margin-left: 54px;
		margin-top: 10px;
	}
	#shadow{
		position:fixed;
		top:0;
		left:0;
		width:100%;
		height:100%;
		background-color:rgba(0,0,0,0.3)
	}
	.gebtu{
		margin-left: 190px;
	}
	</style>
	<body>
		<div class="detail_pratice" id="detail_pratice" v-cloak>
			<div class="praticedetail" id="praticedetail">
				<div class="pra_name">
					<span class="name">计划名称 ：</span>
					<!--<span>{{planname}}</span>-->
					<input v-model='planname' type="text" class="planname" size="11"/>
				</div>
				<div class="pra_time">
					<template>
						  <div class="block">
						    <span class="demonstration">开始时间：</span>
						    <el-date-picker
						      v-model="starttime"
						      type="date"
						      placeholder="选择日期"
							  @change="dateChange"
						      :picker-options="pickerOptions0">
						    </el-date-picker>
						  </div>
						</template>
						<template>
						  <div class="block">
						    <span class="demonstration2">结束时间：</span>
						    <el-date-picker
						      v-model="endtime"
						      type="date"
						      placeholder="选择日期"
							  @change="dateChange1"
						      :picker-options="pickerOptions1">
						    </el-date-picker>
						  </div>
						</template>
				</div>
				<div class="pra_remarks">
					<span class="remarks">备注 ：</span>
					<textarea class="remarks_text" v-model='plancomment'></textarea>
					<!--<span>{{plancomment}}</span>-->
				</div>
				<div class="pra_skill">
                    <p class="skill">技能选项:</p>
                    <table id="stuMsg" class="table table-bordered">
                        <thead>
                            <tr>
                              <th>序号</th>
                              <th>技能名称</th>
                              <th>操作</th>
                            </tr>
                            <tr v-for="(value,index) in finallychoosed">
                               <td>{{index+1}}</td>
                               <td>{{value.name}}</td>
                               <td @click='deleteonelearn(index)'>删除</td>
                        	</tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <td></td>
                                <td></td>
                                <td id="moreSkill" @click="skill()"><span class="glyphicon glyphicon-plus-sign"></span> 增加</td>
                            </tr>
                        </tfoot>
                	</table>
             </div>
            <div style="clear:both;overflow:hidden;padding:25px 30px 0 0" class="gebtu">
           		<button type="button" class="btn btn-primary" @click="save()">保存</button>
				<button type="button" class="btn btn-primary" @click="geclose()">关闭</button>
            </div>
			</div>
						<div id='shadow' v-show='isshadow'>
				<div id="addTeacher">
			        <div class="choice">
			            <header>
			                <p>
			                    <span>选择训练项</span>
			                    <span class="choose-right" @click="closeArt()">X</span>
			                </p>
			            </header>
			            <section>
			                <div class="left-part search-btn">
			                    <div>
			                        <el-input placeholder="请输入技能项">
			                            <el-button slot="append" icon="search"></el-button>
			                        </el-input>
			                    </div>
			                    <ul class="list">
			                        <el-checkbox-group v-model='leftchoosed'>
			                            <li v-for='(value,index) in learnlist'>
			                                <el-checkbox :label="value">
			                                   {{value.name}}
			                                </el-checkbox>
			                            </li>
			                        </el-checkbox-group>
			                    </ul>
			                </div>
			                <div class="btnB">
			                    <el-button @click='add()'><i class="el-icon-d-arrow-right"></i></el-button>
			                    <br>
			                    <el-button @click='remove()'><i class="el-icon-d-arrow-left"></i></el-button>
			                </div>
			                <div class="right-part">
			                    <p>已选技能项：</p>
			                    <ul class="list">
			                        <el-checkbox-group v-model='deletelist'>
			                            <li v-for='(value,index) in rightlist'>
			                                <el-checkbox :label='value'>
			                                    {{value.name}}
			                                </el-checkbox>
			                            </li>
			                        </el-checkbox-group>
			                    </ul>
			                </div>
			                <div class="btnC">
			                    <button  @click="saveArt()" class='btn btn-primary'>保存</button>
			                    <button  @click="closeArt()" class='btn btn-default'>取消</button>
			                </div>
			            </section>
			        </div>
			    </div>
			</div>
		</div>
<script>
  var vm=new Vue({
        el:"#detail_pratice",
        data:{
           isshadow:false,
           leftchoosed:[],
           learnlist:[],
           rightlist:[],
           deletelist:[],
           planname:'',
           starttime:'',
           endtime:'',
           plancomment:'',
           finallychoosed:[],
           pickerOptions0: {},
		   pickerOptions1: {},
        },
        mounted:function(){
            this.id=window.location.href.split('=')[1];
        },
        methods:{
			dateChange(val) {
				this.starttime=val;
			},
			dateChange1(val) {
				this.endtime=val;
			},
			remove:function(){
				alert('remove')
			},
			deleteonelearn:function(index){
				this.finallychoosed.splice(index,1)
			},
			skill:function(){
				var self=this
				self.isshadow=true
				var data={
					command:'learn/querylearninfo',
					sessionid:getCookie('sid'),
					loginid:getCookie('uid'),
					type:3
				}
				function callback(res){
					self.learnlist=res.learnids
				}
				post('/learn/querylearninfo',data,callback,errcodefn,errfn)
			},
			closeArt:function(){
				
				this.isshadow=false
			},
			saveArt:function(){
				for(var i=0;i<this.finallychoosed.length;i++){
					for(var j=0;j<this.rightlist.length;j++){
						if(this.finallychoosed[i].learnid==this.rightlist[j].learnid){
							layer.msg('请勿重复添加哦')
							return
						}
					}
				}
				this.finallychoosed=this.rightlist.concat(this.finallychoosed)
				this.rightlist=[]
				this.isshadow=false
			},
			add:function(){
				for(var i=0;i<this.rightlist.length;i++){
					for(var j=0;j<this.leftchoosed.length;j++){
						if(this.rightlist[i]==this.leftchoosed[j]){
							layer.msg('请勿重复添加哦')
							return
						}
					}
				}
				this.rightlist=this.leftchoosed.concat(this.rightlist)
				this.leftchoosed=[]
			},
				save:function(){
				if($(".planname").val().length==0){
	    		layer.msg('请输入计划名称');
	    		return
	    		};
//	    		if($(".planstart").val().length==0){
//	    		layer.msg('请输入开始时间');
//	    		return
//	    		};
//	    		if($(".planend").val().length==0){
//	    		layer.msg('请输入结束时间');
//	    		return
//	    		};
	    		if($(".remarks_text").val().length==0){
	    		layer.msg('请输入备注');
	    		return
	    		};
				var self=this
				var data={
					command:'plan/updateplan',
					sessionid:getCookie('sid'),
					loginid:getCookie('uid'),
					planname:self.planname,
					plancomment:self.plancomment,
					starttime:self.starttime,
					endtime:self.endtime,
					learnitems:[],
					id:self.id
				}
				for(var i=0;i<self.finallychoosed.length;i++){
					data.learnitems.push({
						learnid:self.finallychoosed[i].learnid,
						name:self.finallychoosed[i].name
					})
				}
				console.log(JSON.stringify(data))
				function callback(res){
					layer.msg('成功修改一条实习计划');
					setTimeout(function(){
						layer.closeAll()
						window.parent.location.reload()
					},1000)
				}
				post('/plan/updateplan',data,callback,errcodefn,errfn)
			},
			remove:function(){
				var self=this
				for(var i=0;i<self.rightlist.length;i++){
					for(var j=0;j<self.deletelist.length;j++){
						if(self.rightlist[i]==self.deletelist[j]){
							self.rightlist.splice(i,1)
						}else{
							continue
						}
					}
				}
				
				self.deletelist=[]
			},
			geclose:function(){
				var index = parent.layer.getFrameIndex(window.name);
				parent.layer.close(index)
			},
       }
    });
    show_detail();
	function show_detail(){
	var data={
            command:"plan/findplan",
            sessionid:getCookie('sid'),
    		loginid:getCookie('uid'),
            id:window.location.href.split('=')[1],
       };
    function callback(res){
    		console.log(JSON.stringify(res))
    		vm.planname=res.plan.planname;
    		vm.starttime=res.plan.starttime.slice(0,10);
    		vm.endtime=res.plan.endtime.slice(0,10);
    		vm.plancomment=res.plan.plancomment;
    		vm.finallychoosed=res.plan.learnitems
    		//console.log(this.plans);
    	};
    post('/plan/findplan',data,callback,errcodefn,errfn)
};
</script>
</body>
</html>
