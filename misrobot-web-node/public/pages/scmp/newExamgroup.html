<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>增加房间</title>
		<link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css" />
		<script src="../../js/jquery-1.11.3.js"></script>
		<script src="../../layer/xie/layer1.js"></script>
		<script src="../../js/scmp/common.js"></script>
		<script src="../../js/vue.js"></script>
		<link rel="stylesheet" href="../../css/assistant/style.css">
		<link rel="stylesheet" href="../../css/scmp/scmpcommon.css">
	</head>
	<style>
		body {
			overflow: auto;
		}
		
		.add_site {
			text-align: left;
		}
		
		.gw_num {
			border: 1px solid #dbdbdb;
			width: 110px;
			line-height: 26px;
			overflow: hidden;
		}
		
		.gw_num em {
			display: block;
			height: 26px;
			width: 26px;
			float: left;
			color: #7A7979;
			border-right: 1px solid #dbdbdb;
			text-align: center;
			cursor: pointer;
		}
		
		.gw_num .num {
			display: block;
			float: left;
			text-align: center;
			width: 52px;
			font-style: normal;
			font-size: 14px;
			line-height: 24px;
			border: 0;
		}
		
		.gw_num em.add {
			float: right;
			border-right: 0;
			border-left: 1px solid #dbdbdb;
		}
	</style>

	<body>
		<div id="add_site" v-cloak style="margin: 30px 15%;">
			<div class="s_addStudent" style="z-index: 99999;">
				<div class="s_studentMessage">
					<ul>
						<li>
							<form class="form-horizontal">
								<div class="col-md-8">
									<div class="form-group form-group-sm">
										<label class="col-sm-3 control-label">*所属房间 ：</label>
										<div class="col-sm-9">
											<select class="form-control input-sm" v-model='existingid' :value='existingid'>
												<option :value="value1.id" v-for="value1 in paramlist">{{value1.roomname}}</option>
											</select>
										</div>
									</div>
								</div>
							</form>
						</li>
						<li>
							<form class="form-horizontal">
								<div class="col-md-8">
									<div class="form-group form-group-sm">
										<label class="col-sm-3 control-label">*房间拆分：</label>
										<div class="col-sm-9">
											<div class="gw_num">
												<em class="jian">-</em>
												<input type="text" class="num" v-model="splitcount" />
												<em class="add">+</em>
											</div>
										</div>
									</div>
								</div>
							</form>
						</li>
						<li>
							<form class="form-horizontal">
								<div class="col-md-8">
									<div class="form-group form-group-sm">
										<label class="col-sm-3 control-label">房间描述 ：</label>
										<div class="col-sm-9">
											<input class="form-control " type="text" v-model='roomdesc'>
										</div>
									</div>
								</div>
							</form>
						</li>
						<li>
							<form class="form-horizontal">
								<div class="col-md-8">
									<div class="form-group form-group-sm">
										<label class="col-sm-3 control-label"></label>
										<div class="col-sm-9">
											<span type="text">一个房间如果已拆分若干个考组，必须先将相关的考组删除才可以重新拆分。</span>
										</div>
									</div>
								</div>
							</form>
						</li>
					</ul>
				</div>
				<div style="clear:both;overflow:hidden;padding:25px 30px 0 0;text-align: center;" class="bt_add">
					<button class="btn btn-default" type="submit" v-on:click="cancel" style="float: left;margin-left: 45%;">取消</button>
					<button class="btn btn-primary" type="submit" v-on:click="save" style="float:left;margin-left: 20px;">保存</button>
				</div>
			</div>
		</div>
		<script>
			var vm = new Vue({
				el: '#add_site',
				data: {
					roomname: '',
					existingid: '',
					paramlist: [],
					id: '',
					roomdesc: '',
					splitcount: '2',
				},
				mounted: function() {
					this.get_room();
				},
				methods: {
					cancel: function() {
						var index = parent.layer.getFrameIndex(window.name);
						parent.layer.close(index)
					},
					get_room: function() {
						var self = this
						var data = {
							command: 'osceroomexisting/listosceroomexisting', //接口地址
							sessionid: getCookie('sid'),
							loginid: getCookie('uid'),
							roomType: 3,
						};

						function callback(res) {
							self.paramlist = res.listosceroomexisting;
						};
						post('/osceroomexisting/listosceroomexisting', data, callback, errcodefn, errfn)
					},
					save: function() {
						var self = this;
						var re = /^[\u4E00-\u9FA5A-Za-z0-9]+$/;
						if (self.roomdesc!=''&&!re.test(self.roomdesc)) {
							layer.msg('房间描述不能包含特殊字符')
							return
						}
						if (self.splitcount==1) {
							layer.msg('分组不能小于2')
							return
						}
						if(self.existingid==''||self.splitcount==''){
							layer.msg('带*号的为必填项')
							return
						}
						
						var data = {
							command: 'osceroom/insertosceroomsplit',
							sessionid: getCookie('sid'),
							loginid: getCookie('uid'),
							existingid: self.existingid,
							splitcount: self.splitcount,
							roomdesc: self.roomdesc,
						}
						console.log(JSON.stringify(data))

						function callback(res) {
							layer.msg('成功拆分一个考组');
							setTimeout(function() {
								self.cancel();
								var num = window.location.href.split('=')[2];
								var page = window.location.href.split('=')[1].split('&')[0];
								window.parent.vm.pageconf.onchange(page, num)
							}, 1000)
						}
						post('/osceroom/insertosceroomsplit', data, callback, errcodefn, errfn)
					},
				}
			})
			$(document).ready(function() {
				//加的效果
				$(".add").click(function() {
					var n = $(this).prev().val();
					var num = parseInt(n) + 1;
					if(num == 0) { return; }
					$(this).prev().val(num);
					vm.splitcount=num;
				});
				//减的效果
				$(".jian").click(function() {
					var n = $(this).next().val();
					var num = parseInt(n) - 1;
					if(num == 0) { return }
					$(this).next().val(num);
					vm.splitcount=num;
				});
			})
		</script>
	</body>

</html>