<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
    <script src="../../js/jquery-3.1.1.min.js"></script>
    <script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
    <script src="../../js/base.js"></script>
    <script src="../../js/ajaxfileupload.js"></script>
    <script src="../../js/scmp/common.js"></script>
    <style>
        #content{
            width:50%;
            margin:0 auto;
            margin-top:30%;
        }
    </style>
</head>
<body>
<div id="content">
    <button onclick="download()" class="btn btn-primary btn-block">下载exl表格</button>
    <button onclick="showsubmit()" class="btn btn-primary btn-block">上传文件</button>
    <!-- Modal对话框 -->
    <div class="modal fade" id="choosefile" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">请选择上传文件</h4>
                </div>
                <div class="modal-body">
                    <input type="file"  id="f" class="form-control"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="submit()">保存</button>
                </div>
            </div>
        </div>
    </div>
    <div id="result"></div>
    
    导入：
    <input type="file" name="file" class="uploadfile">
    
    下载：
    <button type="button" class="btn btn-default" id="downloadBtn">下载</button>
        下载模板：
    <button type="button" class="btn btn-default" id="downloadMouldBtn">下载</button>
     下载word：
    <button type="button" class="btn btn-default" id="downloadWordBtn">下载</button>
</div>
<script>
    var fileobj//用于存放用户选择上传的文件对象
    function download(){
        window.location.href='../importStudent.xls'//直接访问服务器上的静态资源就可以下载
    }
    $('#f').on('change',function(e){//用户选择文件时，获取已选的文件对象
        fileobj= e.target.files[0]
    })
    function showsubmit(){//显示对话框
        $('#choosefile').modal('show')
    }
    function submit(){//上传文件接口
        console.log(fileobj)
        $('#choosefile').modal('hide')
        readAsText()
    }
    function readAsText(){
        var reader = new FileReader();
        //将文件以文本形式读入页面
        reader.readAsText(fileobj);
        reader.onload=function(f){
            //显示文件
            $('#result').html(this.result)
        }
    }
    
    
    
    $('.uploadfile').on('change',function () {
		var obj = $(this)[0];
		
		importExcel($('.uploadfile'), {
			command: 'question/importtheoreticalquestions',
			sessionid: getCookie('sid'),
			loginid: getCookie('uid'),
			planId:19,
			questionid:99,
			id: 1
		});
		/* $.ajaxFileUpload({
            url: '/import/importExcel',
            secureuri : false,
            timeout: 1000*60*2,
            fileElementId : $('.uploadfile'),
            data : {
            	commend: 'import/importExcel',
				sessionid: getCookie('sid'),
				loginid: getCookie('uid'),
            },
            dataType : 'json',
            success : function(data, status) {
                // self.user = data.data;
                // self.refreshLoginUser(data.data);
                // self.hideLoading();
            },
            error : function(data, status, e) {
                // self.hideLoading();
            }
        }); */
        
		/* Api.R({
			url: "/import/importExcel",
			json: {
				"1": {
					command: "import/importExcel",
					filename: (new Date).getTime(),
					filecontent: obj.files[0],
					sessionid: getCookie('sid'),
					loginid: getCookie('uid'),
				}
			},
			fn: function(result){
				if(result["1"].errcode){
					uselayer(3, result["1"].errdesc);
					return;
				}
				if(!result["1"].filepath){
					uselayer(3, '上传附件失败，请重新上传！');
					return;
				}
				var oReader = new FileReader();
				oReader.onload = function(e) {
					$('.answer-img').attr('src',e.target.result);
				};
				oReader.readAsDataURL(obj.files[0]);
				Api.R({
					url: "/question/submitanswer",
					json: {
						"1": {
							scheduleid: getCookie('gy_istudy_scid'),
							uid: getCookie('gy_u'),
							sessionid: getCookie('gy_t'),
							qid: $('.uploadfile').attr('qid'),
							answerimg: result["1"].filepath,
							loginid: getCookie('gy_u')
						}
					},
					fn: function(res) {
						if(res["1"].errcode){
							uselayer(3, res["1"].errdesc);
							return;
						}
						$('.uploadfile,.answer-show,.kt-write-con p').css('display','none');
						$('.answer-com,.kt-write-con img').css('display','block')
						uselayer(1, '提交成功！',function () {
							if (!result["1"].errcode) {
								window.location.href="startstu.html";
							}
						});	
					},
					error: function(str) {
						uselayer(3, '上传附件失败，请重新上传！');
					}
				});
			},
			error: function(str){
				uselayer(3, '上传附件失败，请重新上传！');
			}
		}); */
	});
    
    
    $('#downloadBtn').click(function(){
    	var data = {
			sessionid: getCookie('sid'),
			loginid: getCookie('uid'),
			
			command: "dept/exportdepttech",
			depttecid:[{techid:159645,deptid:100}]
		};

		exportExcel(data);
    });
    
    $('#downloadMouldBtn').click(function(){
    	var data = {
			sessionid: getCookie('sid'),
			loginid: getCookie('uid'),
			
			command: "turn/turnPlanTempData",
			planId:19
		};

    	exportMouldExcel(data);
    });
    
    $('#downloadWordBtn').click(function(){
    	var data = {
			sessionid: getCookie('sid'),
			loginid: getCookie('uid'),
			
			command: "turn/evaluateExport",
			id:33
		};

    	exportWordExcel(data);
    });
    
</script>
</body>
</html>