<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>实验室编辑</title>
		<link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css" />
		<script src="../../js/jquery-1.11.3.js"></script>
	    <script src="../../layer/xie/layer1.js"></script>
	    <script src="../../js/scmp/common.js"></script>
	    <script src="../../js/vue.js"></script>
	    <link rel="stylesheet" href="../../css/assistant/style.css">
	    <link rel="stylesheet" href="../../css/scmp/scmpcommon.css">
	</head>
	<style>
	body {
		overflow: auto;
	}
	.add_place{
		text-align: left;
	}
	</style>
	<body>
<div id="add_place" v-cloak style="margin-top: 30px;">
	<div class="s_addStudent" style="z-index: 99999;">
		<div class="s_studentMessage">
			<ul>
				<li>
					<form class="form-horizontal">
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">楼栋 ：</label>
								<div class="col-sm-4">
									<input class="form-control " type="text" v-model='build'>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">楼层 ：</label>
								<div class="col-sm-4">
									<input class="form-control" type="text" v-model='floor'>
								</div>
							</div>
						</div>
					</form>
				</li>
				<li>
					<form class="form-horizontal">
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">房号 ：</label>
								<div class="col-sm-4">
									<input class="form-control" type="text" v-model="roomnum">
								</div>
							</div>
						</div>	
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">场地地址：</label>
								<div class="col-sm-4">
									<input class="form-control" type="text" v-model="displayname">
								</div>
							</div>
						</div>
						
					</form>
				</li>
				<li>
					<form class="form-horizontal">
					
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">类别 ：</label>
								<div class="col-sm-4">
									<select class="form-control input-sm" v-model='catedataid' :value='catedataid'>
										<option :value="value.cateid" v-for="value in placecatelist">{{value.catename}}</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group form-group-sm">
								<label class="col-sm-4 control-label">场地名称 ：</label>
								<div class="col-sm-4">
									<input class="form-control" type="text" v-model="name">
								</div>
							</div>
						</div>
					</form>
				</li>
			</ul>
		</div>
		<div style="clear:both;overflow:hidden;padding:25px 30px 0 0;text-align: center;" class="bt_add">
				<button class="btn btn-default" type="submit" v-on:click="cancel" style="float: left;margin-left: 45%;">取消</button>
				<button class="btn btn-primary" type="submit" v-on:click="save" style="float:left;margin-left: 20px;">保存</button>
		</div>
	</div>
</div>
<script>
	var vm=new Vue({
		el:'#add_place',
		data:{
			placecatelist:[],
			build:'',
			floor:'',
			roomnum:'',
			name:'',
			displayname:'',
			cateid:'',
			catedataid:'',
		},
		mounted:function(){
			
			this.getplace();
			this.id=window.location.href.split('=')[1];
		},
		methods:{
			cancel:function(){
				var index = parent.layer.getFrameIndex(window.name);
				parent.layer.close(index)
			},
			save:function(){
				var self=this
				var data={
					command:'site/updateplace',
					sessionid:getCookie('sid'),
					loginid:getCookie('uid'),
					build:self.build,
					floor:self.floor,
					roomnum:self.roomnum,
					name:self.name,
					displayname:self.displayname,
					cateid:self.catedataid,
					id:self.id,
				}
				console.log(JSON.stringify(data))
				function callback(res){
					layer.msg('成功修改一个实验室场地');
					setTimeout(function(){
						layer.closeAll()
						window.parent.location.reload()
					},1000)
				}
				post('/site/updateplace',data,callback,errcodefn,errfn)
			},
			getplace:function(){
				var self=this
				var data={
					command:'site/listplacecate',
					sessionid:getCookie('sid'),
					loginid:getCookie('uid'),
				}
				function callback(res){
					self.placecatelist=res.placecatelist
					self.chooseplace();
					}
					post('/site/listplacecate',data,callback,errcodefn,errfn)
			},
			chooseplace:function(){
				var self=this
				var data={
					command:'site/findplace',
					sessionid:getCookie('sid'),
					loginid:getCookie('uid'),
					id:window.location.href.split('=')[1],
				}
				function callback(res){
					self.build=res.place.build;
					self.floor=res.place.floor;
					self.roomnum=res.place.roomnum;
					self.name=res.place.name;
					self.displayname=res.place.displayname;
					self.catedataid=res.place.cateid;
				}
				post('/site/findplace',data,callback,errcodefn,errfn)
			},
		}
	})
</script>
	</body>
</html>
