<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<title>查看试卷-理论考试</title>
		<link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="../../css/element.css">
		<!--<link rel="stylesheet" href="../../css/scmp/testpaper_addnew.css">-->
		<style>

			[v-cloak]{
				display: none;
			}
			.title{font-size: 30px;text-align: center;position: relative;}
			.score{font-size: 17px; text-align: center;position: relative; padding: 10px 0;}
			.info{font-size: 17px;text-align: center;margin-bottom: 40px;}
			.questionlist{font-size: 15px;text-align: left;margin-left: 20px;}
			.mainquestiontitle{padding: 10px 0;position: relative;}
			.mainquestion{padding: 10px 0 30px 0;position: relative;}
			.littletitle{padding-bottom: 10px;}
			.choiceanswercell{display: inline-block; margin: 10px 20px;}
			.next{text-align: center;padding-bottom: 100px;}
			.btn{width: 100px;margin: 20px 50px;}
		</style>
	</head>

	<body>
		<div id="addnew" v-cloak>
		<div id="testpaper">
			<div class="title ">{{papername}}</div>
			<div class="score ">满分:{{score}}</div>
			<div class="info">班级:________ 姓名:________ 学号:________</div>
			<div class="questionlist" v-for="(item,index) in testpaper">
				<div class="mainquestiontitle ">
					{{index+1 | maintitlenum}}、{{item.nickname}}
					<span>(共{{item.totalnum}}小题,总分: {{item.totalscore}}分)</span>
				</div>
				<!--选择题-->
				<div class="mainquestion" v-for="(mainitem,mainindex) in item.content" v-if="item.cateid==1||item.cateid==2">
					<div class="littletitle">
						{{mainindex+1}}、{{mainitem.questionbasename}}
						<span v-if="item.scoresettype==0">({{mainitem.score}}分)</span>
					</div>
					<div class="choiceanswer">
						<span class="choiceanswercell" v-for="(choiceitem,choiceindex) in mainitem.questionitem">
							<span>{{choiceitem.itemname}}</span>{{choiceitem.content}} 
						</span>
					</div>
				</div>
				<!--判断题-->
				<div class="mainquestion" v-for="(mainitem,mainindex) in item.content" v-if="item.cateid==4">
					<div class="littletitle">
						{{mainindex+1}}、{{mainitem.questionbasename}}
						<span v-if="item.scoresettype==0">({{mainitem.score}}分)</span>
					</div>
				</div>
				<!--问答题-->
				<div class="mainquestion" v-for="(mainitem,mainindex) in item.content" v-if="item.cateid==5">
					<div class="littletitle">
						{{mainindex+1}}、{{mainitem.questionbasename}}
						<span>({{mainitem.score}}分)</span>
					</div>
				</div>
				<!--组合题-->
				<div class="mainquestion" v-for="(mainitem,mainindex) in item.content" v-if="item.cateid==6">
					<!--组合题二级题目题干-->
					<div class="mainquestiontitle ">
						{{mainindex+1 | groupsecondindextransform}}、{{mainitem.questionbasename}}(共{{mainitem.score}}分)
						
					</div>
					<!--组合题二级题目内容-->
					<div v-for="(groupitem,groupindex) in mainitem.grouplist">
						<div class="mainquestion">
							<!--组合题三级题干-->
							<div class="littletitle">
								{{groupindex+1}}、{{groupitem.questionbasename}}({{groupitem.score}}分)
							</div>
							<div class="choiceanswer" v-if="groupitem.questionitem.length!=0">
								<span class="choiceanswercell" v-for="(grochoitem,grochoindex) in groupitem.questionitem">
									<span>{{grochoitem.itemname}}</span>{{grochoitem.content}} 
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			</div>
		<div class="next"> 
			<button type="button" class="btn btn-primary" id="downloadbtn">下载试卷</button>
			<button type="button" class="btnBg btn btn-primary" @click="goback">返回</button>
		</div>
				
		</div>

	</body>
	<script src="../../js/jquery-3.1.1.min.js"></script>
	<script src="../../js/vue-2.1.6.min.js"></script>
	<script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js" type="text/javascript" charset="utf-8" class="bootstrap"></script>
	<script src="../../layer/xie/layer1.js"></script>
	<script src="../../js/scmp/common.js"></script>
    <script src="../../js/ajaxfileupload.js"></script>
    <script src="../../js/FileSaver.min.js"></script>
    <script src="../../js/jquery.wordexport.js"></script>
<script>

jQuery(document).ready(function($) {
	$("#downloadbtn").click(function(event) {
		$("#testpaper").wordExport();
	});
});
	
Vue.filter('maintitlenum',function(value){
	var num=value;
	switch (value){
		case 1: num="一";
			break;
		case 2: num="二";
			break;
		case 3: num="三";
			break;
		case 4: num="四";
			break;
		case 5: num="五";
			break;
		case 6: num="六";
			break;
		case 7: num="七";
			break;
		case 8: num="八";
			break;
		case 9: num="九";
			break;
		default:
			break;
	}
	return num;
})
Vue.filter('groupsecondindextransform',function(value){
	var num=value;
	switch (value){
		case 1: num="(一)";
			break;
		case 2: num="(二)";
			break;
		case 3: num="(三)";
			break;
		case 4: num="(四)";
			break;
		case 5: num="(五)";
			break;
		case 6: num="(六)";
			break;
		case 7: num="(七)";
			break;
		case 8: num="(八)";
			break;
		case 9: num="(九)";
			break;
		default:
			break;
	}
	return num;
})
var vm = new Vue({
	el:"#addnew",
	data:{
		papername:'',
		score:'',
		categorylist:[],
		testpaper:[],
	},
	mounted:function(){
		this.querypapername();
		this.querypapercategorylist();
	},
	methods:{
		download:function(){//下载试卷
//			console.log('----------------下载试卷---------------')
//			var data = {
//				sessionid: getCookie('sid'),
//				loginid: getCookie('uid'),
//				command: "question/downloadpaper",
//				paperid:location.href.split('=')[1],
//			};
//			exportExcel(data);
//			window.print()
		},
		goback:function(){//返回
			window.history.go(-1)
		},
		querypapername:function(){//查询试卷信息
			var self=this
            var data={
                command:"exampaper/viewpaper",
                sessionid:getCookie('sid'),
                loginid:getCookie('uid'),
				paperid:location.href.split('=')[1],
            }
            function callback(res){
            	vm.papername=res.paperinfo.name;
            	vm.score=res.paperinfo.score;
            }
            post("/exampaper/viewpaper",data,callback,errcodefn,errfn)
		},
		querypapercategorylist:function(){
			var data={
				command:"exampaper/querypapercategorylist",
				sessionid:getCookie("sid"),
				loginid:getCookie("uid"),
				paperid:location.href.split('=')[1],
			}
			function callback(res){
				vm.categorylist=res.categoryList;
			}
			post("/exampaper/querypapercategorylist",data,callback,errcodefn,errfn)
		},	
		querypaperquestion:function(mainid,cateid,totalnum,nickname,scoresettype,score,totalscore,priority){//查询试题详情并拼接试卷对象
			var data={
				command:"exampaper/querypaperquestion",
				sessionid:getCookie("sid"),
				loginid:getCookie("uid"),
				paperid:location.href.split('=')[1],
				mainid:mainid,
				cateid:cateid
			}
			function callback(res){
				if(cateid==6){//如果cateid是组合题
					var questionlist=[];
					for (var i=0;i<res.questionlist.length;i++) {
						var grouplist=res.questionlist[i].grouplist;
						if (grouplist!=null) {
							for (var a=0;a<grouplist.length;a++) {//三级题目排序
								for (var b=a+1;b<grouplist.length;b++) {
									if (grouplist[a].priority>grouplist[b].priority) {
										var obj=grouplistsort[a];
										grouplist[a]=grouplist[b];
										grouplist[b]=obj;
									}
								}
							}
						}
						console.log('-----grouplist-----'+JSON.stringify(grouplist))
						questionlist.push({
							id:res.questionlist[i].id,
							questionbaseid:res.questionlist[i].questionbaseid,
							score:res.questionlist[i].score,
							priority:res.questionlist[i].priority,
							mainid:res.questionlist[i].mainid,
							paperid:res.questionlist[i].paperid,
							questionbasename:res.questionlist[i].questionbasename,
							questionitem:res.questionlist[i].questioinitem,
							answer:res.questionlist[i].answer,
							grouplist:grouplist
						})
					}
					for (var i=0;i<questionlist.length;i++) {//二级题目排序
						for (var j=i+1;j<questionlist.length;j++) {
							if (questionlist[i].priority>questionlist[j].priority) {
								var obj=questionlist[i];
								questionlist[i]=questionlist[j];
								questionlist[j]=obj;
							}
						}
					}
					vm.testpaper.push({
						id:mainid,
						cateid:cateid,//题类
						totalnum:totalnum,//试题总数
						nickname:nickname,//分类名称
						scoresettype:scoresettype,//是否统一设置
						score:score,//试题分值
						totalscore:totalscore,//试题总分值
						priority:priority,//排序
						content:questionlist//题类下属小题数组
					});
					vm.sorttestpaper();//一级题目排序
				}else{
					for (var i=0;i<res.questionlist.length;i++) {//二级题目排序
						for (var j=i+1;j<res.questionlist.length;j++) {
							if (res.questionlist[i].priority>res.questionlist[j].priority) {
								var obj=res.questionlist[i];
								res.questionlist[i]=res.questionlist[j];
								res.questionlist[j]=obj;
							}
						}
					}
					vm.testpaper.push({
						id:mainid,
						cateid:cateid,//题类
						totalnum:totalnum,//试题总数
						nickname:nickname,//分类名称
						scoresettype:scoresettype,//是否统一设置
						score:score,//试题分值
						totalscore:totalscore,//试题总分值
						priority:priority,//排序
						content:res.questionlist//题类下属小题数组
					});
					vm.sorttestpaper();//一级题目排序
				}
			}
			post("/exampaper/querypaperquestion",data,callback,errcodefn,errfn)
		},
		sorttestpaper:function(){//排序
			for (var i=0;i<this.testpaper.length;i++) {
				for (var j=i+1;j<this.testpaper.length;j++) {
					if (this.testpaper[i].priority>this.testpaper[j].priority) {
						var obj=this.testpaper[i];
						this.testpaper[i]=this.testpaper[j];
						this.testpaper[j]=obj;
					}
				}
			}console.log('------------sort---------------'+JSON.stringify(this.testpaper))
		},
		
	},
	watch:{
		categorylist:function(newcategorylist){//监听mainid
			for(var i=0;i<this.categorylist.length;i++){
				this.querypaperquestion(this.categorylist[i].id,this.categorylist[i].cateid,this.categorylist[i].totalnum,this.categorylist[i].nickname,this.categorylist[i].scoresettype,this.categorylist[i].score,this.categorylist[i].totalscore,this.categorylist[i].priority);
			}
		},
	}
	
});
	
</script>
</html>