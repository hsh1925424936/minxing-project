<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>物品类别管理</title>
		<script src="../../js/vue.js"></script>
		<script src="../../js/element.js"></script>
		<script src="../../js/jquery-1.11.3.js"></script>
		<script src="../../layer/xie/layer1.js"></script>
		<script src="../../js/scmp/common.js"></script>
		<link rel="stylesheet" href="../../css/element.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<style type="text/css">
			html,body{
				background-color: white;
			}
			.goodsType {
				margin: 20px;
			}
			
			.goodsType .op {
				background-color: #E5E6E8;
				height: 40px;
				line-height: 40px;
				padding-left: 20px;
				margin-bottom: 20px;
			}
			
			.goodsType .oBtn {
				margin-bottom: 20px;
			}
		</style>
	</head>

	<body>
		<div class="goodsType">
			<p class="op">物品类别管理</p>
			<div class="oBtn">
				<el-button type="primary" @click="addNew">新增</el-button>
				<el-button type="primary" @click="editGoodsType">编辑</el-button>
				<el-button type="primary" @click="deleteBtn">删除</el-button>
			</div>
			  <el-tree :data="treeList" :props="defaultProps" show-checkbox accordion 
				@check-change="handleCheckChange" check-strictly="true" default-expand-all> 
				
			</el-tree> 
			  <!-- <el-tree
					:data="treeList"
					:props="defaultProps"
					show-checkbox
					node-key="id"
					default-expand-all
					:expand-on-click-node="false"
					:render-content="renderContent">
				</el-tree>  -->
		</div>
	</body>
	<script type="text/javascript">
		var vm = new Vue({
			el: '.goodsType',
			data: {
				treeList: [],
				defaultProps: {
					children: 'children',
					label: 'label'
				},
				editId:'',
				id:'',
				checkList:[],
				checkedList:[],
				deleteId:[],
			},
			mounted() {
				this.getTree();
			},
			methods: {
				// handleNodeClick(data) {
				// 	console.log(data);
				// 	this.editData=data;
				// 	this.id=data.id;
				// },
				getTree() {
					var self = this;
					var data = {
						command: 'assetcate/getallassetcates',
						sessionid:getCookie('sid'),
     	 				loginid:getCookie('uid')
					}

					function callback(res) {
						if(res && res.errcode == 0) {
							self.treeList = res.children;
						} else {
							layer.msg(res.errdesc)
						}
					}
					post('/assetcate/getallassetcates', data, callback, errcodefn, errfn)
				},
				 handleCheckChange(data, checked, indeterminate) {
						if(checked){
							this.checkList.push({
								id:data.id,
								label:data.label,
								checked:checked
							})
						}else{
							this.checkList.map(function(item,index,arr){
								if(item.id == data.id){
									arr.splice(index,1)
								}
							})
						}
						console.log(this.checkList)
				},
				addNew() {
					layer.open({
						type: 2,
						title: '新增资产',
						shadeClose: true,
						shade: 0.7,
						area: ['40%', '50%'],
						content: 'addGoodsType.html?pram=0'
					});
				},
				editGoodsType(){
					this.checkedList = []
					this.checkList.map((item)=>{
						if(item.checked){
							this.checkedList.push(item)
						}
					})
					if(this.checkedList.length == 0){
						layer.msg('至少要选择一个类别！')
					}else if(this.checkedList.length > 1){
						layer.msg('只能选择一个类别！')
					}else if(this.checkedList[0].id == 1){
						layer.msg('编辑时不能选择全部！')
					}else{
						this.editId= this.checkedList[0].id;
						this.checkList = []
						layer.open({
							type: 2,
							title: '编辑资产',
							shadeClose: true,
							shade: 0.7,
							area: ['40%', '50%'],
							content: 'addGoodsType.html?pram=1'
						});
					}
				},
				deleteBtn(){
					let self=this;
					let all = false;
					this.deleteId = []
					this.checkedList = []
					this.checkList.map((item)=>{
						if(item.checked){
							this.checkedList.push(item)
							this.deleteId.push(item.id)
						}
					})
					console.log(this.checkedList)
					this.checkedList.map(item=>{
						if(item.id == 1){
							all = true
						}
					})
					console.log(self.deleteId)
					if(this.checkedList.length == 0){
						layer.msg('至少要选择一个类别！')
					}else if(all){
						layer.msg('删除时不能选择全部！')
					}else{
						let data={
							command:'assetcate/deleteassetcate',
							sessionid:getCookie('sid'),
							loginid:getCookie('uid'),
							cateidlist:self.deleteId
						}
						function callback(res){
							if(res && res.errcode==0){
								layer.msg('删除成功')
								setTimeout(function(){
									self.getTree();
								},300)
							}else{
								layer.msg(res.errdesc)
							}
						}
						post('/assetcate/deleteassetcate',data,callback,errcodefn,errfn)
						}
					
				}
			}
		})
	</script>

</html>