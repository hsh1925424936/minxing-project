<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>查看-操作</title>
		<link rel="stylesheet" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css" />
		<script src="../../js/jquery-3.1.1.min.js"></script>
		<script src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script src="../../js/scmp/common.js"></script>
		<script src="../../layer/xie/layer1.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			
			ul,
			ol {
				list-style: none;
			}
			::-webkit-scrollbar{width:0px}
			#operation{
				margin: 20px;
			}
			ul>li {
				margin-bottom: 20px;
				display: flex;
			}
			
			ul>li .left{
				width: 100px;
				text-align: left;
			}
			
			ul>li .right{
				width: 1106px;
			}
			
			.point {
				margin-bottom: 20px;
			}
			
			
			
			.point ol li p {
				text-align: left;
				margin-left: 42px;
				margin-top: 20px;
			}
			
			.point ol li table {
				width: 90%;
				margin: auto;
			}
			.tableLong{
				width: 100px;
			}
			[v-cloak] {
				display: none;
			}

		</style>
	</head>

	<body>
		<div id="operation" v-cloak>
			<ul>
				<li style="border-bottom: 1px solid lightgray;">
					<p class="left">题目名称：</p>
					<p class="right">{{operation.name}}</p>
				</li>
				<!--<li style="margin-left: 35px;border-bottom: 1px solid lightgray;">
					<p>题目描述：</p>
					<p>{{operation.comment}}</p>
				</li>-->
			</ul>
			<div class="point">
				<p class="left">评分表：</p>
				<!--步长-->
				<ol v-if="type==0">
					<li v-for="(index,item) in conList">
						<p>
							<span>{{index+1 | filterFn}}、</span>
							<span>{{item.name}}</span>
						</p>
						<table class="table table-bordered table-hover">
							<tr class="active">
								<th class="tableLong">序号</th>
								<th>评分项</th>
								<th class="tableLong">分值</th>
								<th class="tableLong">步长</th>
							</tr>
							<tr v-for="(index1,value1) in item.contentName">
								<td>{{index1+1}}</td>
								<td>{{value1.evaluate}}</td>
								<td>{{value1.score}}</td>
								<td>{{value1.footList}}</td>
							</tr>
						</table>
					</li>
					<li style="margin-top: 20px;">
						<span style="margin-left: 20px;">总分 ：</span>
						<span>{{allScore}}</span>
					</li>
				</ol>
				<!--二级-->
				<ol v-if="type==2">
					<li v-for="(index,item) in conList">
						<p>
							<span>{{index+1 | filterFn}}、</span>
							<span>{{item.name}}</span>
						</p>
						<table class="table table-bordered table-hover">
							<tr class="active">
								<th>序号</th>
								<th>评分项</th>
								<th>分值</th>
								<th>评分表级别</th>
								<th>分级1</th>
								<th>分级2</th>
							</tr>
							<tr v-for="(index1,value1) in item.contentName">
								<td>{{index1+1}}</td>
								<td>{{value1.evaluate}}</td>
								<td>{{value1.score}}</td>
								<td>{{type | typeFn}}</td>
								<td>{{value1.level1}}</td>
								<td>{{value1.level2}}</td>
							</tr>
						</table>
					</li>
					<li style="margin-top: 20px;">
						<span style="margin-left: 20px;">总分 ：</span>
						<span>{{allScore}}</span>
					</li>
				</ol>
				<!--三级-->
				<ol v-if="type==3">
					<li v-for="(index,item) in conList">
						<p>
							<span>{{index+1 | filterFn}}、</span>
							<span>{{item.name}}</span>
						</p>
						<table class="table table-bordered table-hover">
							<tr class="active">
								<th>序号</th>
								<th>评分项</th>
								<th>分值</th>
								<th>评分表级别</th>
								<th>分级1</th>
								<th>分级2</th>
								<th>分级3</th>
							</tr>
							<tr v-for="(index1,value1) in item.contentName">
								<td>{{index1+1}}</td>
								<td>{{value1.evaluate}}</td>
								<td>{{value1.score}}</td>
								<td>{{type | typeFn}}</td>
								<td>{{value1.level1}}</td>
								<td>{{value1.level2}}</td>
								<td>{{value1.level3}}</td>
							</tr>
						</table>
					</li>
					<li style="margin-top: 20px;">
						<span style="margin-left: 20px;">总分 ：</span>
						<span>{{allScore}}</span>
					</li>
				</ol>
				<!--五级-->
				<ol v-if="type==5">
					<li v-for="(index,item) in conList">
						<p>
							<span>{{index+1 | filterFn}}、</span>
							<span>{{item.name}}</span>
						</p>
						<table class="table table-bordered table-hover">
							<tr class="active">
								<th>序号</th>
								<th>评分项</th>
								<th>分值</th>
								<th>评分表级别</th>
								<th>分级1</th>
								<th>分级2</th>
								<th>分级3</th>
								<th>分级4</th>
								<th>分级5</th>
							</tr>
							<tr v-for="(index1,value1) in item.contentName">
								<td>{{index1+1}}</td>
								<td>{{value1.evaluate}}</td>
								<td>{{value1.score}}</td>
								<td>{{type | typeFn}}</td>
								<td>{{value1.level1}}</td>
								<td>{{value1.level2}}</td>
								<td>{{value1.level3}}</td>
								<td>{{value1.level4}}</td>
								<td>{{value1.level5}}</td>
							</tr>
						</table>
					</li>
					<li style="margin-top: 20px;">
						<span style="margin-left: 20px;">总分 ：</span>
						<span>{{allScore}}</span>
					</li>
				</ol>
			</div>
			<ul style="border-top: 1px solid lightgray;padding-top: 20px;">
				<li>
					<p class="left">所属课程 ：</p>
					<p class="right">{{operation.coursename}}</p>
				</li>
			</ul>
			<div style="text-align: center;">
				<button class="btn btn-primary" @click="sureBtn">确定</button>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		var vm = new Vue({
			el: '#operation',
			data: {
				operation: '',
				list: '',
				conList: [],
				allScore: '',
				type:''
			},
			created() {
				this.getOperation();
				this.operationList();
			},
			filters: {
				filterFn: function(val) {
					return china(val + "")
				},
				typeFn:function(value){
					if (value==2) {
						return '二级'
					} else if(value==3){
						return "三级"
					}else{
						return '五级'
					}
				}
			},
			mounted() {},
			methods: {
				sureBtn:function(){
					closeAll()
				},
				getOperation: function() {
					var self = this;
					var data = {
						command: 'question/queryoprquestion',
						sessionid: getCookie('sid'),
						loginid: getCookie('uid'),
						questionbaseid: window.location.href.split('=')[1]
					}

					function callback(res) {
						self.operation = res;
						console.log(res)
					}
					post('/question/queryoprquestion', data, callback, errcodefn, errfn)
				},
				operationList: function() {
					var self = this;
					var data = {
						command: 'question/queryoperation',
						sessionid: getCookie('sid'),
						loginid: getCookie('uid'),
						questionid: window.location.href.split('=')[1]
					}

					function callback(res) {
						self.allScore = res.total;
						self.list = res.queryOperationlist;
						self.type=res.gradelevel;
						var newList = [];
						var scoreList = [];
						var lengthList = [];
						for(var i = 0; i < self.list.length; i++) {
							newList.push(self.list[i].opstepcontent);
							lengthList.push(self.list[i].adjuststepunit)
						}
						for(var i = 0; i < self.unique(newList).length; i++) {
							self.conList.push({
								name: self.unique(newList)[i],
								contentName: [],
							})
						}
						for(var i = 0; i < self.conList.length; i++) {
							for(var j = 0; j < self.list.length; j++) {
								if(self.conList[i].name == self.list[j].opstepcontent) {
									self.conList[i].contentName.push({
										evaluate: self.list[j].rightoperation,
										score: self.list[j].gradeitemscore,
										footList: self.list[j].adjuststepunit,
										level1:self.list[j].classification1,
										level2:self.list[j].classification2,
										level3:self.list[j].classification3,
										level4:self.list[j].classification4,
										level5:self.list[j].classification5,
									})
								}
							}
						}
					}
					post('/question/queryoperation', data, callback, errcodefn, errfn)
				},

				unique: function(arr) {
					var result = [];
					var json = {};
					for(var i = 0; i < arr.length; i++) {
						if(!json[arr[i]]) {
							result.push(arr[i]);
							json[arr[i]] = 1;
						}
					}
					return result;
				}
			}
		})
		//序号转为中文
		var _change = {
			ary0: ["零", "一", "二", "三", "四", "五", "六", "七", "八", "九"],
			ary1: ["", "十", "百", "千"],
			ary2: ["", "万", "亿", "兆"],
			init: function(name) {
				this.name = name;
			},
			strrev: function() {
				var ary = [];
				for(var i = this.name.length; i >= 0; i--) {
					ary.push(this.name[i]);
				}
				return ary.join("");
			},
			isUnit: function(ary) {
				var retVal = false;
				var cur = ary[0];
				if(this.ary2.indexOf(cur) > 0) {
					retVal = true;
				}
				return retVal;
			},
			pri_ary: function() {
				var $this = this;
				var ary = this.strrev();
				var zero = "";
				var newary = "";
				var i4 = -1;
				for(var i = 0; i < ary.length; i++) {
					if(i % 4 == 0) {
						i4++;
						newary = this.ary2[i4] + newary;
						zero = "";
					}
					if(ary[i] == '0') {
						switch(i % 4) {
							case 0:
								break;
							case 1:
							case 2:
							case 3:
								if(ary[i - 1] != '0') {
									zero = "零";
								}
								break;

						}

						newary = zero + newary;
						zero = '';
					} else {
						newary = this.ary0[parseInt(ary[i])] + this.ary1[i % 4] + newary;
					}

				}
				while(newary.indexOf("零") == 0 || this.isUnit(newary)) {
					newary = newary.substr(1);
				}
				return newary;
			}
		}
		function change() {
			this.init.apply(this, arguments);
		}
		change.prototype = _change;
		function china(val) {
			var k = new change(val);
			if(val >= 10 && val <= 19) {

				return k.pri_ary().substring(1, 3)
			} else {
				return k.pri_ary()
			}

		}
	</script>

</html>