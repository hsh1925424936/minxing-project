<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/layout.js" ></script>
		<meta charset="UTF-8">
		<title>个人资料</title>
		<link rel="stylesheet" type="text/css" href="../../css/ostp/person-center.css"/>
		<style type="text/css">

			.rightTit{
				width:100%; line-height:85px; font-size:18px;
				text-align:left;
			}
			.editPInfo{
				float:right; font-size:14px; color:#3399FF;
				cursor:pointer;
			}

			.personImgOuter{
				width:100px; float:left; position: relative;
			}
			.personImg{
				width:100px; height:100px; display:block;
				border-radius:50px; border:5px solid #F0F4F7;
			}
			.imgTip{
				color:rgb(204,204,204); font-size:12px; line-height:18px;
				margin-bottom:20px; margin-top:20px;
			}
			.changeHeadBtn,.headImg_file{
				width:102px; height:34px; color:rgb(4,151,202);
				background-color:white; text-align:center;
				line-height:32px; border:1px solid #0497CA;
				font-size:14px;
			}

			.headImg_file {
				position: absolute; left: 0; bottom: 0; opacity: 0; cursor: pointer;
			}

			.pInfoOuter{
				font-size:14px; color:rgb(102,102,102); float:left;
				width:650px; padding-left:40px;

			}
			.pInfoOuter .row{
				margin-top:35px; margin-bottom:35px; line-height:34px;
			}
			.pInfoOuter input{
				/*border-radius:0px;*/
			}
			.save{
				width:192px; height:36px; color:white;
				background-color:#0497CA; border-radius:30px;
				line-height:36px; text-align:center;
				font-size:15px; margin:0 auto; display:block;
				margin-top:90px;
			}
			
			.hidden{
				display:none;
			}
			.disableInp{
				border:0px; 
			}
			.editInp{
				width:100%; background-color:transparent;
			}
			.form-control[disabled]{
				background-color:transparent;
			}
			.canEdit{
				border:1px solid #ccc;
			}
		</style>
		<script>
			//$('.bootstrap').remove();
		</script>
	</head>
	<body>
		<div class="topOuter">
			<div class="topCon clearfix">
				<a href="index.html" class="top2Con-index">
					<img src="../../images/ostp/logo.png" class="logoPng" />
					<div class="top2Tit">
						在线自主技能训练平台
					</div>					
				</a>
				<div class="top1Tit-right">
					<img src="../../images/ostp/bell.png" class="bell" />
					<img src="../../images/ostp/redCircle.png" class="redCircle" />
					<img src="../../images/ostp/feifei.png" class="headImg" />
					<div class="nameAndYear clearfix">
						<div class="nameAndYearInner clearfix">
							<div class="userName"></div>
							<div class="year"></div>
							<span class="arrow"></span>
						</div>
						<ul class="selectUl"></ul>
					</div>
				</div>
			</div>
		</div>

		<div class="main clearfix">
			<div class="leftOuter">

			</div>

			<div class="rightOuter clearfix">
				<div class="rightTit">
					个人资料
					<div class="editPInfo" status='0'>
						编辑资料
					</div>
				</div>

				<div class="personImgOuter">
					<img src="../../images/ostp/feifei.png" class="personImg" />
					<div class="imgTip hidden">
						请选择本地照片大小不超过2M
					</div>
					<button class="changeHeadBtn hidden">
						修改头像
					</button>
					<input type="file" accept="image/*" class="headImg_file hidden">
				</div>
					
				<div class="pInfoOuter clearfix">
					<div class="row">
						<div class="col-xs-2">
							用户名
						</div>
						<div class="col-xs-4 usename">
							
						</div>
						<div class="col-xs-2">
							姓名
						</div>
						<div class="col-xs-4 name">
							
						</div>
					</div>

					<div class="row">
						<div class="col-xs-2">
							学号
						</div>
						<div class="col-xs-4 code">
							
						</div>
						<div class="col-xs-2">
							年级
						</div>
						<div class="col-xs-4 grade">
							
						</div>
					</div>

					<div class="row">
						<div class="col-xs-2">
							专业
						</div>
						<div class="col-xs-4 majorname">
							
						</div>
						<div class="col-xs-2">
							学制
						</div>
						<div class="col-xs-4 years">
							
						</div>
					</div>

					<div class="row">
						<div class="col-xs-2">
							性别
						</div>
						<div class="col-xs-4 sex">
							
						</div>
						<div class="col-xs-2">
							手机号
						</div>
						<div class="col-xs-4">
							<input class="editInp mobile form-control disableInp" value="" disabled="disabled" />
						</div>
					</div>

					<div class="row">
						<div class="col-xs-2">
							一卡通号
						</div>
						<div class="col-xs-4 cardno">
							
						</div>
						<div class="col-xs-2">
							邮箱
						</div>
						<div class="col-xs-4">
							<input class="editInp email form-control disableInp" value="" disabled="disabled" />
							
						</div>
					</div>

					<div class="row">
						<div class="col-xs-3">
							证件号(身份证)
						</div>
						<div class="col-xs-4 card_num">
							
						</div>
						
					</div>

					<button class="save hidden">
						保存
					</button>

				</div>
			</div>

		</div>
	</body>
	
	<script type="text/javascript">
		window.onload = function () {
			'use strict';
			common();			
			showpersoncenter('个人资料');	
			Api.R({
				url: "/usr/queryuserinfo",
				isShade: 1,
				json:{
					"1":{
						command: "usr/querymyinfo",
						uid: getCookie('gy_u'),
						loginid:getCookie('gy_u'),
						sessionid: getCookie('gy_t'),
						mobile: getCookie('gy_mobile'),
						cardno: getCookie('gy_cardno')
					}
				},
				fn:function (base) {
					if ( base["1"].errcode != 0 ) {
						uselayer(3,base["1"].errdesc);
						return false;
					}
					var json = base[1];					
					console.log(json);
					$('.personImg').attr('src',json.imgurl?json.imgurl:'../../images/ostp/feifei.png');
					$('.name').html(json.name);
					$('.sex').html(json.sex==0?'男':'女');
					$('.card_num').html(json.card_num);
					$('.mobile').val(json.mobile);
					$('.email').val(json.email);
					$('.code').html(json.code);
					// $('.deptname').html(json.deptname);
					$('.majorname').html(json.majorname);
					$('.years').html(json.years);
					$('.cardno').html(json.cardno);//一卡通号
					$('.grade').html(json.grade+'级');
					setCookie('gy_g',strtocode(json.grade+'级'));
					$('.usename').html(getCookie('gy_c'));
				}
			});			
			
			$('.headImg_file').on('change',function () {
			 	uploadFile({
			 		url:Api.url+'/upload-image',
			 		json:{
			 			"1":{
				 			'access_token':getCookie("gy_t"),
				 			"Filedata":$(this)[0].files[0]
			 			}
			 			
			 		},
			 		success:function (str) {
			 			var json = eval('('+str+')');
			 			console.log(json);
						if (json.code==1) {
							$('.personImg').attr('src',Api.url+'/'+json.filepath);
						}				 			
						uselayer(1,json.message);	
			 		}
			 	});						
			});					
			$('.save').click(function () {
				var reg=/^1[3-578]\d{9}$/;
				if(!reg.test($.trim($('.mobile').val()))){
					uselayer(3,'请输入正确的手机号');
					return false;
				}					
				var re = /^\w{3,18}@[a-z0-9\-]+(\.[a-z]{2,6}){1,2}$/i;
				if(!re.test($.trim($(".email").val()))){
					uselayer(3,'请输入正确的邮箱地址');
						return false;
				}					
				Api.R({
					url:'/usr/modifypersonalinfo',
					isrepeat:$(this),
					json:{
						"1":{
							command:'usr/modifypersonalinfo',
							accountname:getCookie('gy_un'),
							sessionid:getCookie('gy_t'),
							loginid:getCookie('gy_u'),
							uid: getCookie('gy_u'),
							imageurl:$('.personImg').attr('src'),
							mobile:$.trim($('.mobile').val()),
							email:$.trim($('.email').val())
						}
						
					},
					fn:function (json) {
						json = json[1];
						console.log(json)
						
						if ( json.errcode != 0 ) {
							uselayer(3,json.errdesc);
							return false;
						}
						uselayer(3,'修改成功',function () {
							setCookie('gy_a',$('.personImg').attr('src'),7);
							window.location.reload();
						});
					}
				});			
			});


			$('.editPInfo').click(function() {
				if( $('.editPInfo').attr('status') == 0 ){
					$('.editPInfo').attr('status', '1');
					$('.editPInfo').html('取消编辑');
					$('.imgTip').removeClass('hidden');
					$('.changeHeadBtn').removeClass('hidden');
					$('.headImg_file').removeClass('hidden');
					$('.save').removeClass('hidden');
					$('.editInp').removeClass('disableInp');
					$('.editInp').addClass('canEdit');
					$('.editInp').removeAttr('disabled');
				}else{
					$('.editPInfo').attr('status', '0');
					$('.editPInfo').html('编辑资料');
					$('.imgTip').addClass('hidden');
					$('.changeHeadBtn').addClass('hidden');
					$('.headImg_file').addClass('hidden');
					$('.save').addClass('hidden');
					$('.editInp').addClass('disableInp');
					$('.editInp').removeClass('canEdit');
					$('.editInp').attr('disabled','disabled');
				}
	
			});

		};
	


	</script>

</html>
