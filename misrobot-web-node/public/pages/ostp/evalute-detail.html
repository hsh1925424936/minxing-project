<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/layout.js" ></script>
		<meta charset="UTF-8">
		<title>查看评论详情</title>
		<link rel="stylesheet" type="text/css" href="../../css/ostp/person-center.css"/>
		<style type="text/css">
			.main { 
				background-color:#FCFCFC;
			}
			.rightOuter{
				background-color:#FCFCFC; height:100%;
				padding-left:30px; padding-right:30px;
			}
			.evaluteTit{
				width:100%; height:75px; line-height:75px;
				border-bottom:1px solid #EFEFEF; padding-left:20px;
				padding-right:20px;
			}
			.evaluteTit>h3{
				width:100px; height:100%; float:left;
				font-size:16px; font-weight:bold; line-height:73px;
			}
			.evaluteTit>span{
				width:60px; height:100%; float:right;
				font-size:14px; line-height:73px; color:#8E8E8E;
			}

			.evaluteDetail{
				width:100%; padding-left:20px; padding-right:20px;
				border-bottom:1px solid #EFEFEF;
			}
			.evaluteCon{
				width:33%; height:60px; float:left;
				font-size:14px; line-height:60px;
			}
			.evaluteTime{
				font-size:12px;
			}

			.evaluateItem{
				font-size:14px; padding:28px;
			}
			.evaluateItem>p{
				float:left; width:100%; line-height:18px;
				margin-bottom:30px;
			}
			.evaluateItem>ul{
				width:270px; height:28px; float:left;
			}
			.starOuter>li{
				width:28px; height:28px; display:block;
				float:left; margin-right:22px;
				background-size:100% 100%; background-repeat:no-repeat;
			}
			.starNot{
				background-image:url('../../images/ostp/star2.png');
			}
			.starOn{
				background-image:url('../../images/ostp/star3.png');
			}
			.evaluateItem>span{
				width:90px; float:left; margin-left:20px;
				display:block; margin-top:10px;
				font-size:12px; color:#FF9037;
			}
			.sub-btn {
				margin: 0 auto; display: none;
			}
			
			
		</style>
		<script>
			//$('.bootstrap').remove();
		</script>
	</head>
	<body>
		<div class="topOuter">
			<div class="topCon clearfix">
				<a href="index.html" class="top2Con-index">
					<img src="../../images/ostp/logo.png" class="logoPng" />
					<div class="top2Tit">
						在线自主技能训练平台
					</div>					
				</a>
				<div class="top1Tit-right">
					<img src="../../images/ostp/bell.png" class="bell" />
					<img src="../../images/ostp/redCircle.png" class="redCircle" />
					<img src="../../images/ostp/feifei.png" class="headImg" />
					<div class="nameAndYear clearfix">
						<div class="nameAndYearInner clearfix">
							<div class="userName"></div>
							<div class="year"></div>
							<span class="arrow"></span>
						</div>
						<ul class="selectUl"></ul>
					</div>
				</div>
			</div>
		</div>

		<div class="main clearfix">
			<div class="leftOuter">

			</div>

			<div class="rightOuter clearfix">
				
				<div class="evaluteTit clearfix">
					<h3>评价详情</h3>
					<span class="cancle">返回</span>
				</div>

				<ul class="evaluteDetail clearfix">
					<li class="evaluteCon"></li>
					<li class="evaluteCon"></li>
					<li class="evaluteCon evaluteTime"></li>
					<li class="evaluteCon"></li>
					<li class="evaluteCon"></li>
				</ul>
				
				<div class="evaluateList"></div>
				

				<input type="button" class="btn btn-success sub-btn" value=" 提交 " />
				
				
			</div>

		</div>
	</body>
	
	<script type="text/javascript">
		window.onload = function () {
			'use strict';
			// common();			
			showpersoncenter('查看评论');
			
			var oType = findurl('type');

			var oId;
			if( findurl('estu') ){
				oId = findurl('estu');
			}else{
				oId = findurl('estu_id');
			}
			console.log(oId);
			

			if (oType=='e') {
				showedit();
				
			} else if (oType=='v') {
				showview();
				
			}
			
			
			function showview() {//显示已评价
				Api.R({
					url: "/evt/evtdetail",
					istoken:1,
					isShade: 1,
					json:{
						"1": {
							command: "evt/evtdetail",
							evtid: oId,
							uid: getCookie('gy_u'),
							sessionid: getCookie('gy_t'),
							loginid: getCookie('gy_u')
						}
					},
					fn:function (base) {
						if(base["1"].errcode != 0){
							uselayer(3, base["1"].errdesc);
							return false;
						}
						var evaluat = base["1"];
						$('.evaluteCon').eq(0).html('课程内容：'+ evaluat.coursename);
						$('.evaluteCon').eq(1).html('授课老师：'+ evaluat.teachername);
						$('.evaluteCon').eq(2).html('评价时间：'+ evaluat.evttime);
						$('.evaluteCon').eq(3).html('上课时间：'+ evaluat.starttime);
						$('.evaluteCon').eq(4).html('上课地点：'+ evaluat.placename);									
						$('.evaluteCon').eq(2).css('visibility','visible');
						var arr = evaluat.evtitems;
						$('.evaluateList').html('');
						for (var i = 0 ; i < arr.length; i++) {
							var _str = '优秀';
							switch (arr[i].evtitemscore){
								case 1:_str = '极差';
									break;
								case 2:_str = '差';
									break;
								case 3:_str = '合格';
									break;
								case 4:_str = '良好';
									break;
								case 5:_str = '优秀';
									break;
							}							
							var str = 
									'<div class="evaluateItem clearfix">'
										+'<p>'+(i+1)+'、'+arr[i].evtcontent+'</p>'
										+'<ul class="starOuter" _id="'+arr[i].evtitemid+'" _score="'+arr[i].evtitemscore+'" >'
											+'<li class="starNot"></li>'
											+'<li class="starNot"></li>'
											+'<li class="starNot"></li>'
											+'<li class="starNot"></li>'
											+'<li class="starNot"></li>'
										+'</ul>'
										+'<span>'+_str+'</span>'
									+'</div>';								
							$('.evaluateList').append(str);
						}								
						
						$('.starOuter').each(function () {							
							$(this).find('li:lt('+$(this).attr('_score')+')').addClass('starOn');
						});
					}
				});
				
				
			};
			
			
			
			
			function showedit() {//未评价
				Api.R({
					url: "/evt/evtdetail",
					istoken:1,
					isShade: 1,
					json:{
						"1": {
							command: "evt/evtdetail",
							evtid: oId,
							uid: getCookie('gy_u'),
							sessionid: getCookie('gy_t'),
							loginid: getCookie('gy_u')
						}
					},
					fn:function (json) {
						if(json["1"].errcode != 0){
							uselayer(3, json["1"].errdesc);
							return;
						}
						if(json["1"].evtstatus == 1){
							uselayer(3,'此评价项您已评价！');
							var t = setTimeout(function(){
								history.go(-1);
							},2000);
							
						}
						else{
							$('.evaluteCon').eq(0).html('课程内容：'+ json["1"].coursename);
							$('.evaluteCon').eq(1).html('授课老师：'+ json["1"].teachername);
							$('.evaluteCon').eq(2).html('评价时间：'+ json["1"].evttime);
							$('.evaluteCon').eq(3).html('上课时间：'+ json["1"].starttime);
							$('.evaluteCon').eq(4).html('上课地点：'+ json["1"].placename);
							$('.evaluteCon').eq(2).css('visibility','hidden');
							var arr= json["1"].evtitems;
							$('.evaluateList').html('');
							for (var i = 0 ; i < arr.length; i++) {
								var str = 
										'<div class="evaluateItem clearfix">'
											+'<p>'+(i+1)+'、'+arr[i].evtcontent+'</p>'
											+'<ul class="starOuter" _id="'+arr[i].evtitemid+'" content="'+arr[i].evtcontent+'">'
												+'<li class="starNot"></li>'
												+'<li class="starNot"></li>'
												+'<li class="starNot"></li>'
												+'<li class="starNot"></li>'
												+'<li class="starNot"></li>'
											+'</ul>'
											+'<span></span>'
										+'</div>';								
								$('.evaluateList').append(str);
							}	

							$('.starOuter li').click(function () {
								$(this).parent().find('li').removeClass('starOn');
								$(this).parent().find('li:lt('+($(this).index()+1)+')').addClass('starOn');
							});
							$('.sub-btn').css('display','block');
							$('.sub-btn').click(function () {
								var aScore = [];
								var evtitems = [];//评估项数组
								var ok = true;
								$('.starOuter').each(function () {
									if ($(this).find('.starOn').length==0) {
										ok=false;
										return true;
									} else {
										// aScore.push({evtitemid: $(this).attr('_id'), evtitemscore: $(this).find('.starOn').length});
										// aId.push($(this).attr('_id'));
										// aScore.push($(this).find('.starOn').length);
										evtitems.push({
											evtcontent:$(this).attr('content'),
											evtitemid:$(this).attr('_id'),
											evtitemscore:$(this).find('.starOn').length
										});
									}
								});
								if (!ok) {
									uselayer(3,'你还有未评价项');
									return false;
								}
								uselayer(2,'确认无误，提交评价？',function () {
									Api.R({
										url: "/evt/evtsubmit",
										istoken:1,
										json:{
											"1": {
												command: "evt/evtsubmit",
												sessionid: getCookie('gy_t'),
												uid: getCookie('gy_u'),
												loginid: getCookie('gy_u'),
												evtid: oId,
												evtitems: evtitems
											}
										},
										fn:function (json) {
											if(json["1"].errcode != 0){
												uselayer(3, json["1"].errdesc);
												return;
											}
											uselayer(1, '提交评价成功！', function () {
												window.location.href="see-evalute.html";
											});
										}
									});								
								});							
							});
						}
												
					}
				});
			};
		};
	</script>

</html>
