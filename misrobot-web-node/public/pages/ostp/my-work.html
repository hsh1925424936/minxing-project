<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/layout.js" ></script>
		<script type="text/javascript" src="../../js/jqPaginator.js"></script>
		<meta charset="UTF-8">
		<title>我的作业</title>
		<style type="text/css">

			.myworkTop{
				width:1024px; height:75px; margin:0 auto;
			}
			.myworkTopTxt{
				float:left; width:100px; height:100%;
				line-height:75px; font-size:16px;
			}
			.countDownSelectOuter{
				float:right; width:140px; height:38px; margin-top:18px;
				margin-right:15px;
			}
			.countDownSelectOuter>select{
				height:100%;
			}
			.myworkTop>a{
				width:128px; height:32px; float:right; display:block;
				margin-right:28px; border:1px solid #CCCCCC;
				border-radius:30px; font-size:12px; color:#8B8C8E;
				text-align:center; line-height:30px; background-color:#F3F7F8;
				margin-top:20px;
			}

			.workOuter{
				width:1024px; margin:0 auto; background-color:white;
			}
			.workBox{
				width:100%; border-bottom:1px solid #E4E4E4;
				padding-left:50px; padding-right:50px;
			}
			.workTit{
				width:400px; height:70px; font-size:18px;
				font-weight:bold; line-height:70px; float:left;
			}
			.countDown{
				width:500px; height:70px; font-size:12px; line-height:70px;
				float:right; text-align:right;
			}
			.countDown span{
				font-size:16px; color:#0598CC;
			}
			.progressBar{
				width:350px; font-size:14px; float:left; padding-bottom: 20px; min-height: 58px;
			}
			.circle{
				display:block; float:left; width:38px; height:38px;
				line-height:36px; text-align:center; border:1px solid #CCCCCC;
				border-radius:20px; font-size:14px; color:#CCCCCC; overflow: hidden;
			}
			.circleOn{
				color:white; background-color:#EBB843;
			}
			.line{
				display:block; float:left; width:82px; height:2px;
				margin-top:18px; background-color:#CCCCCC;
			}
			.lineOn{
				background-color:#E9BB41;
			}
			.workBoxSpan{
				width:236px; height:38px; font-size:15px;
				line-height:38px; float:left;
			}
			.workBoxSpanOn{
				color:#E9BB41;
			}
			.starttrainBtn{
				border:1px solid #0497CA; display:block;
			}
			.goOnTrainBtn,.goOnTrainBtn:hover,.goOnTrainBtn:focus{
				border:1px solid #FABD7E; color:#FABD7E;
			}
			.workBox>a{
				display:block; width:95px; height:26px; float:left;
				border-radius:20px; background-color:white;
				margin-top:6px; text-align:center;
			}
			.grey,.grey:hover,.grey:focus{
				border-color: #ccc; background: #ccc!important; color:#fff;
			}

			.fenyeCon{
				width:700px; padding-bottom:50px; margin:auto;
			}
			
		</style>
		<script>
			function fenye(allcount,page){//分页的方法
				var totalPages =  Math.ceil(allcount/5);
				$.jqPaginator('#pagination1', {//分页
			        totalPages:totalPages,
		            visiblePages: 10,
		            currentPage: page,
		            first: '<li class="first"><a href="javascript:void(0);">首页</a></li>',
		            prev: '<li class="prev"><a href="javascript:void(0);"><i class="_arrow arrow2"></i>上一页</a></li>',
		            next: '<li class="next"><a href="javascript:void(0);">下一页<i class="_arrow arrow3"></i></a></li>',
		            last: '<li class="last"><a href="javascript:void(0);">末页</a></li>',
		            page: '<li class="page"><a href="javascript:void(0);">{{page}}</a></li>',
			        onPageChange: function (num, type) {
			        	if(type == 'change'){
			        		getList(num);//type2为下拉列表的类型
			        	}
			            
			        }
			    });
			}

			function getList(page) {
				Api.R({
					url: "/learn/querytaskinfo",
					isShade:1,
					json: {
						"1": {
							command: "learn/querytaskinfo",
							uid: getCookie('gy_u'),
							sessionid: getCookie('gy_t'),
							loginid: getCookie('gy_u'),
							page:page,
							reqnum:5,
							kind:0
						}
					},
					fn:function (result) {
						if(result["1"].errcode != 0){
							uselayer(3, result["1"].errdesc);
							return;
						}
						// console.log(array);

						var arr = result["1"].tasks;
						if (arr.length==0) {
							$('.workOuter').html('<p class="no-data">暂无作业</p>');
							$('.fenyeCon').css('display', 'none');
							return false;
						}
						
						$('.workOuter').html('');
						for (var i = 0 ; i < arr.length; i++) {
							var _str = '';
							_str= '<span class="circle '+(arr[i].finishcount ==0 ? '':'circleOn')+'">练</span>';


							var _href = '<a class="starttrainBtn grey" href="javascript:;" target="_blank">已过期</a>';
							var isTrue = (datetotime(arr[i].lasttime)*1000) - (new Date()).getTime();
							if (isTrue >0) {
								var _href = '<a class="goOnTrainBtn" href="my-work-detail.html?train='+arr[i].learnid+'&tasklog='+arr[i].taskid+'"  target="_blank">继续训练</a>';
								if (arr[i].finishcount==0) {
									_href = '<a class="starttrainBtn" href="my-work-detail.html?train='+arr[i].learnid+'&tasklog='+arr[i].taskid+'" target="_blank">开始训练</a>';
								}								
							}

							var rate = (Math.round((arr[i].finishcount/arr[i].mincount)*100)).toFixed(2);
							var str = 
								'<div class="workBox clearfix">'
									+'<h4 class="workTit">'+arr[i].name+'</h4>'
									+'<h4 class="countDown" _end="'+(datetotime(arr[i].lasttime)*1000) +'">'
										+'距离<span>0</span>分<span>0</span>秒'
									+'</h4>'
									+'<div class="progressBar clearfix">'
										+_str
									+'</div>'
									+'<span class="workBoxSpan span1">'+arr[i].teachers[0].name+'</span>'
									+'<span class="workBoxSpan span2 '+(arr[i].lasttime==0?'':'workBoxSpanOn')+'">'
										+'需要完成'+arr[i].mincount+'次&nbsp;进度'+ rate +'%'
									+'</span>'
									+_href
								+'</div>';								
							$('.workOuter').append(str);
						}
						
						$('.countDown').each(function () {
							var time = $(this).attr('_end').toString().substr(0,10) - ((new Date()).getTime()).toString().substr(0, 10);
							if (time<0) {
								return true;
							}
							var obj = $(this);
							var timer = null;
							timer = setInterval(tocountdown,1000);
							tocountdown();
							function tocountdown() {
								var d = parseInt(time/86400);
								var h = addzero(parseInt(time%86400/3600));
								var m = addzero(parseInt(time%86400%3600/60));
								var s = addzero(time%60);
								$(obj).html('距离'+(d>0?'<span>'+d+'</span>天':'')+(h>0?'<span>'+h+'</span>小时':'')+'<span>'+m+'</span>分<span>'+s+'</span>秒');
								time--;
								if (time<=0) {
									clearInterval(timer);
									$(obj).parent().find('a').attr('href','javascript:;');
									$(obj).parent().find('a').addClass('grey');
									$(obj).parent().find('a').html('已过期');
								}
							};					
						});
						
						fenye(result["1"].allcount,page);//生成分页
					}
				});					
				
			};

			window.onload = function () {
				'use strict';
				common();				
				getList(1);
			};
		</script>
	</head>
	<body>
	
		<div class="top1Con">
			<div class="top1Outer clearfix">
				<a href="index.html" class="top1Tit">临床技能中心</a>
				<div class="top1Tit-right">
					<img src="../../images/ostp/bell.png" class="bell" />
					<img src="../../images/ostp/redCircle.png" class="redCircle" />
					<img src="../../images/ostp/feifei.png" class="headImg" />
					<div class="nameAndYear clearfix">
						<div class="nameAndYearInner clearfix">
							<div class="userName"></div>
							<div class="year"></div>
							<span class="arrow"></span>
						</div>
						<ul class="selectUl"></ul>
					</div>
				</div>
			</div>
		</div>

		<div class="top2Outer">
			<div class="top2Con clearfix">
				<a href="index.html">
					<img src="../../images/ostp/logo.png" class="logoPng" />
					<div class="top2Tit">在线自主技能训练平台</div>					
				</a>

				<div class="navigateOuter clearfix">
					<a href="index.html" class="navigate">
						首页
					</a>
					<a href="my-work.html" class="navigate navigateOn">
						我的作业
					</a>
					<a href="self-train.html" class="navigate">
						自主训练
					</a>
					<a href="online-study.html" class="navigate">
						自主学习
					</a>
					<div class="navigate">
						成长中心
						<ul>
							<li><a href="grow-center.html">学习指数</a></li>
							<li><a href="train-record.html">训练记录</a></li>
						</ul>
					</div>	
					<!-- <a href="subscribe-train.html" class="navigate">
						预约训练
					</a> -->
				</div>
			</div>
		</div>

		<!-- <div class="mainOuter"><div class="countDownSelectOuter">
		</div> -->
			<div class="myworkTop">
				<h3 class="myworkTopTxt">
					我的作业
				</h3>

				<a href="my-work-overdue.html">已过期作业</a>
			</div>

			<div class="workOuter">

			</div>

			<div class="fenyeCon">
				<ul class="pagination" id="pagination1"></ul>
			</div>

		</div>

	</body>
	
</html>
