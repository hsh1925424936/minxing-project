<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/layout.js" ></script>
		<script type="text/javascript" src="../../js/jqPaginator.js"></script>
		<meta charset="UTF-8">
		<title>自主训练</title>
		<style type="text/css">

			.conditionOuter{
				width:100%; height:70px;
			}
			.conditionOuter>span{
				width:80px; height:100%; float:left;
				font-size:16px; line-height:70px;
			}
			.searchOuter{
				width:516px; height:40px; float:left;
				margin-left:70px; margin-top:15px; position:relative;
			}
			.searchOuter>input{
				border-radius:40px;
			}
			.searchOuter>img{
				display:block; position:absolute; right:20px;
				top:50%; margin-top:-16px; width:25px; height:25px;
			}
			.select1{
				margin-left:200px; width:130px; height:40px; float:left;
				margin-top:15px;
			}

			.fileOuter{
				width:100%;
			}
			.fileCon{
				width:235px; height:275px; background-color:white;
				float:left; margin-right:20px; padding-bottom:20px;
				margin-bottom:20px;
			}
			.filePic{
				width:100%; height:170px; overflow:hidden;
				background-size:100% 100%; background-repeat:no-repeat;
			}
			.filePic img { display: block; width: 100%; height: 100%;}
			
			
			.fileTxt{
				width:100%; margin-top:21px; background-color:white;
				opacity:0.5; padding-left:30px; padding-right:30px;
				padding-top:12px; padding-bottom:12px;
			}
			.fileTxt1{
				display:block; font-size:14px;
			}
			.fileTxt2{
				display:block; font-size:24px;
			}
			.fileName{
				width: 100%; font-size: 14px; padding: 20px;
    			color: rgb(51,51,51); padding-bottom: 0px; margin-bottom: 12px;
    			overflow: hidden; height: 50px; padding-top: 30px;
			}
			.fileBottom{
				width:100%; height:26px;
			}
			.headIcon{
				width:12px; height:16px; margin-top:5px;
				background-image:url('../../images/ostp/head4.png');
				background-size:100% 100%; background-repeat:no-repeat;
				float:left; margin-left:30px;
			}
			.count{
				float:left; color:rgb(153,153,153); font-size:12px;
				width:70px; height:100%; line-height:26px;
				margin-left:5px;
			}
			.fileType{
				float:right; width:116px; height:26px;
				font-size:14px; color: rgb(153,153,153);
				line-height:26px; text-align:center;
			}

			.fenyeCon{
				width:700px; padding-bottom:50px; margin:auto;
			}

		</style>
		<script>
			//$('.bootstrap').remove();
		</script>
	</head>
	<body>
	
		<div class="top1Con">
			<div class="top1Outer clearfix">
				<a href="index.html" class="top1Tit">临床技能中心</a>
				<div class="top1Tit-right">
					<img src="../../images/ostp/bell.png" class="bell" />
					<img src="../../images/ostp/redCircle.png" class="redCircle" />
					<img src="../../images/ostp/feifei.png" class="headImg" />
					<div class="nameAndYear clearfix">
						<div class="nameAndYearInner clearfix">
							<div class="userName"></div>
							<div class="year"></div>
							<span class="arrow"></span>
						</div>
						<ul class="selectUl"></ul>
					</div>
				</div>
			</div>
		</div>

		<div class="top2Outer">
			<div class="top2Con clearfix">
				<a href="index.html" class="top2Con-index">
					<img src="../../images/ostp/logo.png" class="logoPng" />
					<div class="top2Tit">在线自主技能训练平台</div>					
				</a>
				<div class="navigateOuter clearfix">
					<a href="index.html" class="navigate">
						首页
					</a>
					<a href="my-work.html" class="navigate">
						我的作业
					</a>
					<a href="self-train.html" class="navigate navigateOn">
						自主训练
					</a>
					<a href="online-study.html" class="navigate">
						自主学习
					</a>
					<div class="navigate">
						成长中心
						<ul>
							<li><a href="grow-center.html">学习指数</a></li>
							<li><a href="train-record.html">训练记录</a></li>
						</ul>
					</div>	
					<!-- <a href="subscribe-train.html" class="navigate">
						预约训练
					</a> -->
				</div>
			</div>
		</div>

		<div class="mainOuter">
			<div class="conditionOuter clearfix">
				<span>自主训练</span>
				<div class="searchOuter">
					<input class="form-control searchCon" maxlength="30" />
					<img class="searchImg" src="../../images/ostp/search.png" />
				</div>
				
				<div class="select1">
					<select class="form-control subjectList">
						<option value="" selected="selected">全部学科</option>
					</select>
				</div>
			</div>

			<div class="fileOuter clearfix">

			</div>

			<div class="fenyeCon">
				<ul class="pagination" id="pagination1"></ul>
			</div>

		</div>

	</body>
	
	<script>
		function clickfind(e) {
			if (e.keyCode==13) {
				tofind(1);
			}					
		};	
		$('.searchImg').click(function(){
			tofind(1);
		});

		function fenye(allcount,page){//分页的方法
			var totalPages =  Math.ceil(allcount/8);
			var searchCon = $.trim($('.searchCon').val());
			$.jqPaginator('#pagination1', {//分页
		        totalPages:totalPages,
	            visiblePages: 10,
	            currentPage: page,
	            first: '<li class="first"><a href="javascript:void(0);">首页</a></li>',
	            prev: '<li class="prev"><a href="javascript:void(0);"><i class="_arrow arrow2"></i>上一页</a></li>',
	            next: '<li class="next"><a href="javascript:void(0);">下一页<i class="_arrow arrow3"></i></a></li>',
	            last: '<li class="last"><a href="javascript:void(0);">末页</a></li>',
	            page: '<li class="page"><a href="javascript:void(0);">{{page}}</a></li>',
		        onPageChange: function (num, type) {
		        	if(type == 'change'){
		        		if(searchCon==''){
		        			getdatalist(num);//如果没有搜索条件，查询所有的列表
		        		}else{
		        			tofind(num);//如果有搜索条件，根据查询列表
		        		}
		        	}  
		        }
		    });
		}

		function tofind(page) {
			$('.subjectItem').removeClass('active');
			$('.subjectItem').eq(0).addClass('active');					
			
			if ($.trim($('.searchCon').val())=='') {
				uselayer(3,'搜索内容不能为空');
				return false;
			}
			Api.R({
				url: "/learn/querylearninfo",
				isShade: 1,
				json: {
					"1": {
						command: "learn/querylearninfo",
						type: 0,
						sessionid: getCookie('gy_t'),
						uid: getCookie('gy_u'),
						loginid: getCookie('gy_u'),
						learnname:$.trim($('.searchCon').val()),
						page: page,
						reqnum: 8
					}
				},
				fn: function(result) {
					if(result["1"].errcode != 0){
						uselayer(3, result["1"].errdesc);
						return;
					}
					writedatalist(result["1"].learnids, page,result["1"].allcount);
				}
			});					
		};				
		
		
		function getdatalist(page) {
			var dicipid = $(".subjectList").val() ?  $(".subjectList").val() : null;
			var json = {
				"1": {
					command: "learn/querylearninfo",
					type: 0,
					sessionid: getCookie('gy_t'),
					uid: getCookie('gy_u'),
					loginid: getCookie('gy_u'),
					page: page,
					reqnum: 8
				}
			};
			if( $(".subjectList").val() ){
				json[1].disciplineid = dicipid;
			}
			Api.R({
				url: "/learn/querylearninfo",
				isShade: 1,
				json:json,
				fn: function(result) {
					if(result["1"].errcode != 0){
						uselayer(3, result["1"].errdesc);
						return;
					}
					writedatalist(result["1"].learnids, page,result["1"].allcount);
				}
			});		
		};
		
		function writedatalist(array,page,allcount) {
			var learnids = array;
			if (learnids.length==0) {
				$('.fileOuter').html('<p class="no-data">暂无可训练的项目</p>');
				$('.fenyeCon').css('display', 'none');
				return false;
			}
			
			$('.fileOuter').html('');
			for (var i = 0 ; i < learnids.length; i++) {
				var str = 
					'<a href="my-work-detail.html?train='+learnids[i].learnid+'" class="fileCon clearfix" target="_blank">'
						+'<div class="filePic">'
							+'<img src="'+Api.url+'/'+learnids[i].thum+'" />'
						+'</div>'
						+'<div class="fileName">'+learnids[i].name+'</div>'
						+'<div class="fileBottom clearfix">'
							+'<div class="headIcon"></div>'
							+'<div class="count"></div>'
							+'<div class="fileType">'+learnids[i].discipname+'</div>'
						+'</div>'
					+'</a>';						
				$('.fileOuter').append(str);
				
			}
			
			$('.fileCon').click(function () {
				if (window.navigator.userAgent.toLowerCase().indexOf('chrome')!=-1) {
					uselayer(1,'请使用IE10以上、Firefox或者Opera内核的浏览器打开');
					return false;
				}						
			});
			fenye(allcount,page);//生成分页
		};

	
		window.onload = function () {
			'use strict';
			common();
			setCookie('gy_n',decodeURIComponent(getCookie('gy_n')));
			Api.R({
				url: "/discipline/querylist",
				isShade: 1,
				json: {
					"1": {
						command: "discipline/querylist",
						sessionid: getCookie('gy_t'),
						uid: getCookie('gy_u'),
						loginid: getCookie('gy_u')
					}
				},
				fn: function(result) {
					if(result["1"].errcode != 0){
						uselayer(3, result["1"].errdesc);
						return;
					}
					var arr = result["1"].discresult;
					console.log(arr);
					for (var i = 0 ; i < arr.length; i++) {
						var str = '<option value="'+arr[i].discid+'">'+arr[i].name+'</option>';
						$('.subjectList').append(str);				
					}
					$('.subjectList').change(function () {//按照学科筛选
						getdatalist(1);
					});
					getdatalist(1);	
				}
			});

			$('.searchCon').focus(function () {
				$(document).on('keyup',clickfind);
			});				
			$('.searchCon').blur(function () {
				$(document).off('keyup',clickfind);
			});
			
		};						
	</script>
	
</html>
