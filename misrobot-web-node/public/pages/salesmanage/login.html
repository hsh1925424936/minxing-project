<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/salesmanage/layout.js" ></script>
		<meta charset="UTF-8">
		<title>登录</title>
		<style>
			body{
				height:100%;
			}
			#vue_control{
				width:100%; height:100%; position:relative; background-color:#ECECEC;
				min-height:450px;
			}
			.logincon,.setnewpwd{
				width:360px; height:329px; left:50%; margin-left:-180px;
				top:40%; margin-top:-164.5px; position:absolute;
				border-radius:5px; background-color:white;
				box-shadow:0px 0px 10px 0px rgba(0, 0, 0, 0.5);
				padding-left:40px; padding-right:40px;
			}
			#vue_control>h3{
				position:absolute; bottom:60px; font-size:21px; color:#333333;
				text-align:center; width:100%;
			}
			.logoimg{
				display:block; width:158px; height:41px; margin:auto;
				margin-top:32px; margin-bottom:20px;
			}
			.inputcon{
				margin-bottom:10px; height:46px; border:1px solid #cccccc;
				border-radius:7px; position:relative; overflow:hidden;
			}
			.inputcon input{
				display:block; width:235px; height:100%;
				padding-left:20px; position:absolute; left:0; top:0;
				font-size:14px;
			}
			.inputcon img{
				display:block; float:right; width:44px; height:44px;
			}
			.inputcon2{
				margin-bottom:20px; height:19px;
			}
			.user-defined-checkbox{
				float:left;
			}
			.inputcon2>label{
				display:block; float:left; line-height:17px;
				margin-left:5px;
			}

			.loginbtn,.newpwdbtn{
				width:100%; height:46px; line-height:46px;
				border-radius:5px; background-color:#2088ca;
				color:#ffffff; font-size:18px; margin-bottom:40px;
				cursor:pointer;
			}

			/*重设密码框*/
			.setnewpwd>h3{
				margin-top:30px; font-size:18px; color:rgb(51,51,51);
			}
			.myusername{
				margin-top:40px; font-size:16px; color:rgb(51,51,51);
				margin-bottom:8px;
			}
			.setnewpwd input{
				width:100%; height:56px; display:block; border-bottom:1px solid #CCCFDA;
			}
			.setnewpwd>.newpwdbtn{
				margin-top:20px;
			}

		</style>	
	</head>
	<body>
		<div id="vue_control" v-cloak>
			<div class="logincon" v-show="!iseditpwd">
				<img src="../../images/salesmanage/logo2.png" class="logoimg" />
				<div class="inputcon">
					<input type="text" placeholder="账号" v-model.trim="username"/>
					<img src="../../images/salesmanage/user.png" />
				</div>
				<div class="inputcon">
					<input type="password" placeholder="密码" v-model.trim="password"/>
					<img src="../../images/salesmanage/password.png" />
				</div>
				<div class="inputcon2 clearfix">
					<div class="user-defined-checkbox">
						<input type="checkbox" v-model.trim="remember" id='isremember'>
					</div>
					<label for="isremember">记住密码</label>
				</div>
				<button class="loginbtn" @click="login()">登录</button>
			</div>
			<h3>敏行营销管理后台</h3>

			<div class="setnewpwd" v-show="iseditpwd">
				<h3>首次登陆，请重设置您的新密码！</h3>
				<p class="myusername">{{username}}</p>
				<input type="password" placeholder="新密码" v-model.trim="newpwd"/>
				<input type="password" placeholder="确认密码"  v-model.trim="confirmnewpwd"/>
				<button class="newpwdbtn" @click="changepwd">确定</button>
			</div>

		</div>
	</body>

	<script type="text/javascript">
		var vm=new Vue({
			el:"#vue_control",
			data:{
				username:localStorage.salesusername,//用户名
				password:localStorage.salespassword,
				remember:localStorage.remember || false,
				iseditpwd:false,//是否弹出修改密码框
				/*新密码和确认新密码*/
				newpwd:'',
				confirmnewpwd:''
			},
			methods:{
				login:function(){
					var self = this;
					if( !this.username ){
						layer.msg('请输入用户名！');
						return false;
					}
					if( !this.password ){
						layer.msg('请输入密码！');
						return false;
					}
					my_require.R({
						isShade:1,
						url:'/mismarketing/loginmismarketingadminuser',
						data:{
							command:"mismarketing/loginmismarketingadminuser",
							loginname:this.username,//用户名
							pwd:this.password,
							type:0
						},
						callback:function(base){//登录成功
							localStorage.salesusername = self.username;
							if( self.remember ){//记住密码
								localStorage.salespassword = self.password;
								localStorage.remember = true;
							}else{
								localStorage.removeItem('salespassword');
								localStorage.removeItem('remember');
							}

							setCookie('username',strtocode(base.username),7);//用户姓名
							setCookie('userid',base.userid,7);
							if( base.isfirst == "是" || !base.logintime || base.logintime == '' ){
								self.iseditpwd = true;
							}else{
								location.href = 'index.html';
							}
							
						}
					});
					
				},
				changepwd:function(){//提交修改密码
					var self = this;
					if( !this.newpwd ){
						layer.msg('请输入新密码！');
						return false;
					}
					if( !this.confirmnewpwd ){
						layer.msg('请输入确认密码！');
						return false;
					}
					if( this.newpwd != this.confirmnewpwd ){
						layer.msg('密码不一致请重新填写！');
						this.newpwd = this.confirmnewpwd = '';
						return false;
					}
					var _data = {
						command:"mismarketing/updateadmininfo",
						isupdate:'2',
						userid:getCookie('userid'),
						pwd:this.newpwd
					};
					my_require.R({
						isShade:1,
						url:'/mismarketing/updateinfo',
						data:_data,
						callback:function(base){
							layer.msg('修改密码成功，请重新登录！');
							self.iseditpwd = false;//重新登录
							self.password = '';
						}
					});

				}
			},

			created:function(){
				
			},
			mounted:function(){
				var self = this;
				my_checkbox_change();
				$(document).on('keyup',function (e) {
					if (e.keyCode==13) {
						self.login();
					}						
				});
			},
			updated:function(){
				my_checkbox_change();
			},
			watch:{
			}
		})
	</script>
</html>