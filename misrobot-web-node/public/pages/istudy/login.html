<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="../../js/istudy/layout.js" ></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>登录</title>
    <style type="text/css">
        html,body{
            background-color:#0495CA;
            font-family: "microsoft yahei";
        }
        .box{
            overflow:hidden;
        }
        .outer{
            width:100%; height:100%; overflow:hidden; background: none;
        }
        .engTxt{
            width:142px; height:48px; display:block; margin:0 auto;
            margin-top:135px; margin-bottom:40px;
        }
        .inpOuter{
            width:88.5%; height:43px; margin:0 auto; margin-bottom:8px;
        }
        .inpOuter input{
            height:100%; border:0px; border-radius:0px;
        }
        .submit{
            width:88.5%; height:43px; background-color:transparent;
            border:1px solid white; margin:0 auto;
            color:white; display:block; margin-top:40px;
            outline:none;
        }
        .txt{
            display: block;
            width:100%; height:18px; text-align:center; font-size:12px;
            color:white; line-height:18px; margin:0 auto; margin-top:110px;
        }
        .tip {line-height: 200px; text-align: center; color: #fff; font-size: 24px; }
        input{
            width:100%;
            text-align: center;
            outline: none;
            cursor:pointer;
        }
    </style>
</head>
<body>
    <div class="box clearfix">
        <div class="outer clearfix">
            <div class="tip">请先登录</div>
            <div class="inpOuter">
                <input  type="text" class="form-control accountname"  placeholder="请输入你的学号或者手机号" />
            </div>
            <div class="inpOuter">
                <input type="password" class="form-control password" placeholder="请输入你的密码" />
            </div>
            <button class="submit" type="button"> 登录 </button>
        </div>
    </div>
    <script>
        if (getCookie('gy_t') && getCookie('gy_u')) {
            window.location.href = "interaction.html";
        }   
        window.onload = function () {
            $('.submit').click(tologin);   
            $(document).on('keyup',function (e) {
                if (e.keyCode==13) {
                    tologin();
                }                       
            });

            function tologin() {
                if ($.trim($('.accountname').val()) =='' ) {
                    uselayer(1,'用户名不能为空');
                    return false;
                }
                if ($.trim($('.password').val()) =='' ) {
                    uselayer(1,'密码不能为空');
                    return false;
                }
            
                Api.R({ 
                    isShade:1,
                    url: "/usr/login",
                    json: {
                        "1": {
                            command: "usr/login",
                            accountname: $.trim($('.accountname').val()),
                            password: $.trim($('.password').val()),
                            type: 0
                        }
                    },
                    fn: function(result){
                        if(result["1"].errcode) {
                           uselayer(3, result["1"].errdesc);
                           return; 
                        }
                        setCookie('gy_t', result["1"].sessionid, 60);
                        setCookie('gy_u', result["1"].userid,7); //用户id

                        Api.R({
                            isShade:1,
                            url: "/usr/querymyinfo",
                            json: {
                                "1": {
                                    command: "usr/querymyinfo",
                                    uid: getCookie('gy_u'),
                                    sessionid: getCookie('gy_t')
                                }
                            },
                            fn: function(uInfo) {
                                if(uInfo["1"].errcode) {
                                   uselayer(3, uInfo["1"].errdesc);
                                   return; 
                                }
                                setCookie('gy_name', uInfo["1"].name,7);//姓名
                                setCookie('gy_unname',uInfo["1"].username,7); //用户名
                                setCookie('gy_u_imgurl', uInfo["1"].imgurl,7); // 头像
                                setCookie('gy_u_classname', uInfo["1"].clsname); // 班级
                                window.location.href = 'interaction.html';
                            },
                            error: function(str){
                                uselayer(3,'登陆失败');
                            }
                        });
                    },
                    error:function (str) {
                        uselayer(3,'登陆失败');
                    }
                });

            }
        }
    </script>
</body>
</html>