<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/istudy/layout.js" ></script>
		<meta charset="UTF-8">
		<title></title>
		<style>
			.kt-write-head {height: 30%; color: rgb(127,127,127); font-weight: normal; padding: 0 5%;  }
			.kt-write-title { height: 30%; line-height: 220%;font-size: 24px;position: relative; }
			.kt-write-head-con {padding-top: 1%; font-size: 18px; line-height: 200%; height: 70%;overflow:auto}
			.kt-write-con { min-height: 50%;}
			.kt-write-con p {text-align: center; color: #ccc; font-size: 32px;}
			.kt-write-con img { display: none; width: 80%; margin: 0 auto;}
			.kt-write-head-con p i { font-size: 14px;}
			.kt-write-con ul { display: none;}
			.kt-write-con ul li { width: 20vw; height: 20vw; margin: 2.5vw; float: left;}
			.kt-write-con ul li img { display: block; width: 100%; height: 100%;}
			.kt-write-con input,.kt-write-con div { display: none; width: 20vw; height: 20vw; margin: 2.5vw; float: left; border: none; background: url(../../img/wx_ketang-write-con.png); background-size: 100%;position: relative;}
			.kt-write-con input {position: absolute; left:0; top:0; background:red; display:block ; width:100%; height:100%; margin:0; opacity:0}
			.kt-write-foot { height: 20%; padding: 6% 0 0%; position: relative;}
			.kt-write-foot div,.uploadfile { height: 36%; line-height: 200%; text-align: center; width: 56%; display: block; margin: 0 auto; background: #687ead; border: none; border-radius: 4px; color: #fff; font-size: 18px;}
			.kt-write-foot div img { height: 18px;}
			.uploadfile {position: absolute;left:50%;background: red; top: 11%; margin-left: -28%; opacity:0}
		</style>
		<script type="text/javascript">
			window.onload = function () {
				'use strict';
				wxcommon(1);			
				$('.kt-write-con p').css('line-height',$('.kt-write-con').css('height'));
				Api.R({
					isShade: 1,
					url: "/question/queryquestioninfo",
					json: {
						"1": {
							command: "question/queryquestioninfo",
							scheduleid: getCookie("gy_istudy_scid"),
							sessionid: getCookie("gy_t"),
							loginid: getCookie('gy_u')
						}
					},
					fn: function(result) {
						if(result["1"].errcode!=0){
							uselayer(3, result["1"].errdesc);
							setTimeout(function(){
								window.history.go(-1);
							},2000);
							return;
						}
						if(!result["1"].questionresult) {
							uselayer(3,'暂无题目！');
							setTimeout(function(){
								window.history.go(-1);
							},2000);
							return;
						}
						$('.uploadfile').attr('qid', result["1"].questionresult[0].qid);
						$('.kt-write-head-con p').html(result["1"].questionresult[0].name+'<i>（请在编辑答案处填写答案或使用拍照上传答案）</i>');
						$('.uploadfile').on('change',function () {
							var obj = $(this)[0];
							Api.R({
								url: "/file/upload",
								json: {
									"1": {
										command: "file/upload",
										accountname: getCookie('gy_unname'),
										sessionid: getCookie('gy_t'),
										filename: (new Date).getTime(),
										filecontent: obj.files[0],
										loginid: getCookie('gy_u')
									}
								},
								fn: function(result){
									if(result["1"].errcode){
										uselayer(3, result["1"].errdesc);
										return;
									}
									if(!result["1"].filepath){
										uselayer(3, '上传附件失败，请重新上传！');
										return;
									}
									var oReader = new FileReader();
									oReader.onload = function(e) {
										$('.answer-img').attr('src',e.target.result);
									};
									oReader.readAsDataURL(obj.files[0]);
									Api.R({
										url: "/question/submitanswer",
										json: {
											"1": {
												scheduleid: getCookie('gy_istudy_scid'),
												uid: getCookie('gy_u'),
												sessionid: getCookie('gy_t'),
												qid: $('.uploadfile').attr('qid'),
												answerimg: result["1"].filepath,
												loginid: getCookie('gy_u')
											}
										},
										fn: function(res) {
											if(res["1"].errcode){
												uselayer(3, res["1"].errdesc);
												return;
											}
											$('.uploadfile,.answer-show,.kt-write-con p').css('display','none');
											$('.answer-com,.kt-write-con img').css('display','block')
											uselayer(1, '提交成功！',function () {
												if (!result["1"].errcode) {
													window.location.href="startstu.html";
												}
											});	
										},
										error: function(str) {
											uselayer(3, '上传附件失败，请重新上传！');
										}
									});
								},
								error: function(str){
									uselayer(3, '上传附件失败，请重新上传！');
								}
							});
						});
					}
				});
				$('.kt-write-foot div').eq(1).click(function () {
					window.location.href = 'startstu.html';
				});
		
			};	
		</script>
		
		
	</head>
	<body>
		<div class="sign_bg"></div>
		<div id="header">
			<headerbox thistitle="上传答案"></headerbox>
		</div>
		<h4 class="kt-write-head">
			<div class="kt-write-title">查看问题</div>
			<div class="kt-write-head-con">
				<p></p>
				<div></div>
			</div>
		</h4>
		
		<div class="kt-write-con">
			<p>暂未上传答案</p>
				
			<img class="answer-img" />
			
			
		</div>
		
		
		<div class="kt-write-foot">
			<div class="answer-show">
				<img src="../../images/istudy/wx_ketang-write-foot.png" />
				<span>拍照答题</span>
			</div>
			<div style="margin-top: 4%;display: none" class="answer-com">
				<span>答题完成</span>
			</div>
			<input type="file" accept="image/*" capture="camera" class="uploadfile">
		</div>


		<script src="../../js/istudy/vueComponent.js"></script>
	</body>
</html>
