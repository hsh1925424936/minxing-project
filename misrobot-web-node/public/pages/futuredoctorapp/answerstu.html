<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/futuredoctorapp/layout.js" ></script>
		<meta charset="UTF-8">
		<title></title>
		<style>
			.kt-answer-con {height: 60%; background: url(../../images/futuredoctorapp/dianwo.png) no-repeat center; background-size: 60%;}
			.kt-answer-tip,.kt-answer-info { font-weight: bold; height: 20%; font-size: 24px; text-align: center; line-height: 300%; padding-top: 10%;}
			.kt-answer-info {display: none; color: #cd3301;}
			.sign_bg { display: block;}
			.kt-answer-time { position: fixed; left: 0; top: 0; z-index: 99; width: 100%; height: 100%; color: #fff; font-size: 150px; text-align: center;}
		</style>	
	</head>
	<body>
		<div class="sign_bg"></div>
		<div id="vmcontainer" v-cloak="">
			<headerbox :thistitle="headerTitle" :showback="showback" :showreload="showreload" :titlenum="titlenum" id="header"></headerbox>
		</div>
		<div class="kt-answer-time"></div>
		<div class="kt-answer-con"></div>
		<div class="kt-answer-tip">点击屏幕，抢答啦~</div>
		<div class="kt-answer-info">
			<p></p>
			<p></p>
		</div>
		<audio src = '../../images/futuredoctorapp/yaoyiyao.mp3' id="yaoyiyao" style="display: none" ></audio>
		<script src="../../js/futuredoctorapp/vueComponent.js"></script>
		<script type="text/javascript">
			registerToNative('goBack', function (data) {
				window.location.href='startstu.html'
			});
			var vm=new Vue({
				el:'#vmcontainer',
				data:{
					headerTitle:'抢答',
					showback:true,
					showreload:false,
					titlenum:0,
					//以上是头部配置
				}
			});
			function goBack(){
				window.location.href="startstu.html";
			};
			var questionid="";
			var bShake = true;
			var SHAKE_THRESHOLD = 3000;
      var last_update = 0;
      var x = y = z = last_x = last_y = last_z = 0;
			init();
      function init() {
        if (window.DeviceMotionEvent) {
          window.addEventListener('devicemotion', deviceMotionHandler, false);
        } else {
          alert('抱歉，您的设备不支持摇一摇功能');
        }
      }
	    function deviceMotionHandler(eventData) {
       	var acceleration = eventData.accelerationIncludingGravity;
        var curTime = new Date().getTime();
        if ((curTime - last_update) > 100) {
          var diffTime = curTime - last_update;
          last_update = curTime;
          x = acceleration.x;
          y = acceleration.y;
          z = acceleration.z;
          var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
          if (speed > SHAKE_THRESHOLD) {
          	if (!bShake) {
          		bShake=true;
          		toshake();
          	}
          }
          last_x = x;
          last_y = y;
          last_z = z;
        }
      }
			window.onload = function () {
				'use strict';
				wxcommon(1);
				$('.kt-answer-time ').css({'line-height': $('.kt-answer-time').css('height')});
				(function(){
					var data={
						command: "question/hasraceanswer",
						scheduleid: getCookie('gy_istudy_scid'),
						sessionid: getCookie('sid'),
						loginid: getCookie('uid')
					};
					function callback(result){
						questionid=result.qid;
						var oTime = document.getElementsByClassName('kt-answer-time')[0];
						oTime.style.display = 'none';
						document.getElementsByClassName('sign_bg')[0].style.display = 'none';
						bShake = false;
						$('.kt-answer-con').on('click',toshake);
					};
					post("/question/hasraceanswer",data,callback,errcodefn,errfn)
				})();
			function toshake() {
				document.getElementById('yaoyiyao').play();
				var data={
					command: "question/raceanswer",
					sessionid: getCookie('sid'),
					scheduleid: getCookie('gy_istudy_scid'),
					loginid: getCookie('uid'),
					uid:getCookie('uid'),
					qid:questionid
				};
				function callback(result){
					var message = result.errcode==0 ? '恭喜你抢到答题权限！' : '抢答题目失败！';
					var oTip = $('.kt-answer-tip')[0];
					var oInfo = $('.kt-answer-info')[0];
					var aP = oInfo.getElementsByTagName('p');
					oTip.style.display = 'none';
					oInfo.style.display = 'block';
					aP[0].innerHTML = '';
					aP[1].innerHTML = message;
					setTimeout(function () {
						window.history.go(-1);
					},2000);
				};
				post("/question/raceanswer",data,callback,errcodefn,errfn)
			}
			};
		</script>
	</body>
</html>



