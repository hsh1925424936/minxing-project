<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/iteach/layout.js" ></script>
		<meta charset="UTF-8">
		<title>老师个人信息</title>
		<style type="text/css">

			.infoOuter{
				width:100%;
			}

			.infoCon{
				width:100%; height:50px; padding:5px;
				font-size:15px; padding-left:15px; padding-right:15px;
				border-bottom:1px solid #F2F2F4;
				position: relative; position:relative;
			}
			.infoCon div{
				height:100%; font-size:14px;
				float:left; line-height:40px;
			}
			.infoCon span{
				width:20px; height:100%; float:left; background-image:url('../../images/iteach/goon.png');
				background-repeat:no-repeat; background-size:100% 50%;
				background-position:50% 50%; position:absolute; right:10px;
			}
			.item{
				width:30%;
				text-align:left; color:#8E8E8E;
			}
			.con{
				width:65%;
				text-align:right; color:#D0D0D2;
			}
			.con input{
				height:100%; border:0px; text-align:right;
			}
			.headImg,.headImg_file{
				width:40px; height:40px; float:right; display:block;
			}
			.headImg_file {
				position: absolute; right: 15px; top: 5px; outline: none; opacity: 0;
				
			}
			.save{
				width:90.62%; height:45px; color:white;
				margin:30px auto; background-color:#0495CA; font-size:16px;
				display:block;
			}
			
			.line{
				width:100%; height:5px; background-color:#EEF3FA;
			}
		</style>
		<script>
			window.onload = function () {
				'use strict';
				webcommon();		
				
				Api.R({
					url: "/usr/querymyinfo",
					isShade:1,
					json:{
						"1": {
							command: "usr/querymyinfo",
							uid: getCookie('gy_u'),
							sessionid: getCookie('gy_t')
						}
					},					
					fn:function (base) {
						if(base["1"].errcode){
							uselayer(3, base["1"].errdesc);
							return;
						}
						var json = base["1"];

						$('.headImg').attr('src',json.imgurl?json.imgurl:'../../images/iteach/feifei.png');
						$('.name').html(json.name);
						$('.sex').html(json.sex==0?'女':'男');
						$('.card_num').html(json.card_num);
						$('.mobile').val(json.mobile);
						$('.email').val(json.email);
						$('.rolename').html(json.levelname);
						$('.code').html(json.username);
						$('.deptname').html(json.deptname);
					}
				});
				
				$('.headImg_file').on('change',function () {
					Api.R({
						url: "/file/upload",
						isShade: 1,
						json: {
							"1": {
								command: "file/upload",
								accountname: getCookie('gy_un'),
								sessionid: getCookie('gy_t'),
								filename: (new Date()).getTime(),
								filecontent: $(this)[0].files[0]
							}
						},
						fn: function(result) {
							if(result["1"].errcode){
								uselayer(3, result["1"].errdesc);
								return;
							}
							$('.headImg').attr('src', '/'+ result["1"].filepath);
							uselayer(1,"上传成功！");
						}
					})						
				});				
				
				
				$('.save').click(function () {
					var reg=/^1[3-578]\d{9}$/;
					if(!reg.test($.trim($('.mobile').val()))){
						uselayer(3,'请输入正确的手机号');
						return false;
					}					
					var re = /^\w{3,18}@[a-z0-9\-]+(\.[a-z]{2,6}){1,2}$/i;
					if(!re.test($.trim($(".email").val()))){
						uselayer(3,'请输入正确的邮箱地址');
//						return false;
					}					
					Api.changeUserInfo({
						isShade:1,
						isrepeat:$(this),
						json:{
							imageurl:$('.headImg').attr('src'),
							mobile:$.trim($('.mobile').val()),
							email:$.trim($('.email').val())
						},
						fn:function (json) {
							uselayer(3,json.message);
						}
					});			
				});
				

				
			};
		</script>
	</head>
	<body>
		
		<div class="box clearfix">
			<div class="outer clearfix">
				<div class="topOuter">
					<div class="return1">
						
					</div>
					<div class="topTxt">
						个人资料
					</div>
				</div>

				<div class="infoOuter">
					<div class="infoCon clearfix">
						<div class="item">
							头像
						</div>
						<img class="headImg" />
						<input type="file" accept="image/*" class="headImg_file">
					</div>

					<div class="infoCon">
						<div class="item">
							姓名
						</div>
						<div class="con name">
							
						</div>
					</div>

					<div class="infoCon">
						<div class="item">
							性别
						</div>
						<div class="con sex">
							
						</div>
					</div>

					<div class="infoCon">
						<div class="item">
							证件号
						</div>
						<div class="con card_num">
							
						</div>
					</div>

					<div class="infoCon">
						<div class="item">
							手机号
						</div>
						<div class="con">
							<input class="form-control mobile" />
						</div>
						<span></span>
					</div>

					<div class="infoCon">
						<div class="item">
							邮箱
						</div>
						<div class="con">
							<input class="form-control email" / >
						</div>
						<span></span>
					</div>
					
					<div class="line">

					</div>

					<div class="infoCon">
						<div class="item">
							职称
						</div>
						<div class="con rolename">
							
						</div>
					</div>

					<div class="infoCon">
						<div class="item">
							工号
						</div>
						<div class="con code">
							
						</div>
					</div>

					<div class="infoCon">
						<div class="item">
							部门
						</div>
						<div class="con deptname">
							
						</div>
					</div>

				</div>

				<button type="button" class="save">保存</button>

			</div>

		</div>

	</body>
	
</html>
