<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/iteach/layout.js" ></script>
		<meta charset="UTF-8">
		<title>老师通知</title>
		<style type="text/css">
			.box{
				 padding-bottom:50px;
			}
			.outer {height: 100%}
			.navigateOuter{
				width:188px; height:28px; margin:14px auto; 
				border:1px solid #BDDFEB;
				font-size:12px; line-height:28px; border-radius:5px;
			}
			.navigate{
				width:50%; height:100%; float:left; text-align:center;
				cursor:pointer;
			}

			.navigateOn{
				background-color:#0495CA; color:white;
			}


			.msgCon,.msgCon:hover,.msgCon:active,.msgCon:visited{
				text-decoration: none;
				color:#D4D4D6; margin-bottom:20px; 
				margin-left:10px; margin-right:10px; position:relative;
				display: block;
			}
			.deleteBtn{
				position:absolute; width:75px; height:100%; 
				background-color:#F35937; font-size:16px;
				color:white; line-height:54px; text-align:center;
				right:0px; top:0px; display:none;
			}
			.msgTitOuter{
				width:100%;
			}
			.msgTit{
				width:65%; height:35px; line-height:35px; float:left;
				font-size:15px;
			}
			.msgTit span{
			    display: inline-block;
			    width: 10px;
			    height: 10px;
			    background: #000;
			    margin-right:8px;
			    display: none;
			    background: orangered;
			    border-radius: 50%;
			}
			

			.msgOuter .unread .msgTit{
				color:black;
			}
			.msgOuter .unread .msgTit span{
				display: inline-block;
			}

			.time{
				width:35%; height:35px; line-height:35px; float:right;
				font-size:9px;
			}
			.msgTxt{
				width:100%; line-height:18px; font-size:9px;
			}
			

			.wrapper { position: relative; overflow: hidden; height: 90%; }
			.scroller { position: absolute; left: 0; top: 0; width: 100%; padding: 0 25px;}
			#scroller {
				-webkit-tap-highlight-color: rgba(0,0,0,0);
				-webkit-transform: translateZ(0);
				-moz-transform: translateZ(0);
				-ms-transform: translateZ(0);
				-o-transform: translateZ(0);
				transform: translateZ(0);
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
				-webkit-text-size-adjust: none;
				-moz-text-size-adjust: none;
				-ms-text-size-adjust: none;
				-o-text-size-adjust: none;
				text-size-adjust: none;
			}
			
			#scroller-pullDown,#scroller-pullUp {
			    background: #fff;
			    height: 40px;
			    line-height: 40px;
			    padding: 5px 10px;
			    font-weight: bold;
			    font-size: 14px;
			    color: #888;
				text-align:center;
				position:absolute;
				left:0px;
				width:100%;
			}
			#scroller-pullDown{
				top:-40px;
			}
			#scroller-pullUp{
				bottom:-40px;
			}
			
			#scroller-pullDown .pull-up-msg,#scroller-pullUp .pull-down-msg {
				padding-left:20px;
			}
			
			#scroller-pullDown .pull-down-icon,#scroller-pullUp .pull-up-icon{
				display:inline-block;
				color:#f00;
				font-size:1.4;
				-webkit-transform:rotate(0deg);
				-webkit-transition-property: -webkit-transform;
				-webkit-transition-duration: 500ms;
			}
			#scroller-pullDown .pull-down-icon.reverse_icon,#scroller-pullUp .pull-up-icon.reverse_icon{
				-webkit-transform: rotate(-180deg);
			}

		</style>
		<script>
			//$('.bootstrap').remove();
		</script>
		<script src="../../js/iteach/iscroll.js"></script>
	</head>
	<body>
		
		<div class="box clearfix">
			<div class="outer clearfix">
				<div class="topOuter">
					<div class="topTxt">
						通知
					</div>
				</div>

				<div class="navigateOuter">
					<div class="navigate navigateOn">
						全部
					</div>
					<div class="navigate">
						未读
					</div>
				</div>

				<!-- <div class="msgOuter"></div> -->


				<div id="wrapper" class="wrapper">
					<div id="scroller">
						<div id = "scroller-pullDown">
							<span id = "down-icon" class = "glyphicon glyphicon-chevron-up pull-down-icon"></span>
							<span id = "pullDown-msg" class = "pull-down-msg">刷新</span>
						</div>
						<div>
							<div id="news-list" class="msgOuter">



								
							</div>
						</div>
						<div id = "scroller-pullUp">
							<span id = "up-icon" class = "glyphicon glyphicon-chevron-down pull-up-icon"></span>
							<span id = "pullUp-msg" class = "pull-up-msg">上拉加载更多</span>
						</div>
					</div>
				</div>


				<div class="bottomOuter">
					<a href="schedule.html" class="bottomItem clearfix">
						<img src="../../images/iteach/kebiao.png"/>
						<span>课表</span>
					</a>

					<a href="report.html" class="bottomItem clearfix">
						<img src="../../images/iteach/baogao.png"/>
						<span>报告</span>
					</a>

					<a href="message-list.html" class="bottomItem clearfix">
						<img src="../../images/iteach/messageon.png"/>
						<span class="bottomItemOn">通知</span>
					</a>

					<a href="person-center.html" class="bottomItem clearfix">
						<img src="../../images/iteach/head2.png"/>
						<span>我</span>
					</a>
				</div>

			</div>

		</div>

	</body>
	<script src="../../js/iteach/jquery.touchSwipe.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
//		window.ontouchstart = function(e) { e.preventDefault(); };
	var myScroll;
	window.onload = function () {
		'use strict';
		webcommon();			
		$('.navigate').click(function() {
			
			changepage($(this).index())

			$('.navigate').removeClass('navigateOn');
			$(this).addClass('navigateOn');
			$('.msgOuter').html('');
			getmsglist(1);
		});		

		if (window.location.href.indexOf('#')==-1) {
			$('.navigate').eq(0).click();
		} else {
			var _href = window.location.href;
			_href = _href.substring(_href.indexOf('#')+1,_href.length);
			$('.navigate').eq(_href).click();
		}

		function showmobile() {
			var upIcon = $("#up-icon"),
					downIcon = $("#down-icon");
					
			myScroll = new IScroll('#wrapper', {
				preventDefault:false,
				probeType: 3, 
				mouseWheel: true 
			});
				
			myScroll.on("scroll",function(){
				var y = this.y,
					maxY = this.maxScrollY - y,
					downHasClass = downIcon.hasClass("reverse_icon"),
					upHasClass = upIcon.hasClass("reverse_icon");
				
				if(y >= 40){
					!downHasClass && downIcon.addClass("reverse_icon");
					return "";
				}else if(y < 40 && y > 0){
					downHasClass && downIcon.removeClass("reverse_icon");
					return "";
				}
				
				if(maxY >= 40){
					!upHasClass && upIcon.addClass("reverse_icon");
					return "";
				}else if(maxY < 40 && maxY >=0){
					upHasClass && upIcon.removeClass("reverse_icon");
					return "";
				}
			});
				
			myScroll.on("slideDown",function(){
				if(this.y > 40){
					//触发下拉方法
					// alert(2);
					window.location.reload();
					upIcon.removeClass("reverse_icon");
				}
			});
				
			myScroll.on("slideUp",function(){
				if(this.maxScrollY - this.y > 40){
					//触发上拉加载更多
					// alert(1);
					var msgConLen = $('.msgCon').length;
					var page = Math.ceil(msgConLen/6);
					getmsglist(page);
					upIcon.removeClass("reverse_icon");
				}
			});				
		};

		var bShow = false;

	function getmsglist(page) {			
		Api.R({
			url: "/note/notelist",
			isShade:1,
			json:{
				"1": {
					command: "note/notelist",
					page: page,
					uid: getCookie('gy_u'),
					sessionid: getCookie('gy_t'),
					pagecount:6
				}
			},
			fn:function (json){
				json = json["1"];
				if (json.notelist.length==0) {
					uselayer(3,'没有数据！');
					return false;
				}
				var arr = json.notelist;
				if( arr.length < 6 ){//如果列表小于六条就隐藏‘上拉加载更多’
					$('#scroller-pullUp').css('display', 'none');
				}else{
					$('#scroller-pullUp').css('display', 'block');
				}
				//$('.msgOuter').html('');
				for (var i = 0 ; i < arr.length; i++) {
					
					var str = 
						'<div class="msgCon clearfix '+(arr[i].notestatus==0?'unread':'')+'" _id="'+arr[i].noteid+'">'
							+'<div class="msgTitOuter clearfix">'
								+'<div class="msgTit"><span></span>'+arr[i].notetitle+'</div>'
								+'<div class="time">'+timetodate(arr[i].notetime)+'</div>'
							+'</div>'
							+'<div class="msgTxt">'+arr[i].notecontent+'</div>'
							+'<div class="deleteBtn">删除</div>'
						+'</div>';							
					$('.msgOuter').append(str);																								
				}
				
				$('.msgOuter .msgCon').swipe({
					swipeLeft:function () { //swipeLeft左滑
						$(this).find('.deleteBtn').css('display','block');
					},
					swipeRight:function () { //
						$(this).find('.deleteBtn').css('display','none');
					},
					click:function () {
						window.location.href = 'message-detail.html?msg='+$(this).attr('_id');
					},
					excludedElements:$('.deleteBtn')
					  
				});							
				$('.deleteBtn').click(function () {
					var $parent = $(this).parent();
					Api.R({
						url: "/note/notedel"
						isShade:1,
						json:{
							"1": {
								command: "note/notedel",
								uid: getCookie('gy_u'),
								sessionid: getCookie('gy_t'),
								noteids: $($parent).attr('_id')
							}
						},
						fn:function (json) {
							if(json["1"].errcode){
								uselayer(3, json["1"].errdesc);
								return;
							}
							uselayer(3, '删除成功！');
							$($parent).remove();							
						}
					});
				});
				if (!bShow) {
					bShow = true;
					showmobile();
				}
			}
		});				
	};
};
</script>
</html>
