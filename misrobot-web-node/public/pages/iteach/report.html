<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../js/iteach/layout.js" ></script>
		<meta charset="UTF-8">
		<title>报告</title>
		<style type="text/css">
			body{
				background-color:#EFF3F6;
			}
			.box{
				 padding-bottom:50px;
				 background: #fff;
			}
			.outer{
				width:100%; height: 100%;
			}

			.reportOuter{
				width:100%; background-color:white;
				padding-left:15px; padding-right:15px;
			}
			.reportCon{
				width:100%; border-bottom:1px solid #F1EEF5; display: block;
				padding:10px;
			}
			.reportImg{
				width:34px; height:40px; float:left;
				background-size:100% 100%; background-repeat:no-repeat;
			}
			.beforeLessonImg{
				background-image:url('../../image/iteach/beforeLesson.png');
			}
			.onLessonImg{
				background-image:url('../../image/iteach/onlesson.png');
			}
			.reportBox{
				width:210px; float:left; margin-left:15px;
			}
			.tit{
				width:100%; font-size:15px; color:rgb(127,127,127); line-height:24px;
			}
			.time{
				width:100%; font-size:12px; color:rgb(199,199,204); line-height:16px;
			}
			@media only screen and (min-width:480px ) {
				.wrapper a { padding:0 6% 0 20%;}
			}	
				
			.wrapper { position: relative; overflow: hidden; height: 100%; }
			.scroller { position: absolute; left: 0; top: 0; width: 100%; padding: 0 25px;}
			#scroller {
				-webkit-tap-highlight-color: rgba(0,0,0,0);
				-webkit-transform: translateZ(0);
				-moz-transform: translateZ(0);
				-ms-transform: translateZ(0);
				-o-transform: translateZ(0);
				transform: translateZ(0);
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
				-webkit-text-size-adjust: none;
				-moz-text-size-adjust: none;
				-ms-text-size-adjust: none;
				-o-text-size-adjust: none;
				text-size-adjust: none;
			}
			
			#scroller-pullDown,#scroller-pullUp {
			    background: #fff;
			    height: 40px;
			    line-height: 40px;
			    padding: 5px 10px;
			    font-weight: bold;
			    font-size: 14px;
			    color: #888;
				text-align:center;
				position:absolute;
				left:0px;
				width:100%;
			}
			#scroller-pullDown{
				top:-40px;
			}
			#scroller-pullUp{
				bottom:-40px;
			}
			
			#scroller-pullDown .pull-up-msg,#scroller-pullUp .pull-down-msg {
				padding-left:20px;
			}
			
			#scroller-pullDown .pull-down-icon,#scroller-pullUp .pull-up-icon{
				display:inline-block;
				color:#f00;
				font-size:1.4;
				-webkit-transform:rotate(0deg);
				-webkit-transition-property: -webkit-transform;
				-webkit-transition-duration: 500ms;
			}
			#scroller-pullDown .pull-down-icon.reverse_icon,#scroller-pullUp .pull-up-icon.reverse_icon{
				-webkit-transform: rotate(-180deg);
			}

		</style>
		<script src="../../js/iteach/iscroll.js"></script>
		<script>
			var myScroll;
			window.onload = function () {
				'use strict';
				webcommon();					
				
				if (findurl('u')!='') {
					setCookie('gy_un',findurl('u'),7);
				}
				
				Api.R({
					url: "/report/queryreportlist",
					isShade:1,
					json:{
						"1": {
							command:'report/queryreportlist',
							accountname:getCookie('gy_un'),
							sessionid: getCookie('gy_t'),

						}
					},
					fn:function (base) {
						base = base[1];
						console.log(base);
						if (base.errcode) {
							uselayer(1,base.errdesc);
							return false;
						}
						var arr = base.queryresult;
						
//						$('.reportOuter').html('');
						
						for (var i = 0 ; i < arr.length; i++) {
							var str = 
								'<a href="'+(arr[i].reporttype=='课前'?'pre-course-report-finish':'on-course-report')+'.html?report='+arr[i].reportid+'" class="reportCon clearfix">'
									+'<div class="reportImg '+(arr[i].reporttype=='课前'?'beforeLessonImg':'onLessonImg')+'"></div>'
									+'<div class="reportBox clearfix">'
										+'<div class="tit">'+arr[i].coursename+arr[i].reporttype+'报告</div>'
										+'<div class="time">'+(arr[i].coursebegintime).substr(0, 16)+'-'+(arr[i].courseendtime).substr(11, 5)+'</div>'
									+'</div>'
								+'</a>';							
							$('.reportOuter').append(str);
						}
						
						showmobile();
						
						
					}
					
				})
				
				
				function showmobile() {
					var upIcon = $("#up-icon"),
						downIcon = $("#down-icon");
						
					myScroll = new IScroll('#wrapper', {
							preventDefault:false,
							probeType: 3, 
							mouseWheel: true 
						});
					
					myScroll.on("scroll",function(){
						var y = this.y,
							maxY = this.maxScrollY - y,
							downHasClass = downIcon.hasClass("reverse_icon"),
							upHasClass = upIcon.hasClass("reverse_icon");
						
						if(y >= 40){
							!downHasClass && downIcon.addClass("reverse_icon");
							return "";
						}else if(y < 40 && y > 0){
							downHasClass && downIcon.removeClass("reverse_icon");
							return "";
						}
						
						if(maxY >= 40){
							!upHasClass && upIcon.addClass("reverse_icon");
							return "";
						}else if(maxY < 40 && maxY >=0){
							upHasClass && upIcon.removeClass("reverse_icon");
							return "";
						}
					});
					
					myScroll.on("slideDown",function(){
						if(this.y > 40){
							//触发下拉方法
							//alert(2);
							upIcon.removeClass("reverse_icon");
						}
					});
					
					myScroll.on("slideUp",function(){
						if(this.maxScrollY - this.y > 40){
							//触发上拉加载更多
							//alert(1);
							
							upIcon.removeClass("reverse_icon");
						}
					});				
				};

					var overscroll = function(el) {
					  el.addEventListener('touchstart', function() {
					    var top = el.scrollTop
					      , totalScroll = el.scrollHeight
					      , currentScroll = top + el.offsetHeight
					    //If we're at the top or the bottom of the containers
					    //scroll, push up or down one pixel.
					    //
					    //this prevents the scroll from "passing through" to
					    //the body.
					    if(top === 0) {
					      el.scrollTop = 1
					    } else if(currentScroll === totalScroll) {
					      el.scrollTop = top - 1
					    }
					  })
					  el.addEventListener('touchmove', function(evt) {
					    //if the content is actually scrollable, i.e. the content is long enough
					    //that scrolling can occur
					    if(el.offsetHeight < el.scrollHeight)
					      evt._isScroller = true
					  })
					}
					overscroll(document.querySelector('.scroll'));
					document.body.addEventListener('touchmove', function(evt) {
					  //In this case, the default behavior is scrolling the body, which
					  //would result in an overflow.  Since we don't want that, we preventDefault.
					  if(!evt._isScroller) {
					    evt.preventDefault()
					  }
					});
			};
			
		</script>
	</head>
	<body>
		
		<div class="box clearfix scroll">
			<div class="outer clearfix">
				<div class="topOuter">
					<div class="topTxt">
						报告
					</div>
					<div class="topRight" style="display: none;"> 
						全部
					</div>
				</div>
				<div id="wrapper" class="wrapper">
					<div id="scroller">
						<div id = "scroller-pullDown">
							<span id = "down-icon" class = "glyphicon glyphicon-chevron-up pull-down-icon"></span>
							<span id = "pullDown-msg" class = "pull-down-msg">刷新</span>
						</div>
						<div>
							<div id="news-list" class="reportOuter">
							</div>
						</div>
						<div id = "scroller-pullUp">
							<span id = "up-icon" class = "glyphicon glyphicon-chevron-down pull-up-icon"></span>
							<span id = "pullUp-msg" class = "pull-up-msg">上拉加载更多</span>
						</div>
					</div>
				</div>	

				<div class="bottomOuter">
					<a href="schedule.html" class="bottomItem clearfix">
						<img src="../../image/iteach/kebiao.png"/>
						<span>课表</span>
					</a>

					<a href="report.html" class="bottomItem clearfix">
						<img src="../../image/iteach/baogaoon.png"/>
						<span class="bottomItemOn">报告</span>
					</a>

					<a href="message-list.html" class="bottomItem clearfix">
						<img src="../../image/iteach/message.png"/>
						<span>通知</span>
					</a>

					<a href="person-center.html" class="bottomItem clearfix">
						<img src="../../image/iteach/head2.png"/>
						<span>我</span>
					</a>
				</div>

			</div>

		</div>

	</body>
	
</html>
